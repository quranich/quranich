-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local Color=Color local IsValid=IsValid local ScrW=ScrW local ScrH=ScrH local surface=surface local LocalPlayer=LocalPlayer local a=vgui.Create local select=select local b=draw.GetFontHeight local c=math.max local d=math.abs local Vector=Vector local draw=draw local e=draw.RoundedBox local f=math.min local g=surface.SetFont local h=surface.GetTextSize local i=surface.SetMaterial local j=surface.SetDrawColor local k=draw.SimpleText local CurTime=CurTime local l=table.IsEmpty local m=net.Start local n=net.SendToServer local o=timer.Simple local p=net.WriteString local q=net.WriteUInt local ipairs=ipairs local r=surface.DrawRect local s=vgui.Register local t=ix.plugin.list["looting-system"]local u=ix.util.GetMaterial("purp/stalker/ui/ui_actor_menu.png")local v=ix.util.GetMaterial("purp/stalker/ui/ui_actor_widescreen_sidepanels.png")local w=ix.util.GetMaterial("purp/stalker/ui/ui_actor_hint_wnd.png")local x=ix.util.GetMaterial("purp/stalker/ui/ui_ingame2_common.png")local y=ix.util.GetMaterial("purp/stalker/ui/inventory/cell.png","smooth")local z=ix.util.GetMaterial("purp/stalker/ui/inventory/tradeshell.png","smooth")local A=ix.util.GetMaterial("pp/blurscreen")local B=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradedone.png","smooth")local C=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradeyes.png","smooth")local D,E,F=Color(57,61,63),Color(82,85,90),Color(87,86,87)local G={}function G:Init()local H=LocalPlayer()local I=H:GetCharacter()if IsValid(ix.gui.lootingStorage)then ix.gui.lootingStorage:Remove()end ix.gui.lootingStorage=self self:MakePopup()local J,K=ScrW(),ScrH()self.modifyWidth,self.modifyHeight=J/1920,K/1080 self.multiplyWidth,self.multiplyHeight=self.modifyWidth,self.modifyHeight self:SetSize(self.modifyWidth*572,self.modifyHeight*1024)self:AlignLeft(self.modifyWidth*33)self:CenterVertical()self:MakePopup()local L=LocalPlayer()local M=L:GetCharacter()ix.gui.stalkerInventory=a("inventory_stalker.mainframe")ix.gui.stalkerInventory.OnKeyCodeReleased=function(N,O)local P=N.bindKey if P~=nil and O==P then N:Close()end end ix.gui.stalkerInventory.OnClose=function(N)self:Close()end end function G:Setup(H)self.entity=H local I,J=self.multiplyWidth,self.multiplyHeight local K=H.GetDisplayName and H:GetDisplayName()or""local L=0 local M=self:Add("DLabel")M:SetFont("ui.Bahnschrift-s13")M:SetText(K==""and"Хранилище"or K)M:SetTextColor(Color(172,165,157))M:SizeToContents()M:SetPos(self.modifyWidth*47,self.modifyHeight*70)M:SetSize(self.modifyWidth*320,self.modifyHeight*45)local N="ui.Bahnschrift-s8"local O=draw.GetFontHeight(N)local P=self.modifyHeight*117 local Q=self:Add("DLabel")Q:SetFont(N)Q:SetText("ЛКМ - один предмет")Q:SetTextColor(Color(100,100,100))Q:SetPos(self.modifyWidth*47,P)Q:SizeToContents()P=P+O local R=self:Add("DLabel")R:SetFont(N)R:SetText("ПКМ - стак предметов")R:SetTextColor(Color(100,100,100))R:SetPos(self.modifyWidth*47,P)R:SizeToContents()P=P+O local S=self:Add("DModelPanel")S:SetModel(H:GetModel())S:SetPos(self.modifyWidth*380,self.modifyHeight*76)S:SetSize(self.modifyWidth*126,self.modifyHeight*83)S.LayoutEntity=function(X)end local T=S.Entity if IsValid(T)then local X,Y=T:GetRenderBounds()local Z=0 Z=c(Z,d(X.x)+d(Y.x))Z=c(Z,d(X.y)+d(Y.y))Z=c(Z,d(X.z)+d(Y.z))S:SetFOV(65)S:SetCamPos(Vector(Z,Z,Z))S:SetLookAt((X+Y)*0.5)end local U=self:Add("DScrollPanel")U:SetPos(self.modifyWidth*42,self.modifyHeight*214)U:SetSize(self.modifyWidth*479,self.modifyHeight*700)local V=U:GetVBar()V:SetWide(self.modifyWidth*11)V.btnGrip.Paint=function(X,Y,Z)e(0,0,0,Y,Z,Color(77,77,77))end self.lootingItems=U:Add("DIconLayout")self.lootingItems:Dock(FILL)self.lootingItems.Paint=function(X,Y,Z)if IsValid(ix.gui.inv1)then local ab=ix.gui.inv1:GetIconSize()local bb=Color(50,50,50,100)local cb=math.floor(Y/ab)-1 if ab then for db=0,cb do for eb=0,Z/ab do surface.SetMaterial(y)surface.SetDrawColor(color_white)surface.DrawTexturedRect(db*ab,eb*ab,ab,ab)end end end end end for X,Y in next,H.lootItems do local Z=ix.item.list[X]local ab=self.lootingItems:Add("ixVendorItem")ab:Setup(X)ab:SetMouseInputEnabled(true)ab.Paint=function(bb,cb,db)ix.stalkerInventory.DrawItemIcon(Z,cb,db,bb)local eb=H.lootItems[X]if eb>1 then eb=f(eb,999)local fb="ui.Tahoma-6"g(fb)local gb="x0"..eb local hb,ib=h(gb)local jb,kb=2,2 hb,ib=hb+10,ib+6 i(x)j(color_white)surface.DrawPartialTexturedRect(jb,kb,hb,ib,864,820,31,18,1024,1024)k("x"..eb,fb,jb+(hb*0.5),kb+(ib*0.5),Color(215,204,186,255),TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)end if(self._nextTake or 0)>CurTime()then e(0,0,0,cb,db,Color(0,0,0,200))end end ab.Think=function(bb)end ab.click.DoRightClick=function(bb)self:TakeItem(H.lootItems,X,H.lootItems[X],ab)end ab.click.DoClick=function(bb)self:TakeItem(H.lootItems,X,1,ab)end self.lootingItems.items=self.lootingItems.items or{}self.lootingItems.items[X]=ab self.lootingItems:InvalidateLayout()end local W=self:Add("DButton")W:SetFont("ui.Bahnschrift-10")W:SetText("Взять все")W:SetTextColor(Color(245,222,190))W:SetPos(self.modifyWidth*213,self.modifyHeight*940)W:SetSize(self.modifyWidth*144,self.modifyHeight*59)W.Paint=function(X,Y,Z)local ab=X:IsHovered()surface.SetMaterial(ab and B or C)surface.SetDrawColor(color_white)surface.DrawPartialTexturedRect(0,0,22,Z,0,0,22,57,142,57)surface.DrawPartialTexturedRect(22,0,Y-44,Z,22,0,98,57,142,57)surface.DrawPartialTexturedRect(Y-22,0,22,Z,120,0,22,57,142,57)end W.DoClick=function()if self.lootingItems.items and l(self.lootingItems.items)==false then for X,Y in next,self.lootingItems.items do Y:Remove()end m("lootingSystem.TakeAll")n()end o(.25,function()if IsValid(self)then self:Close()end end)end end function G:TakeItem(H,I,J,K)local L=LocalPlayer()if(self._nextTake or 0)>CurTime()then return L:Notify("Необходимо подождать ( чуть медленее )")end self._nextTake=CurTime()+.5 if H[I]==nil then return L:Notify("Предмет не найден в ENTITY")end J=f(J,H[I])H[I]=H[I]-J if H[I]<1 then H[I]=nil K:Remove()end self.entity.lootItems=H m("lootingSystem.TakeItem")p(I)q(J,7)n()if l(H)then o(.25,function()if IsValid(self)then self:Close()end end)end end function G:Close(H)if not H then m("lootingSystem.StorageClose")n()end local I=self:GetChildren()for J,K in ipairs(I)do if K.Remove then K:Remove()end end if IsValid(ix.gui.stalkerInventory)then ix.gui.stalkerInventory:Remove()end self:Remove()end function G:Paint(H,I)local J,K=self:LocalToScreen(0,0)local L,M=H,I J,K=J,K+self.modifyHeight*34 L,M=L,M-self.modifyHeight*34 surface.SetMaterial(A)surface.SetDrawColor(255,255,255,255)local N,O=ScrW(),ScrH()local P,Q=J/N,K/O local R,S=(J+L)/N,(K+M)/O for U=-0.2,1,0.2 do A:SetFloat("$blur",U*5)A:Recompute()render.UpdateScreenEffectTexture()surface.DrawTexturedRectUV(0,self.modifyHeight*34,L,M,P,Q,R,S)end i(z)j(color_white)surface.DrawTexturedRect(0,0,H,I)local T=self:GetChildren()for U,V in ipairs(T)do V:PaintManual()end end s("lootingStorageFrame",G,"Panel")if IsValid(ix.gui.lootingStorage)then ix.gui.lootingStorage:Close()end