-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=ix.plugin.list["looting-system"]net.Receive("lootingSystem.OpenAdminMenu",function()local g=LocalPlayer()if not CAMI.PlayerHasAccess(g,"Helix - Looting Menu",nil)then return g:Notify("У вас недостаточно прав.")end local h=vgui.Create("looting.AdminMenu")h._lootingData=net.ReadTable()h:InitData()end)net.Receive("lootingSystem.OpenAdminMenuSetData",function()local g=LocalPlayer()if not CAMI.PlayerHasAccess(g,"Helix - Looting Menu",nil)then return g:Notify("У вас недостаточно прав.")end local h=ix.gui.lootingAdminMenu if IsValid(h)then local i=vgui.Create("looting.AdminMenu")i._lootingData=net.ReadTable()i:InitData()end end)net.Receive("lootingSystem.EditFrame",function()local g=LocalPlayer()if not CAMI.PlayerHasAccess(g,"Helix - Looting Menu",nil)then return g:Notify("У вас недостаточно прав.")end local h=net.ReadUInt(32)local i=net.ReadTable()local j=ix.gui.lootingAdminMenu if IsValid(j)then j:EditLoot(h,i)end end)net.Receive("lootingSystem.OpenStorage",function()local g=net.ReadEntity()if not IsValid(g)then return end if IsValid(ix.gui.lootingStorage)then return end g.lootItems=net.ReadTable()if not IsValid(ix.gui.lootingStorage)then ix.gui.lootingStorage=vgui.Create("lootingStorageFrame")ix.gui.lootingStorage:Setup(g)end end)net.Receive("lootingSystem.StorageUpdate",function()local g=ix.gui.lootingStorage if IsValid(g)then g:Close()LocalPlayer():Notify("Хранилище обновлено!")end end)local function b(g,h,i,j,k,l)j=j or"ixSubTitleFont"l=l or 8 k=k or Color(88,88,88,255)surface.SetFont(j)local m,n=surface.GetTextSize(i)local o,p=m+l*2,n+l*2 ix.util.DrawBlurAt(g,h,o,p)surface.SetDrawColor(0,0,0,40)surface.DrawRect(g,h,o,p)derma.SkinFunc("DrawImportantBackground",g,h,o,p,k)surface.SetTextColor(color_white)surface.SetTextPos(g+l,h+l)surface.DrawText(i)return p end hook.Add("HUDPaint",a.uniqueID.."HUDPaint",function()local g=LocalPlayer()if not CAMI.PlayerHasAccess(g,"Helix - Looting Menu",nil)then return end local h=g:GetNetVar("lootingSystemEditable")if h==nil then return end local i,j=h.editableIndex,h.objects local k=32 local l,m=k,k*1.75 m=m+b(l,m,"Редактирование объектов для лута - "..i,"ui.Tahoma-10",ix.config.Get("color"))m=m+b(l,m,"ЛКМ - Добавить объект","ui.Tahoma-7")m=m+b(l,m,"ПКМ - Удалить объект","ui.Tahoma-7")m=m+b(l,m,"ALT + ПКМ - Удалить все объекты","ui.Tahoma-7")m=m+b(l,m,"RELOAD (Перезарядка) - Прекратить редактирование (сохранить)","ui.Tahoma-7")m=m+b(l,m,"Объектов выбрано "..table.Count(j),"ui.Tahoma-7")if input.IsKeyDown(KEY_LALT)then for n,o in next,(h.objects or{})do local p=g:GetPos()local q=o.position local r=Color(200,100,100)local s=q:ToScreen()local t=q:Distance(p)t=math.Round((t/17.3),0)ix.util.DrawText("("..t.." м.)",s.x,s.y,Color(200,200,200),TEXT_ALIGN_CENTER,TEXT_ALIGN_TOP,"ui.Tahoma-7",255)end end end)local c=Material("models/wireframe")hook.Add("PostDrawTranslucentRenderables",a.uniqueID.."PostDrawTranslucentRenderables",function()if bSkybox then return end local g=LocalPlayer()if not CAMI.PlayerHasAccess(g,"Helix - Looting Menu",nil)then return end local h=g:GetNetVar("lootingSystemEditable")if h==nil then return end for i,j in next,(h.objects or{})do render.ModelMaterialOverride(c)render.Model({model=j.model,pos=j.position,angle=j.angles})render.ModelMaterialOverride()end end)local function d(g,h)local i=g:GetEyeTraceNoCursor()local j=i.Entity h.objects=h.objects or{}local k=h.objects if IsValid(j)and j:GetClass()=="prop_physics"then local l={entIndex=j:EntIndex(),model=j:GetModel(),position=j:GetPos(),angles=j:GetAngles(),}if j:GetSkin()~=0 then l.skin=j:GetSkin()end table.insert(h.objects,l)end end local function e(g,h)local i=g:GetEyeTraceNoCursor()local j=i.Entity if input.IsKeyDown(KEY_LALT)then h.objects={}return end h.objects=h.objects or{}local k=false if IsValid(j)and j:GetClass()=="prop_physics"then for l,m in next,h.objects do if m.position==j:GetPos()then h.objects[l]=nil k=true end end end if k==false then for l,m in next,h.objects do if isvector(m.position)and i.HitPos:DistToSqr(m.position)<=800 then h.objects[l]=nil break end end end end local function f(g,h)net.Start("lootingSystem.SaveObjects")net.WriteTable(h)net.SendToServer()end hook.Add("PlayerBindPress",a.uniqueID.."PlayerBindPress.Dungeons.EditModeType",function(g,h,i)local j=LocalPlayer()if CAMI.PlayerHasAccess(j,"Helix - Looting Menu",nil)then local k=j:GetNetVar("lootingSystemEditable")if k then if((h:find("invnext")or h:find("invprev"))and i)then return true elseif(h:find("attack2")and i)then e(j,k)return true elseif(h:find("attack")and i)then d(j,k)return true elseif(h:find("reload")and i)then f(j,k)return true end end end end)