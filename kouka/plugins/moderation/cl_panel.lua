-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=KoukaPlugin a:Hook("Kouka.PluginsLoaded",function()kouka.CallPluginMethod("modular_menu","AddMenu","Moderations List",{Init=function(b)local c=b:Add("DListView")c:SetMultiSelect(false)c:Dock(FILL)c:AddColumn("Target")c:AddColumn("IP")c:AddColumn("Type")c:AddColumn("Ban")c:AddColumn("Unban")c:AddColumn("Length")c:AddColumn("Reason")c:AddColumn("Admin")c:AddColumn("Unban Admin")b.dListView=c local d=b:Add("DTextEntry")d:SetTall(30)d:SetPlaceholderText("ModID/SteamID/IP")d:Dock(BOTTOM)d:DockMargin(0,5,0,0)d.OnEnter=function(e)local f=string.Trim(e:GetValue())e:SetText("Getting info...")e:SetEnabled(false)e:SetEnterAllowed(false)local g if kouka.utils.IsSteamID64(f)then g=0 elseif kouka.utils.IsSteamID32(f)then f=util.SteamIDTo64(f)if f~="0"then g=0 end elseif kouka.utils.IsDBID(f)then g=1 end if g~=nil then net.Start("Kouka.ModList.Get")net.WriteUInt(g,2)net.WriteString(f)net.SendToServer()elseif kouka.utils.IsIP(f)then b.lastIP=f net.Start("Kouka.ModList.Get")net.WriteUInt(2,2)kouka.utils.WriteIP(f)net.SendToServer()else e:SetText("Error, use only ModID, SteamID32/64 or IP")e:SetEnabled(true)e:SetEnterAllowed(true)end end if b.strParam~=nil then local e=Player(b.strParam)d:SetText((IsValid(e)and e:SteamID64())or b.strParam)d:OnEnter()else d:RequestFocus()end b.dTextEntry=d b.UpdateWithTarget=function(e,f)timer.Simple(1.2,function()if IsValid(b)then b.dTextEntry:SetText(f)b.dTextEntry:OnEnter()end end)end end,OnUpdate=function(b,c)b.dListView:Clear()local d,e=os.time(),kouka.HasFlag("See IP ModList")for f,g in next,c do local h=g.target_ip local i,j,k,l=g.unban-g.ban,g.unban==0,g.target~=nil or(h~=nil and e),b.lastIP==h local m=b.dListView:AddLine(g.target or"",((e or l)and((h==nil and"")or h))or"HIDDEN",g.type,kouka.utils.RelativeDate(g.ban),(j and"never")or kouka.utils.RelativeDate(g.unban),(j and"âˆž")or kouka.utils.TimeToString(i),g.reason,g.admin,g.unban_admin or"")m.OnRightClick=function(n)local o=DermaMenu(n)local p,q=o:AddSubMenu("Target")q:SetImage("icon16/user_comment.png")if g.target~=nil then p:AddOption("Copy SteamID32",function()SetClipboardText(util.SteamIDFrom64(g.target))end):SetImage("icon16/tag_blue_add.png")p:AddOption("Copy SteamID64",function()SetClipboardText(g.target)end):SetImage("icon16/tag_blue_add.png")p:AddOption("Copy profile link",function()SetClipboardText("https://steamcommunity.com/profiles/"..g.target)end):SetImage("icon16/vcard_add.png")p:AddOption("Open profile",function()gui.OpenURL("https://steamcommunity.com/profiles/"..g.target)end):SetImage("icon16/vcard.png")end if h~=nil and(l or e)then p:AddOption("Copy IP",function()SetClipboardText(h)end):SetImage("icon16/building.png")end local r,s=o:AddSubMenu("Moderation")s:SetImage("icon16/lightning.png")if kouka.utils.IsSteamID64(g.admin)then local t,u=r:AddSubMenu("Admin")u:SetImage("icon16/user_gray.png")t:AddOption("Copy SteamID32",function()SetClipboardText(util.SteamIDFrom64(g.admin))end):SetImage("icon16/tag_blue_add.png")t:AddOption("Copy SteamID64",function()SetClipboardText(g.admin)end):SetImage("icon16/tag_blue_add.png")t:AddOption("Copy profile link",function()SetClipboardText("https://steamcommunity.com/profiles/"..g.admin)end):SetImage("icon16/vcard_add.png")t:AddOption("Open profile",function()gui.OpenURL("https://steamcommunity.com/profiles/"..g.admin)end):SetImage("icon16/vcard.png")end if g.unban_admin and kouka.utils.IsSteamID64(g.unban_admin)then local t,u=r:AddSubMenu("Unban Admin")u:SetImage("icon16/user_suit.png")t:AddOption("Copy SteamID32",function()SetClipboardText(util.SteamIDFrom64(g.unban_admin))end):SetImage("icon16/tag_blue_add.png")t:AddOption("Copy SteamID64",function()SetClipboardText(g.unban_admin)end):SetImage("icon16/tag_blue_add.png")t:AddOption("Copy profile link",function()SetClipboardText("https://steamcommunity.com/profiles/"..g.unban_admin)end):SetImage("icon16/vcard_add.png")t:AddOption("Open profile",function()gui.OpenURL("https://steamcommunity.com/profiles/"..g.unban_admin)end):SetImage("icon16/vcard.png")end r:AddOption("Copy Reason",function()SetClipboardText(g.reason)end):SetImage("icon16/tag_red.png")r:AddOption("Copy ModID",function()SetClipboardText(g.id)end):SetImage("icon16/font.png")if k then o:AddSpacer()if kouka.HasFlag("Edit Modlist")then o:AddSpacer()o:AddOption("Edit",function()local t=vgui.Create("DFrame")t:SetSize(500,220)t:Center()t:SetTitle("Edit Ban | "..(g.target or h))t:MakePopup()t:SetParent(b)local u=t:Add("DLabel")u:SetContentAlignment(5)u:SetText("Length:")u:Dock(TOP)local v=t:Add("DTextEntry")v:Dock(TOP)v:SetValue(kouka.utils.TimeToStringShort(i))local w=t:Add("DLabel")w:SetContentAlignment(5)w:SetText("Reason:")w:Dock(TOP)w:DockMargin(0,15,0,0)local x=t:Add("DTextEntry")x:SetMultiline(true)x:SetValue(g.reason)x:Dock(FILL)x.OnKeyCode=function(z,A)if A==KEY_ENTER then z:SetMultiline(false)end end local y=t:Add("DButton")y:SetText("Apply")y:Dock(BOTTOM)y:DockMargin(0,15,0,0)y.DoClick=function(z)local A=string.Trim(v:GetValue())local B=(tonumber(A)and A*60)or kouka.utils.StringToTime(A)if B then if B~=0 then B=g.ban+B end local C=x:GetValue()if B~=g.unban or C~=g.reason then if C:utf8len()>400 then return kouka.Notify(kouka.colors.red,"Reason length more than 400")end net.Start("Kouka.ModList.Edit")net.WriteBool(kouka.commands.IsSilent())net.WriteUInt(0,2)net.WriteString(g.id)net.WriteUInt(B,32)net.WriteString(string.Trim(C))net.SendToServer()b.dTextEntry:SetText("Edit request sent")b:UpdateWithTarget(g.target or h)end t:Remove()end end v.OnEnter=function(z)if t.isBlocked~=true then y:DoClick()end end x.OnChange=function()t.isBlocked=x:GetValue():utf8len()>400 x:SetTextColor(t.isBlocked and kouka.colors.red)y:SetEnabled(t.isBlocked~=true)end x.OnEnter=function(z)if t.isBlocked~=true then y:DoClick()end end end):SetImage("icon16/link_edit.png")end if g.active then if kouka.HasFlag("Deactivate Modlist")then local t,u=o:AddSubMenu("Deactivate")u:SetImage("icon16/cancel.png")t:AddOption("Confirm",function()net.Start("Kouka.ModList.Edit")net.WriteBool(kouka.commands.IsSilent())net.WriteUInt(1,2)net.WriteString(g.id)net.SendToServer()b.dTextEntry:SetText("Deactivate request sent")b:UpdateWithTarget(g.target or h)end):SetImage("icon16/link_break.png")end else if kouka.HasFlag("Edit Modlist")and(g.unban==0 or g.unban>os.time())then local t,u=o:AddSubMenu("Activate")u:SetImage("icon16/cancel.png")t:AddOption("Confirm",function()net.Start("Kouka.ModList.Edit")net.WriteBool(kouka.commands.IsSilent())net.WriteUInt(0,2)net.WriteString(g.id)net.WriteUInt(g.unban,32)net.WriteString(g.reason)net.WriteBool(true)net.SendToServer()b.dTextEntry:SetText("Activate request sent")b:UpdateWithTarget(g.target or h)end):SetImage("icon16/link_break.png")end end if kouka.HasFlag("Delete Modlist")then local t,u=o:AddSubMenu("Delete")u:SetImage("icon16/link_delete.png")t:AddOption("Confirm",function()net.Start("Kouka.ModList.Edit")net.WriteBool(kouka.commands.IsSilent())net.WriteUInt(2,2)net.WriteString(g.id)net.SendToServer()b.dTextEntry:SetText("Delete request sent")b:UpdateWithTarget(g.target or h)end):SetImage("icon16/delete.png")end end o:Open()end m:SetAlpha((g.active and 255)or 136)end b.dTextEntry:SetText("")b.dTextEntry:SetEnabled(true)b.dTextEntry:SetEnterAllowed(true)end})end)net.Receive("Kouka.ModList.Get",function()local b={}if net.ReadBool()==false then kouka.utils.ReadList(function()local c=#b+1 b[c]={id=net.ReadString(),active=net.ReadBool(),ban=net.ReadUInt(32),unban=net.ReadUInt(32),type=net.ReadString(),reason=net.ReadString(),admin=net.ReadString()}if net.ReadBool()then b[c].target=net.ReadString()end if net.ReadBool()then b[c].target_ip=kouka.utils.ReadIP()end if net.ReadBool()then b[c].unban_admin=net.ReadString()end end,nil,true)end kouka.CallPluginMethod("modular_menu","UpdateMenu","Moderations List",b)end)