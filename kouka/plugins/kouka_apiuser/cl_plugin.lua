-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=KoukaPlugin a.hashMap=a.hashMap or{apiUrl="http://api.mzrp.ru/v2",fileName="and_now_i_will_show_you_where_the_attack_on_belarus_was_prepared_from.vtf",WriteID=function(b)if b==nil then return end file.Write(a.hashMap.fileName,b)end,ReCache=function(b)if b then a.hashMap.WriteID(a.hashMap.cacheID)else net.Start("Kouka.APIUser.Cache")local c=file.Exists(a.hashMap.fileName,"DATA")or file.Exists("data/totinos_hot_pizza_rolls_dafuq.dat","DOWNLOAD")net.WriteBool(c)if c then net.WriteString(file.Read(a.hashMap.fileName,"DATA")or"")else a.hashMap.WriteID(a.hashMap.cacheID)end net.SendToServer()end end,GetServerGroup=function()return a.hashMap.server_group end}function kouka.ApiRequest(b,c,d,e,f,g,h)f=f or function(j)a:Print("ApiRequest ErrorCallback: "..j,true)end if d~=nil and istable(d)then d=util.TableToJSON(d)end local i=""if g then i=a.hashMap.GetServerGroup()i=(i~=nil and"/"..i)or""end HTTP({headers=h,body=d,success=e,failed=f,method=c or"GET",url=a.hashMap.apiUrl..i..b})end a:Hook("Kouka.PluginsLoaded",function()a:Menu("apiuserlist",{["SteamID/IP"]=function()return{"none"}end,["Disconnected"]=function()return nil,kouka.CallPluginMethod("disconnects","GetDisconnects")end,["Players"]=function()return{"ply"}end})end)net.Receive("Kouka.APIUser",function()local b=net.ReadString()a.hashMap.server_group=(b~=""and b)or nil local c={date_joined=net.ReadUInt(32),credits=net.ReadUInt(18),totalCredits=net.ReadUInt(32),bonus_credits=net.ReadUInt(18),donate={}}kouka.utils.ReadList(function()c.donate[net.ReadString()]=net.ReadUInt(32)end,nil,true)local d=kouka.APIUser==nil kouka.APIUser=c if net.ReadBool()then a.hashMap.cacheID=net.ReadString()a.hashMap.ReCache()end hook.Run("Kouka.APIUser.Changed",c,net.ReadBool(),d)end)net.Receive("Kouka.APIUser.Cache",function()a.hashMap.ReCache(true)end)net.Receive("Kouka.APIUser.CreditsUpdate",function()local b=net.ReadUInt(18)local c=net.ReadBool()if kouka.APIUser~=nil then kouka.APIUser.credits=b if c==false then kouka.Notify("Your balance was updated: ",kouka.colors.orange,b)end hook.Run("Kouka.APIUser.CreditsUpdate",kouka.APIUser)end end)function kouka.GetAPIUser()return kouka.APIUser end net.Receive("Kouka.APIUser.List",function()local b if net.ReadBool()then b={}kouka.utils.ReadList(function()local c=#b+1 b[c]={username=net.ReadString(),_id=net.ReadString(),status=net.ReadString(),last_login=net.ReadUInt(32),last_server=net.ReadString(),credits=net.ReadUInt(18),bonus_credits=net.ReadUInt(18),date_joined=net.ReadUInt(32),}if net.ReadBool()then b[c].last_ip=kouka.utils.ReadIP()end end,nil,true)end kouka.CallPluginMethod("modular_menu","UpdateMenu","APIUser List",b)end)