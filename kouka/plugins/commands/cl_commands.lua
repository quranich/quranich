-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=KoukaPlugin a.hashMap.view={}a.hashMap.thirdperson=true a.hashMap.thirdPersonDistance=100 a.hashMap.lineMat=Material("cable/new_cable_lit")a.hashMap.uiForeground=Color(240,240,255,255)a.hashMap.uiBackground=Color(20,20,20,120)a.hashMap.currentPlyNum=0 a.hashMap.SpectateCalcView=function(b,c,d,e)local f=a.hashMap.spectateTarget if IsValid(f)==false then a.hashMap.StopSpectate()return end local g,h=a.hashMap.view,a.hashMap.thirdperson f:SetNoDraw(not h)if h then local i,j=f:GetShootPos(),LocalPlayer()local k=util.TraceLine({start=i,endpos=i-j:GetAimVector()*a.hashMap.thirdPersonDistance,filter=f})g.origin=k.HitPos+k.HitNormal*10 g.angles=j:EyeAngles()else g.origin=f:GetShootPos()g.angles=f:EyeAngles()end return g end a.hashMap.SpectateBinds=function(b,c,d)local e=input.LookupBinding(c)if d then if c=="+jump"then a.hashMap.StopSpectate()return true elseif c=="+duck"then a.hashMap.thirdperson=not a.hashMap.thirdperson return true elseif c=="+attack"then a.hashMap.CyclePlayerList(true)return true elseif c=="+attack2"then a.hashMap.CyclePlayerList(false)return true end end if a.hashMap.thirdperson and(e=="MWHEELDOWN"or e=="MWHEELUP")then a.hashMap.thirdPersonDistance=a.hashMap.thirdPersonDistance+10*((e=="MWHEELDOWN"and 1)or-1)end end a.hashMap.DrawLookingLines=function()render.SetMaterial(a.hashMap.lineMat)local b,c,d,e=a.hashMap.view,a.hashMap.thirdperson,a.hashMap.spectateTarget,LocalPlayer()cam.Start3D(b.origin,b.angles)for f,g in next,player.GetAll()do if(g==d and c==false)or g==e then continue end local h=g:GetActiveWeapon()local i if IsValid(h)then local j=h:GetAttachment(1)i=j~=nil and j.Pos end render.DrawBeam(i or g:EyePos(),g:GetEyeTrace().HitPos,4,0.01,10,team.GetColor(g:Team()))end cam.End3D()end a.hashMap.CyclePlayerList=function(b)local c,d=a.hashMap.currentPlyNum,player.GetCount()if d==2 then return end if b then c=c+1 if c>d then c=1 end else c=c-1 if c<=0 then c=d end end a.hashMap.currentPlyNum=c local e=player.GetAll()[c]if e==LocalPlayer()then return a.hashMap.CyclePlayerList(b)end net.Start("Kouka.Spectate")net.WriteBool(true)net.WriteEntity(e)net.SendToServer()end a.hashMap.DrawHelp=function()local b,c,d,e,f=math.floor(ScrH()/2),a.hashMap.uiForeground,a.hashMap.uiBackground,a.hashMap.spectateTarget,LocalPlayer()draw.WordBox(2,10,b,"Target: "..e:Nick(),"ChatFont",d,c)draw.WordBox(2,10,b+40,"Left click: Next player","ChatFont",d,c)draw.WordBox(2,10,b+60,"Right click: Previous player","ChatFont",d,c)draw.WordBox(2,10,b+80,"Control: Toggle thirdperson","ChatFont",d,c)draw.WordBox(2,10,b+100,"Space: Stop spectating","ChatFont",d,c)for g,h in next,player.GetAll()do if h==e then continue end local i=h:GetShootPos():ToScreen()if i.visible==false then continue end local j,k=i.x,i.y draw.RoundedBox(2,j,k-6,12,12,team.GetColor(h:Team()))if h==f then draw.WordBox(2,j,k-26,"It's You","ChatFont",d,c)else draw.WordBox(2,j,k-66,h:Nick(),"ChatFont",d,c)draw.WordBox(2,j,k-46,h:SteamID64(),"ChatFont",d,c)draw.WordBox(2,j,k-26,"Health: "..h:Health(),"ChatFont",d,c)end end end a.hashMap.StopSpectate=function()hook.Remove("CalcView","Kouka.Spectate")hook.Remove("PlayerBindPress","Kouka.Spectate")hook.Remove("ShouldDrawLocalPlayer","Kouka.Spectate")hook.Remove("HUDPaint","Kouka.Spectate")hook.Remove("RenderScreenspaceEffects","Kouka.Spectate")local b=a.hashMap.spectateTarget if IsValid(b)then b:SetNoDraw(false)end net.Start("Kouka.Spectate")net.WriteBool(false)net.SendToServer()end net.Receive("Kouka.Spectate",function()local b=net.ReadEntity()if IsValid(b)then a.hashMap.spectateTarget=b for c,d in next,player.GetAll()do if d==b then a.hashMap.currentPlyNum=c break end end hook.Add("CalcView","Kouka.Spectate",a.hashMap.SpectateCalcView)hook.Add("PlayerBindPress","Kouka.Spectate",a.hashMap.SpectateBinds)hook.Add("ShouldDrawLocalPlayer","Kouka.Spectate",function()return true end)hook.Add("HUDPaint","Kouka.Spectate",a.hashMap.DrawHelp)hook.Add("RenderScreenspaceEffects","Kouka.Spectate",a.hashMap.DrawLookingLines)end end)