-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=KoukaPlugin local b=Color(221,238,255)local c={}function c:Init()self:SetTitle(a.hashMap.origTitle)end function c:OpenAnim()self:SetPos(-self:GetWide(),(ScrH()-self:GetTall())/2)self:MoveTo(10,(ScrH()-self:GetTall())/2,.1,0,nil,function(d,e)e:MakePopup()e:SetKeyboardInputEnabled(false)gui.SetMousePos(e.x+e:GetWide()/2,e.y+(e:GetTall()+24)/2)end)end function c:CloseAnim(d)self:SetMouseInputEnabled(false)self:MoveTo(-self:GetWide(),self.y,.1,0,nil,function(e,f)f:Remove()if d then d()end end)end function c:Setup(d,e,f,g)surface.SetFont(a.hashMap.font)if d then local h=false local i=g or(f==nil and kouka.menus[d])or nil if i==nil then i=player.GetAll()h=true end local j=#i local k=22*j local l=math.ceil(k/(ScrH()-104))k=math.ceil(j/l)*22+24 local m={}local n=0 for s,t in next,i do local u=#m+1 if h then if isentity(t)then m[u]={name=t:Name().." ["..kouka.utils.SteamID32ToInt(t:SteamID()).."]",ply=t,color=t==LocalPlayer()}else m[u]={name=t}end else m[u]=t end local v=surface.GetTextSize(m[u].name)if v>n then n=v end end n=n+16 local o=math.max(surface.GetTextSize(a.hashMap.origTitle)+106,n*l)if n*l<o then n=math.ceil(o/l)end self:SetTitle(a.hashMap.origTitle.." | "..d:uCapitalize())self:SetSize(o,k)local p=self:Add("DIconLayout")p:SetPos(0,24)p:SetSize(o,k-24)local q,r if h then q,r=SortedPairsByMemberValue(m,"name")else q,r=next,m end for s,t in q,r do local u=p:Add("DButton")u:SetFont(a.hashMap.font)u:SetText(t.name)u:SetWidth(n)u:SetTextColor(kouka.colors.black)local v=u:GetSkin()local w=(t.color and b)or kouka.colors.white u.Paint=function(x,y,z)if not x.m_bBackground then return end if x.Depressed or x:IsSelected()or x:GetToggle()then return v.tex.Button_Down(0,0,y,z,w)end if x:GetDisabled()then return v.tex.Button_Dead(0,0,y,z,w)end if x.Hovered then return v.tex.Button_Hovered(0,0,y,z,w)end v.tex.Button(0,0,y,z,w)end function u:DoClick()a.hashMap.CloseMenu(false,function()if t.ply then if isstring(t.ply)and kouka.utils.IsSteamID64(t.ply)then a.hashMap.AddArg(t.ply,d,e,f or{})elseif IsValid(t.ply)then a.hashMap.AddArg(t.ply:UserID(),d,e,f or{})else kouka.Notify(kouka.colors.red,"Player has disconnected")end elseif t.func then if t.func==true then a.hashMap.argMethods[e[1]](d,e,{})else local x,y=t.func()if x then a.hashMap.argMethods[x[1]](d,x,{})elseif y then a.hashMap.OpenMenu(d,e,nil,y)end end end end)end end else local h=0 local i={}local j=0 for p,q in next,kouka.commands.GetAll()do if q.group==nil then continue end h=h+1 local r=q.menu or q.name:uCapitalize()local s=surface.GetTextSize(r)if s>j then j=s end i[q.group]=i[q.group]or{}table.insert(i[q.group],{name=q.name,capName=r,args=q.args,icon=q.icon})end j=j+48 local k=h*22+table.Count(i)*46 local l=math.ceil(k/(ScrH()-104))k=table.Count(i)*24-4+3 for p,q in next,i do k=k+math.ceil(#q/l)*22 end local m=k+24 local n=math.max(surface.GetTextSize(a.hashMap.origTitle)+104,j*l+4)for p,q in next,i do local r=surface.GetTextSize(p)+34 if r>n then n=r end table.sort(q,function(s,t)return kouka.utils.Sort(s.name,t.name)end)end if j*l+4<n then j=math.ceil((n-4)/l)end self:SetTitle(a.hashMap.origTitle)self:SetSize(n,m)local o=vgui.Create("DCategoryList",self)o:SetPos(0,24)o:SetSize(n,k+4)for p,q in SortedPairs(i)do local r=o:Add(p)r:DockPadding(0,0,0,2)r.Toggle=function()end local s=vgui.Create("DIconLayout",r)s:SetPos(0,20)s:SetSize(n,math.ceil(#q/l)*22)for t,u in next,q do local v=s:Add("DButton")v:SetFont(a.hashMap.font)v:SetText(u.capName)v:SetWidth(j)v:SetImage("icon16/"..u.icon..".png")v:SetTextColor(kouka.colors.black)function v:DoClick()a.hashMap.CloseMenu(false,function()if kouka.menus[u.name]then a.hashMap.OpenMenu(u.name,u.args,nil)else if u.args then a.hashMap.argMethods[u.args[1]](u.name,u.args,{})else kouka.commands.Run(u.name)end end end)end function v:DoRightClick()if u.args and u.args[1]=="ply"then a.hashMap.CloseMenu(false,function()a.hashMap.AddArg(LocalPlayer():UserID(),u.name,u.args,{})end)else v:DoClick()end end end end end self:OpenAnim()end vgui.Register("KoukaMenu",c,"DFrame")