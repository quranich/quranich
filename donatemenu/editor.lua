-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a={"mzmenu/donate/icons/sets/aug.png","mzmenu/donate/icons/sets/case.png","mzmenu/donate/icons/sets/spas.png","mzmenu/donate/icons/sets/vss.png","mzmenu/donate/icons/storages/boxes.png","mzmenu/donate/icons/storages/move_storage.png","mzmenu/donate/icons/storages/shelf.png","mzmenu/donate/icons/storages/ender_expand.png","mzmenu/donate/icons/storages/ender_money.png","mzmenu/donate/icons/currency/case.png","mzmenu/donate/icons/currency/moneybags.png","mzmenu/donate/icons/currency/mnogo_deneg.png","mzmenu/donate/icons/currency/safe.png","mzmenu/donate/icons/currency/safe2.png","mzmenu/donate/icons/sponsorpacks/merc.png","mzmenu/donate/icons/sponsorpacks/miliguy.png","mzmenu/donate/icons/sponsorpacks/sashka.png","mzmenu/donate/icons/sponsorpacks/zloy_4el.png"}local b={}function b:Init()self:SetTall(36)self:DockMargin(4,4,4,0)self.name=self:Add("DLabel")self.name:Dock(FILL)self.name:DockMargin(10,0,0,0)self.name:SetFont("ixChatFont")self.name:SetTextColor(color_white)self.name:SetExpensiveShadow(1,Color(0,0,0,200))self.click=self:Add("DButton")self.click:Dock(FILL)self.click:SetText("")self.click.Paint=function()end self.click.DoClick=function(c)self.parentPanel.activeItem=self end end function b:Setup(c,d)self.parentPanel=self:GetParent()self.data=d self.name:SetText(c)end function b:Paint(c,d)if self.parentPanel.activeItem==self then surface.SetDrawColor(ix.config.Get("color"))else surface.SetDrawColor(0,0,0,100)end surface.DrawRect(0,0,c,d)end vgui.Register("AD_AsyncMenuItem",b,"DPanel")function AutoDonate.AsyncMenu(c,d)if IsValid(AutoDonate.donate_pnl)==false then return end local e=vgui.Create("DFrame")e:SetSize(ScrW()*0.45,ScrH()*0.65)e:SetTitle("")e:MakePopup()e:Center()e:SetParent(AutoDonate.donate_pnl)local f=e:Add("DPanel")f:SetTall(34)f:Dock(TOP)e.headerText=f:Add("DLabel")e.headerText:Dock(FILL)e.headerText:SetWide(e:GetWide())e.headerText:Dock(FILL)e.headerText:SetContentAlignment(5)e.headerText:SetText("Пожалуйста, подождите")e.headerText:SetTextInset(4,0)e.headerText:SetTextColor(color_white)e.headerText:SetFont("ixMediumFont")local g=e:Add("DPanel")g:SetTall(34)g:Dock(BOTTOM)g:SetPaintBackground(false)e.selAction=g:Add("DButton")e.selAction:SetFont("ixMediumFont")e.selAction:SetWide(e.headerText:GetWide())e.selAction:Dock(FILL)e.selAction:SetContentAlignment(5)e.selAction:SetText("Выбрать")e.selAction:SetTextColor(color_white)e.selAction:SetEnabled(false)local h=e:Add("DScrollPanel")h:SetWide(e:GetWide()-7)h:Dock(LEFT)h:DockMargin(0,4,0,4)h:SetPaintBackground(true)e.itemsList=h:Add("DListLayout")e.itemsList:SetSize(h:GetSize())e.itemsList:DockPadding(0,0,0,4)e.itemsList:SetTall(ScrH())e.itemsList.AddCbItem=function(i,j,k)i:Add("AD_AsyncMenuItem"):Setup(j,k)i:InvalidateLayout()if e.selAction:IsEnabled()==false then e.selAction:SetEnabled(true)end end function e.selAction:DoClick()local i=e.itemsList.activeItem if i~=nil and i.data~=nil then d(i.data)e:Remove()end end c(e.headerText,e.itemsList)end function AutoDonate.OpenItemEditMenu(c,d)if IsValid(AutoDonate.editorMenu)then AutoDonate.editorMenu:Remove()end d.data=d.data or{}local e=vgui.Create("DFrame")e:SetSize(c:GetSize())e:Center()e:SetTitle("Изменение предмета | "..(d.name or"Без Имени"))e:MakePopup()e:SetParent(c)AutoDonate.editorMenu=e local f=e:Add("DScrollPanel")f:Dock(FILL)AutoDonate.editorMenu.scrollPanel=f local g=f:Add("DCheckBoxLabel")g:SetContentAlignment(5)g:SetText("Активен?")g:SetValue(d.active==true)g:Dock(TOP)local h=f:Add("DLabel")h:SetContentAlignment(5)h:SetText("Название:")h:Dock(TOP)h:DockMargin(0,15,0,0)local i=f:Add("DTextEntry")i:Dock(TOP)i:SetValue(d.name or"Без Имени")local j=f:Add("DLabel")j:SetContentAlignment(5)j:SetText("Категория:")j:Dock(TOP)j:DockMargin(0,15,0,0)local k=f:Add("DComboBox")k:Dock(TOP)k:DockMargin(0,15,0,15)k.OnMenuOpened=function(A,B)print("menu open")B.PerformLayout=function()end B:SetMaxHeight(250)B:SetTall(250)end local l=f:Add("DLabel")l:SetContentAlignment(5)l:SetText("Описание:")l:Dock(TOP)l:DockMargin(0,15,0,0)local m=f:Add("DTextEntry")m:SetMultiline(true)m:Dock(TOP)m:SetTall(AutoDonate.editorMenu:GetTall()/4)m:SetValue(d.description or"")local n=f:Add("DLabel")n:SetContentAlignment(5)n:SetText("Иконка:")n:Dock(TOP)n:DockMargin(0,15,0,0)d.icon=d.icon or"mzmenu/donate/icons/currency/case.png"local o=f:Add("DComboBox")o:Dock(TOP)o:SetTall(128)o:SetImage(d.icon)o:DockMargin(0,5,0,0)local p=f:Add("DTextEntry")p:Dock(TOP)p:SetValue(d.icon)p:DockMargin(0,5,0,0)local q=f:Add("DComboBox")q:Dock(TOP)q:SetValue(d.icon)for A,B in next,a do q:AddChoice(B)end function q:OnSelect(A,B)o:SetImage(B)p:SetValue(B)d.icon=B end function p:OnEnter(A)o:SetImage(A)q:SetValue(A)d.icon=A end local r=f:Add("DLabel")r:SetContentAlignment(5)r:SetText("Лимит:")r:Dock(TOP)r:DockMargin(0,15,0,0)local s=f:Add("DTextEntry")s:Dock(TOP)s:SetValue(d.limit or 0)s:SetNumeric(true)local t=f:Add("DLabel")t:SetContentAlignment(5)t:SetText("Стоимость:")t:Dock(TOP)t:DockMargin(0,15,0,0)local u=f:Add("DTextEntry")u:Dock(TOP)u:SetValue(d.price or 0)u:SetNumeric(true)local v=f:Add("DCheckBoxLabel")v:SetContentAlignment(5)v:SetText("Можно ли купить за доп. валюту?")v:SetValue(d.use_bonus_credits==true)v:Dock(TOP)local w=f:Add("DLabel")w:SetContentAlignment(5)w:SetText("Скидка:")w:Dock(TOP)w:DockMargin(0,15,0,0)local x=f:Add("DTextEntry")x:Dock(TOP)x:SetValue(d.discount or 0)x:SetNumeric(true)k.OnSelect=function(self,A,B,C)d.category=C end for A,B in next,AutoDonate.categories do k:AddChoice(B[2],B[1],B[1]==d.category)end local y=AutoDonate.types[d.type]if y~=nil and y.GetEditor then y.GetEditor(d)end local z=f:Add("DButton")z:SetText("Сохранить")z:Dock(TOP)z:DockMargin(0,15,0,0)z.DoClick=function(A)if d.category==nil then return end net.Start("AutoDonate.Data")if d._id~=nil then net.WriteUInt(2,2)net.WriteString(d._id)else net.WriteUInt(1,2)end net.WriteBool(g:GetChecked())net.WriteBool(v:GetChecked())net.WriteString(i:GetValue())net.WriteString(m:GetValue())net.WriteString(d.icon)net.WriteString(d.category)net.WriteString(d.type)net.WriteUInt(tonumber(u:GetValue()),32)net.WriteString(util.TableToJSON(d.data))net.WriteUInt(tonumber(x:GetValue()),32)net.WriteUInt(tonumber(s:GetValue()),32)net.SendToServer()AutoDonate.editorMenu:Remove()end end function AutoDonate.OpenEditorItemSearch(c,d,e)local f=vgui.Create("DFrame")f:SetSize(c:GetSize())f:Center()f:SetTitle("Поиск предметов")f:MakePopup()f:SetParent(c)AutoDonate.editorMenu.searcher=f local g=f:Add("DTextEntry")g:Dock(TOP)g:SetUpdateOnType(true)g:SetPlaceholderText("Название предмета или ID")local h=f:Add("DListView")h:SetMultiSelect(false)h:Dock(FILL)h:AddColumn("Название")h:AddColumn("ID")h.DoDoubleClick=function(i,j,k)if d then Derma_StringRequest("Выбор кол-ва | "..k:GetColumnText(1),"Кол-во:",1,function(l)e(k:GetColumnText(2),tonumber(l))end)else e(k:GetColumnText(2))end end g.OnValueChange=function(i,j)j=j:uLower()h:Clear()for k,l in next,ix.item.list do if j==""or string.find(l.name:uLower(),j)or string.find(k:uLower(),j)then h:AddLine(l.name,k)end end end for i,j in next,ix.item.list do h:AddLine(j.name,i)end end kouka.CallPluginMethod("modular_menu","AddMenu","AD Editor",{Init=function(c)local d=c:Add("DListView")d:SetMultiSelect(false)d:Dock(FILL)d:AddColumn("Название")d:AddColumn("Стоимость")d:AddColumn("Скидка")d:AddColumn("Категория")d:AddColumn("Тип")d.DoDoubleClick=function(f,g,h)AutoDonate.OpenItemEditMenu(c,h.itemData)end d.FillByItems=function(f)for g,h in next,AutoDonate.cache do local i=d:AddLine(h.name,h.price,h.discount,h.category,h.type)i.itemData=h i.OnRightClick=function(j)local k=DermaMenu(j)k:AddOption("Редактировать",function()AutoDonate.OpenItemEditMenu(c,h)end):SetImage("icon16/tag_blue_add.png")local l,m=k:AddSubMenu("Удалить")m:SetImage("icon16/link_delete.png")l:AddOption("Подтвердить",function()net.Start("AutoDonate.Data")net.WriteUInt(3,2)net.WriteString(h._id)net.SendToServer()end):SetImage("icon16/delete.png")k:Open()end i:SetAlpha((h.active and 255)or 136)end end c.dListView=d local e=c:Add("DButton")e:SetText("Создать")e:Dock(BOTTOM)e.DoClick=function(f)local g=DermaMenu(f)for h,i in next,AutoDonate.types do g:AddOption(h,function()AutoDonate.OpenItemEditMenu(c,{type=h})end)end g:Open()end d:FillByItems()end,OnUpdate=function(c)c.dListView:Clear()c.dListView:FillByItems()end})