-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local Material=Material local a=net.Receive local LocalPlayer=LocalPlayer local CAMI=CAMI local b=vgui.Create local c=hook.Add local ScrW=ScrW local ScrH=ScrH local d=math.abs local e=math.sin local CurTime=CurTime local ix=ix local Color=Color local f=draw.GetFontHeight local g=game.GetMap local IsValid=IsValid local h=input.IsKeyDown local pairs=pairs local i=surface.SetDrawColor local j=surface.SetMaterial local k=ents.FindInSphere local l=surface.DrawTexturedRect local m=math.Round local n=render.SetColorMaterial local o=render.DrawLine local Vector=Vector local p=ix.plugin.list["artefacts-system"]local q="artefacts_positions"local r=Material('icon16/arrow_in.png')local s=Material('icon16/box.png')a("artefactsOpenAdminMenu",function()local x=LocalPlayer()if not CAMI.PlayerHasAccess(x,"Helix - Artefacts System")then return x:Notify("У вас недостаточно прав.")end ix.gui.artefactsAdminMenu=b("artefacts_AdminMenu")ix.gui.artefactsAdminMenu._tableArtefacts=net.ReadTable()ix.gui.artefactsAdminMenu:InitPanel()end)a("artefactsAdminMenuUpdate",function()local x=LocalPlayer()if not CAMI.PlayerHasAccess(x,"Helix - Artefacts System")then return x:Notify("У вас недостаточно прав.")end local y=ix.gui.artefactsAdminMenu if IsValid(y)then y._tableArtefacts=net.ReadTable()y:InitPanel()x:Notify("Таблица обновлена!")end end)local function t(x,y,z,A,B,C)A=A or"ixSubTitleFont"C=C or 8 B=B or Color(88,88,88,255)surface.SetFont(A)local D,E=surface.GetTextSize(z)local F,G=D+C*2,E+C*2 ix.util.DrawBlurAt(x,y,F,G)surface.SetDrawColor(0,0,0,40)surface.DrawRect(x,y,F,G)derma.SkinFunc("DrawImportantBackground",x,y,F,G,B)surface.SetTextColor(color_white)surface.SetTextPos(x+C,y+C)surface.DrawText(z)return G end hook.Add("HUDPaint",p.uniqueID.."HUDPaint",function()local x=LocalPlayer()if not CAMI.PlayerHasAccess(x,"Helix - Artefacts System",nil)then return end if x.artefactsEditMode==true then local y=x.artefactsCurrent local z=x.artefactsTable local A=ix.item.list[y]local B=32 local C,D=B,B*1.75 D=D+t(C,D,"Редактирование Позиций "..A.name,"ui.Tahoma-10",ix.config.Get("color"))D=D+t(C,D,"ЛКМ - Добавить позицию","ui.Tahoma-7")D=D+t(C,D,"ПКМ - Удалить позицию","ui.Tahoma-7")D=D+t(C,D,"RELOAD (Перезарядка) - Прекратить редактирование","ui.Tahoma-7")D=D+t(C,D,"WALK (ALT) - Включить Wall hack для позиций","ui.Tahoma-7")D=D+t(C,D,"Позиций "..#(z[y]or{}),"ui.Tahoma-7")if h(KEY_LALT)then local E=x:GetPos()for F,G in pairs(z)do if G and istable(G)then for H=1,#G do local I=G[H]local J=Color(200,100,100)local K=I:ToScreen()local L=I:Distance(E)i(J)j(r)local M=k(I,10)for N,O in pairs(M)do local P=O:GetClass()if P~="mz_artefact"then continue end j(s)end l(K.x-8,K.y-16,16,16)L=m((L/17.3),0)ix.util.DrawText(ix.item.list[F]and ix.item.list[F].name or F.." ("..L.." м.)",K.x,K.y,F==y and Color(100,255,100)or Color(200,200,200),TEXT_ALIGN_CENTER,TEXT_ALIGN_TOP,"ui.Tahoma-7",alpha)end end end end end end)hook.Add("PostDrawTranslucentRenderables",p.uniqueID.."PostDrawTranslucentRenderables",function()if bSkybox then return end local x=LocalPlayer()if not CAMI.PlayerHasAccess(x,"Helix - Artefacts System",nil)then return end if x.artefactsEditMode==true then local y=Color(255,255,255)for z,A in next,(x.artefactsTable or{})do if z~=x.artefactsCurrent then y=Color(200,200,200)end if A and istable(A)then for B,C in next,A do render.DrawWireframeBox(C,angle_zero,Vector(5,5,5),Vector(-5,-5,-5),y,not input.IsKeyDown(KEY_LALT))render.DrawLine(C-Vector(0,listSize,0),C+Vector(0,listSize,0),Color(255,0,0),true)render.DrawLine(C-Vector(listSize,0,0),C+Vector(listSize,0,0),Color(0,255,0),true)render.DrawLine(C-Vector(0,0,listSize),C+Vector(0,0,listSize),Color(0,0,255),true)end end end end end)local function u(x,y)y[x.artefactsCurrent]=y[x.artefactsCurrent]or{}local z=x:GetEyeTraceNoCursor()local A=z.HitPos table.insert(y[x.artefactsCurrent],z.HitPos)end local function v(x,y)y[x.artefactsCurrent]=y[x.artefactsCurrent]or{}local z=x:GetEyeTraceNoCursor()local A=z.HitPos for B,C in next,y[x.artefactsCurrent]do if isvector(C)and A:DistToSqr(C)<=50 then table.RemoveByValue(y[x.artefactsCurrent],C)break end end end local function w(x,y)local z=y[x.artefactsCurrent]or{}if table.IsEmpty(z)==true then x.artefactsEditMode=nil x.artefactsTable=nil x.artefactsCurrent=nil return x:Notify("Не чего сохранять позиций нет.")end net.Start("artefactsSavePositions")net.WriteString(x.artefactsCurrent)net.WriteTable(z)net.SendToServer()x.artefactsEditMode=nil x.artefactsTable=nil x.artefactsCurrent=nil end hook.Add("PlayerBindPress",p.uniqueID.."PlayerBindPress.Dungeons.EditModeType",function(x,y,z)local A=LocalPlayer()if CAMI.PlayerHasAccess(A,"Helix - Artefacts System")then if A.artefactsEditMode==true then if((y:find("invnext")or y:find("invprev"))and z)then return true elseif(y:find("attack2")and z)then v(A,A.artefactsTable)return true elseif(y:find("attack")and z)then u(A,A.artefactsTable)return true elseif(y:find("reload")and z)then w(A,A.artefactsTable)return true end end end end)