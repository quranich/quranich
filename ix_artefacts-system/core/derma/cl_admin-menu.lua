-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local istable=istable local isnumber=isnumber local a=net.WriteUInt local type=type local b=table.concat local c=string.PatternSafe local tostring=tostring local tonumber=tonumber local d=net.WriteUInt local LocalPlayer=LocalPlayer local CAMI=CAMI local IsValid=IsValid local ScrW=ScrW local ScrH=ScrH local e=draw.DrawText local f=timer.Simple local PrintTable=PrintTable local Color=Color local ix=ix local g=net.Start local h=net.SendToServer local pairs=pairs local print=print local i=draw.RoundedBox local j=table.Count local DermaMenu=DermaMenu local k=net.WriteString local Derma_StringRequest=Derma_StringRequest local l=vgui.Register local m=table.Copy local n=vgui.Create local o=ix.plugin.list["artefacts-system"]local p={}function p:Init()local q=LocalPlayer()if not CAMI.PlayerHasAccess(q,"Helix - Artefacts System",nil)then q:Notify("У вас недостаточно прав.")self:Remove()return end if IsValid(ix.gui.artefactsAdminMenu)then ix.gui.artefactsAdminMenu:Close()end local r,s=ScrW(),ScrH()local t,u=r*.45,s*.75 self:SetTitle("Система артефактов - меню")self:SetSize(t,u)self:Center()self:MakePopup()ix.gui.artefactsAdminMenu=self self.panelBase=self:Add("EditablePanel")self.panelBase:Dock(FILL)self.panelBase:InvalidateParent(true)end function p:InitLoading(q)self.panelBase:Clear()local r=self.panelBase:Add("EditablePanel")r:Dock(FILL)r.Paint=function(s,t,u)e((q or"Пожалуйста подождите..."),"ui.Tahoma-9",t*.5,u*.5,color_white,TEXT_ALIGN_CENTER)end f(10,function()if IsValid(self)and IsValid(r)then self:Remove()return LocalPlayer():Notify("Ошибка!")end end)end function p:InitPanel()local q=LocalPlayer()local r=self._tableArtefacts self.panelBase:Clear()local s=self.panelBase:Add("EditablePanel")s:Dock(TOP)s:InvalidateParent(true)local t=s:Add("ixMenuButton")t:Dock(LEFT)t:InvalidateParent(true)t:SetContentAlignment(5)t:DockMargin(0,0,0,5)t:SetBackgroundColor(Color(100,100,50))t:SetFont("ui.Tahoma-7")t:SetText("Обновить")t:SizeToContents()t.DoClick=function()if ix.artefacts.HasAccess(q)==true then self:InitLoading("Чтение API ... ")g("artefactsAdminMenuUpdate")h()end end local u=s:Add("ixMenuButton")u:Dock(FILL)u:InvalidateParent(true)u:SetContentAlignment(5)u:DockMargin(0,0,0,5)u:SetBackgroundColor(Color(50,100,50))u:SetFont("ui.Tahoma-7")u:SetText("Создать позицию для артефакта")u:SizeToContents()u.DoClick=function()self:SelectArtefact()end s:InvalidateParent(true)s:SizeToChildren(false,true)local v=self.panelBase:Add("DScrollPanel")v:Dock(FILL)v:InvalidateParent(true)local w=50 for x,y in pairs(r)do local z=ix.item.list[x]if z==nil then print("continue",x)continue end local A=v:Add("DPanel")A:Dock(TOP)A:DockMargin(0,0,0,5)A:DockPadding(5,5,5,5)A:SetTall(w*z.height+10)A:InvalidateParent(true)A:SetHelixTooltip(function(F)F:SetMousePadding(50)ix.stalkerInventory.ModifyTooltip(F)ix.hud.PopulateItemTooltip(F,z)z:Tooltip(F)end)local B=A:Add("EditablePanel")B:Dock(LEFT)B:SetWide(w*z.width)B:SetMouseInputEnabled(false)B.Paint=function(F,G,H)i(w*.15,0,0,G,H,Color(255,255,255,50))ix.stalkerInventory.DrawItemIcon(z,G,H,B)end local C=A:Add("DLabel")C:Dock(LEFT)C:DockMargin(10,0,0,0)C:SetFont("ui.Tahoma-7")C:SetText(z.name)C:SizeToContents()local D=A:Add("DLabel")D:Dock(LEFT)D:DockMargin(10,0,0,0)D:SetFont("ui.Tahoma-6")if y and istable(y)then D:SetText("Количество позиций ("..j(y)..")")D:SetTextColor(Color(200,200,200))D:SizeToContents()elseif y and isnumber(y)then D:SetText("Аномальная зона (UID:"..y..")")D:SetTextColor(Color(200,200,200))D:SizeToContents()end local E=A:Add("ixMenuButton")E:Dock(RIGHT)E:InvalidateParent(true)E:SetContentAlignment(5)E:SetBackgroundColor(Color(50,100,50))E:SetFont("ui.Tahoma-7")E:SetText("Опции")E:SizeToContents()E.DoClick=function()if ix.artefacts.HasAccess(q)==true then local F=DermaMenu()if y and istable(y)then F:AddOption("Изменить позиции для спавна",function()q.artefactsEditMode=true q.artefactsTable=r q.artefactsCurrent=x self:Close()end):SetImage("icon16/anchor.png")elseif y and istable(y)==false then F:AddOption("Изменить аномальную зону",function()Derma_StringRequest("Подтверждение","Введите 'UID' аномальной зоны","",function(G)G=tonumber(G)if G then g("artefactsSetAnomalyZone")k(x)d(G,32)h()end end)end):SetImage("icon16/anchor.png")end F:AddOption("Переспавнить",function()g("artefactsRespawn")k(x)h()end):SetImage("icon16/arrow_in.png")F:AddOption("Очистить позиции спавна",function()Derma_StringRequest("Подтверждение","Введите 'УДАЛИТЬ'","",function(G)if G=="УДАЛИТЬ"then g("artefactsRemovePositions")k(x)h()end end)end):SetImage("icon16/bin.png")F:Open()end end end end function p:SelectArtefact()local q=LocalPlayer()local r=self._tableArtefacts local s=ix.itemsList.data.artefact self.panelBase:Clear()local t=self.panelBase:Add("ixMenuButton")t:Dock(TOP)t:InvalidateParent(true)t:SetContentAlignment(5)t:DockMargin(0,0,0,5)t:SetBackgroundColor(Color(100,50,50))t:SetFont("ui.Tahoma-7")t:SetText("Назад")t:SizeToContents()t.DoClick=function()self:InitPanel()end local u=self.panelBase:Add("DScrollPanel")u:Dock(FILL)u:InvalidateParent(true)local v=self.panelBase:Add("DTextEntry")v:Dock(TOP)v:DockMargin(0,0,0,5)v:InvalidateParent(true)v:SetFont("ui.Tahoma-8")v:SetValue("")v:SetPlaceholderText("Поиск по названию")v:SetCursorColor(color_white)v:SizeToContents()v:SetUpdateOnType(true)v.OnValueChange=function(x,y)u:ReloadList()end local w=50 u.ReloadList=function(x)x:Clear()local y=v:GetValue()y=c(y)local z=y==""for A,B in pairs(s)do local C=ix.item.list[A]if C==nil then print("continue",A)continue end local D=C.GetName and C:GetName()or C.Name if not z and not tostring(D):utf8lower():find(y:utf8lower())then continue end local E=u:Add("DPanel")E:Dock(TOP)E:DockMargin(0,0,0,5)E:DockPadding(5,5,5,5)E:SetTall(w*C.height+10)E:InvalidateParent(true)E:SetHelixTooltip(function(I)I:SetMousePadding(50)ix.stalkerInventory.ModifyTooltip(I)ix.hud.PopulateItemTooltip(I,C)C:Tooltip(I)end)local F=E:Add("EditablePanel")F:Dock(LEFT)F:SetWide(w*C.width)F:SetMouseInputEnabled(false)F.Paint=function(I,J,K)i(w*.15,0,0,J,K,Color(255,255,255,50))ix.stalkerInventory.DrawItemIcon(C,J,K,F)end local G=E:Add("DLabel")G:Dock(LEFT)G:DockMargin(10,0,0,0)G:SetFont("ui.Tahoma-7")G:SetText(D)G:SizeToContents()if C.anomaly then local I=E:Add("DLabel")I:Dock(LEFT)I:DockMargin(10,0,0,0)I:SetFont("ui.Tahoma-7")local J if type(C.anomaly)=="table"then J=b(C.anomaly,", ")else J=C.anomaly end I:SetText("Аномалия: "..J)I:SetTextColor(Color(200,100,100))I:SizeToContents()end local H=E:Add("ixMenuButton")H:Dock(RIGHT)H:InvalidateParent(true)H:SetContentAlignment(5)H:SetBackgroundColor(Color(50,100,50))H:SetFont("ui.Tahoma-7")H:SetText("Выбрать")H:SizeToContents()H.DoClick=function()if ix.artefacts.HasAccess(q)==true then local I=DermaMenu()I:AddOption("Ввести UID Аномальной зоны",function()Derma_StringRequest("Подтверждение","Введите 'UID' аномальной зоны","",function(J)J=tonumber(J)if J then g("artefactsSetAnomalyZone")k(A)d(J,32)h()end end)end):SetImage("icon16/anchor.png")I:AddOption("Выбрать позиции",function()q.artefactsEditMode=true q.artefactsTable=r q.artefactsCurrent=A self:Close()end):SetImage("icon16/arrow_in.png")I:AddOption("Удалить спавн аномалии",function()Derma_StringRequest("Подтверждение","Введите 'УДАЛИТЬ'","",function(J)if J=="УДАЛИТЬ"then g("artefactsRemovePositions")k(A)h()end end)end):SetImage("icon16/bin.png")I:Open()end end end end u:ReloadList()end l("artefacts_AdminMenu",p,"DFrame")if IsValid(ix.gui.artefactsAdminMenu)then local q=m(ix.gui.artefactsAdminMenu._tableArtefacts)ix.gui.artefactsAdminMenu=n("artefacts_AdminMenu")ix.gui.artefactsAdminMenu._tableArtefacts=q ix.gui.artefactsAdminMenu:InitPanel()end