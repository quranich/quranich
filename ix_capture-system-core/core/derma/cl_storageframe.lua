-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local Color=Color local IsValid=IsValid local ScrW=ScrW local ScrH=ScrH local surface=surface local LocalPlayer=LocalPlayer local a=vgui.Create local select=select local b=draw.GetFontHeight local c=math.max local d=math.abs local Vector=Vector local e=net.Start local f=net.WriteString local g=net.WriteUInt local h=net.SendToServer local i=math.sin local RealTime=RealTime local j=draw.RoundedBox local draw=draw local k=math.min local l=surface.SetFont local m=surface.GetTextSize local n=surface.SetMaterial local o=surface.SetDrawColor local p=draw.SimpleText local CurTime=CurTime local q=table.IsEmpty local r=timer.Simple local ipairs=ipairs local s=surface.DrawRect local t=vgui.Register local u=ix.plugin.list["looting-system"]local v=ix.util.GetMaterial("purp/stalker/ui/ui_actor_menu.png")local w=ix.util.GetMaterial("purp/stalker/ui/ui_actor_widescreen_sidepanels.png")local x=ix.util.GetMaterial("purp/stalker/ui/ui_actor_hint_wnd.png")local y=ix.util.GetMaterial("purp/stalker/ui/ui_ingame2_common.png")local z=ix.util.GetMaterial("purp/stalker/ui/inventory/tradeshell.png","smooth")local A=ix.util.GetMaterial("purp/stalker/ui/inventory/safe_frame.png","smooth")local B=ix.util.GetMaterial("purp/stalker/ui/inventory/safe_out.png")local C=ix.util.GetMaterial("purp/stalker/ui/inventory/safe_in.png")local D=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradedone.png","smooth")local E=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradeyes.png","smooth")local F=ix.util.GetMaterial("pp/blurscreen")local G,H,I=Color(57,61,63),Color(82,85,90),Color(87,86,87)local J={}function J:Init()if IsValid(ix.gui.captureStorage)then ix.gui.captureStorage:Remove()end self.currentAlpha=0 self:CreateAnimation(0.1,{index=1,target={currentAlpha=255},Think=function(O,P)P:SetAlpha(P.currentAlpha)end})ix.gui.captureStorage=self self:MakePopup()local K,L=ScrW(),ScrH()self.modifyWidth,self.modifyHeight=K/1920,L/1080 self:SetSize(self.modifyWidth*572,self.modifyHeight*1024)self:AlignLeft(self.modifyWidth*33)self:CenterVertical()self:MakePopup()local M=LocalPlayer()local N=M:GetCharacter()ix.gui.stalkerInventory=a("inventory_stalker.mainframe")ix.gui.stalkerInventory.OnKeyCodeReleased=function(O,P)local Q=O.bindKey if Q~=nil and P==Q then O:Close()end end ix.gui.stalkerInventory.OnClose=function(O)self:Close()end end function J:Setup(K)self.entity=K local L,M=self.modifyWidth,self.modifyHeight local N=K:GetObjectName()local O=0 local P=self:Add("DLabel")P:SetFont("ui.Bahnschrift-s13")P:SetText(N==""and"Хранилище"or N)P:SetTextColor(Color(172,165,157))P:SetPos(L*55,M*70)P:SetSize(L*386,M*45)O=O+b("ui.Bahnschrift-s13")local Q=self:Add("DLabel")Q:SetFont("ui.Bahnschrift-s8")Q:SetText("ЛКМ - один предмет")Q:SetTextColor(Color(100,100,100))Q:SizeToContents()Q:SetPos(L*55,M*(80+O))O=O+b("ui.Bahnschrift-s8")local R=self:Add("DLabel")R:SetFont("ui.Bahnschrift-s8")R:SetText("ПКМ - стак предметов")R:SetTextColor(Color(100,100,100))R:SizeToContents()R:SetPos(L*55,M*(80+O))O=O+b("ui.Bahnschrift-s8")local S=self:Add("DModelPanel")S:SetModel(K:GetModel())S:SetPos(L*365,M*76)S:SetSize(L*156,M*80)S.LayoutEntity=function(Y)end local T=S.Entity if IsValid(T)then local Y,Z=T:GetRenderBounds()local ab=0 ab=c(ab,d(Y.x)+d(Z.x))ab=c(ab,d(Y.y)+d(Z.y))ab=c(ab,d(Y.z)+d(Z.z))S:SetFOV(65)S:SetCamPos(Vector(ab,ab,ab))S:SetLookAt((Y+Z)*0.5)end local U=self:Add("DButton")U:SetFont("ui.Bahnschrift-s11")U:SetText((K.items["money"]or 0).." RUB")U:SetTextColor(Color(188,188,188))U:SetPos(L*55,M*159)U:SetSize(L*320,M*33)U:SetContentAlignment(4)U.OnCursorEntered=function(Y)if K.items["money"]~=nil then Y:SetText("Забрать деньги")end end U.OnCursorExited=function(Y)Y:SetText((K.items["money"]or 0).." RUB")end U.DoClick=function(Y)if K.items["money"]then e("captureSystemStorageTakeItem")f("money")g(K.items["money"],32)h()Y:SetText("0 RUB")K.items["money"]=nil end end U.Paint=function(Y,Z,ab)if K.items["money"]and K.items["money"]>0 then local bb=d(i(RealTime()*2)*150)j((ab*.25),0,0,Z,ab,Color(100,100,100,bb))end end local V=self:Add("DScrollPanel")V:SetPos(L*45,M*213)V:SetSize(L*477,M*702)local W=V:GetVBar()W:SetWide(L*11)W.btnGrip.Paint=function(Y,Z,ab)j(0,0,0,Z,ab,Color(77,77,77))end self.lootingItems=V:Add("DIconLayout")self.lootingItems:Dock(FILL)self.lootingItems.Paint=function(Y,Z,ab)if IsValid(ix.gui.inv1)then local bb=ix.gui.inv1:GetIconSize()local cb=Color(50,50,50,100)if bb then for db=0,Z/bb do j(0,db*bb,0,1,ab,cb)end for db=0,ab/bb do j(0,0,db*bb,Z,1,cb)end end draw.Outline(0,0,Z,ab,cb,1)end end for Y,Z in next,K.items do if Y=="money"then continue end local ab=ix.item.list[Y]local bb=self.lootingItems:Add("ixVendorItem")bb:Setup(Y)bb:SetMouseInputEnabled(true)bb.Paint=function(cb,db,eb)if not ab then return end ix.stalkerInventory.DrawItemIcon(ab,db,eb,cb)local fb=K.items[Y]if fb>1 then fb=k(fb,999)local gb="ui.Tahoma-6"l(gb)local hb="x0"..fb local ib,jb=m(hb)local kb,lb=2,2 ib,jb=ib+10,jb+6 n(y)o(color_white)surface.DrawPartialTexturedRect(kb,lb,ib,jb,864,820,31,18,1024,1024)p("x"..fb,gb,kb+(ib*0.5),lb+(jb*0.5),Color(215,204,186,255),TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)end if(self._nextTake or 0)>CurTime()then j(0,0,0,db,eb,Color(0,0,0,200))end end bb.Think=function(cb)end bb.click.DoRightClick=function(cb)self:TakeItem(K.items,Y,K.items[Y],bb)end bb.click.DoClick=function(cb)self:TakeItem(K.items,Y,1,bb)end self.lootingItems.items=self.lootingItems.items or{}self.lootingItems.items[Y]=bb self.lootingItems:InvalidateLayout()end local X=self:Add("DButton")X:SetFont("ui.Bahnschrift-10")X:SetText("Взять все")X:SetTextColor(Color(245,222,190))X:SetPos(L*213,M*940)X:SetSize(L*144,M*59)X.Paint=function(Y,Z,ab)local bb=Y:IsHovered()surface.SetMaterial(bb and D or E)surface.SetDrawColor(color_white)surface.DrawPartialTexturedRect(0,0,22,ab,0,0,22,57,142,57)surface.DrawPartialTexturedRect(22,0,Z-44,ab,22,0,98,57,142,57)surface.DrawPartialTexturedRect(Z-22,0,22,ab,120,0,22,57,142,57)end X.DoClick=function()if self.lootingItems.items and q(self.lootingItems.items)==false then for Y,Z in next,self.lootingItems.items do Z:Remove()end U:SetText("0 RUB")U:SizeToContents()e("captureSystemStorageTakeAll")h()end r(.25,function()if IsValid(self)then self:Close()end end)end end function J:TakeItem(K,L,M,N)local O=LocalPlayer()if(self._nextTake or 0)>CurTime()then return O:Notify("Необходимо подождать ( чуть медленее )")end self._nextTake=CurTime()+.5 if K[L]==nil then return O:Notify("Предмет не найден в ENTITY")end M=k(M,K[L])K[L]=K[L]-M if K[L]<1 then K[L]=nil N:Remove()end self.entity.items=K e("captureSystemStorageTakeItem")f(L)g(M,32)h()if q(K)then r(.25,function()if IsValid(self)then self:Close()end end)end end function J:Close(K)if not K then e("captureSystemStorageClose")h()end local L=self:GetChildren()for M,N in ipairs(L)do if N.Remove then N:Remove()end end if IsValid(ix.gui.stalkerInventory)then ix.gui.stalkerInventory:Remove()end self:Remove()end function J:Paint(K,L)local M,N=self:LocalToScreen(0,0)local O,P=K,L M,N=M,N+self.modifyHeight*34 O,P=O,P-self.modifyHeight*34 surface.SetMaterial(F)surface.SetDrawColor(255,255,255,255)local Q,R=ScrW(),ScrH()local S,T=M/Q,N/R local U,V=(M+O)/Q,(N+P)/R for X=-0.2,1,0.2 do F:SetFloat("$blur",X*5)F:Recompute()render.UpdateScreenEffectTexture()surface.DrawTexturedRectUV(0,self.modifyHeight*34,O,P,S,T,U,V)end surface.SetMaterial(z)surface.SetDrawColor(color_white)surface.DrawTexturedRect(0,0,K,L)local W=self:GetChildren()for X,Y in ipairs(W)do Y:PaintManual()end end t("captureStorageFrame",J,"Panel")if IsValid(ix.gui.captureStorage)then ix.gui.captureStorage:Close()end