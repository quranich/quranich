-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=ix.plugin.list["capture-system-core"]local b=a.uniqueID local c=ix.util.GetMaterial("models/wireframe")local function d(h,i,j,k,l,m)k=k or"ixSubTitleFont"m=m or 8 l=l or Color(88,88,88,255)surface.SetFont(k)local n,o=surface.GetTextSize(j)local p,q=n+m*2,o+m*2 ix.util.DrawBlurAt(h,i,p,q)surface.SetDrawColor(0,0,0,40)surface.DrawRect(h,i,p,q)derma.SkinFunc("DrawImportantBackground",h,i,p,q,l)surface.SetTextColor(color_white)surface.SetTextPos(h+m,i+m)surface.DrawText(j)return q end hook.Add("HUDPaint",b.."HUDPaint_EditMode",function()local h=LocalPlayer()local i=h.captureSystemEditMode if i==nil then return end if not CAMI.PlayerHasAccess(h,"Helix - "..ix.capturePermission)then return end local j=32 local k,l=j,j*1.75 local m=i.typeEdit if m=="area"then l=l+d(k,l,"Редактирование территории для захвата","ui.Tahoma-10",ix.config.Get("color"))l=l+d(k,l,"ЛКМ - Создать зону","ui.Tahoma-7")l=l+d(k,l,"ПКМ - Удалить зону","ui.Tahoma-7")l=l+d(k,l,"RELOAD (Перезарядка) - Прекратить редактирование ( сохранить )","ui.Tahoma-7")elseif m=="object"then l=l+d(k,l,"Редактирование объекта для захвата","ui.Tahoma-10",ix.config.Get("color"))l=l+d(k,l,"ЛКМ - Выбрать объект","ui.Tahoma-7")l=l+d(k,l,"ПКМ - Удалить объект","ui.Tahoma-7")l=l+d(k,l,"RELOAD (Перезарядка) - Прекратить редактирование ( сохранить )","ui.Tahoma-7")elseif m=="rewardObjects"then l=l+d(k,l,"Редактирование объектов территории","ui.Tahoma-10",ix.config.Get("color"))l=l+d(k,l,"ЛКМ - Выбрать объект","ui.Tahoma-7")l=l+d(k,l,"ПКМ - Удалить объект","ui.Tahoma-7")l=l+d(k,l,"ALT + ПКМ - Очистить все объекты","ui.Tahoma-7")l=l+d(k,l,"RELOAD (Перезарядка) - Прекратить редактирование ( сохранить )","ui.Tahoma-7")for n,o in next,i["data"]do local p=o.pos:ToScreen()ix.util.DrawText(o.name,p.x,p.y,Color(100,255,100),TEXT_ALIGN_CENTER,TEXT_ALIGN_TOP,"ui.Tahoma-7",alpha)end end end)hook.Add("PostDrawTranslucentRenderables",b.."PostDrawTranslucentRenderables_EditMode",function()if bSkybox then return end local h=LocalPlayer()local i=h.captureSystemEditMode if i==nil then return end if not CAMI.PlayerHasAccess(h,"Helix - "..ix.capturePermission)then return end local j=util.TraceLine({start=h:GetShootPos(),endpos=h:GetShootPos()+h:GetForward()*120,filter=h})render.DrawLine(j.HitPos-Vector(5,0,0),j.HitPos+Vector(5,0,0),Color(255,0,0))render.DrawLine(j.HitPos-Vector(0,5,0),j.HitPos+Vector(0,5,0),Color(0,255,0))render.DrawLine(j.HitPos-Vector(0,0,5),j.HitPos+Vector(0,0,5),Color(0,0,255))render.DrawWireframeBox(j.HitPos,angle_zero,Vector(-5,-5,-5),Vector(5,5,5),color_white,true)local k=i.typeEdit if k=="area"then local l,m=(i["data"].startPos or j.HitPos),(i["data"].endPos or j.HitPos)local n,o,p=ix.captureSystem.GetLocalTriggerPosition(l,m)render.DrawWireframeBox(n,angle_zero,o,p,color_white)elseif k=="object"then local l=i["data"].entIndex render.ModelMaterialOverride(c)render.Model({model=i["data"].model,pos=i["data"].pos,angle=i["data"].ang,})render.ModelMaterialOverride()elseif k=="rewardObjects"then for l,m in next,i["data"]do render.ModelMaterialOverride(c)render.Model({model=m.model,pos=m.pos,angle=m.ang,})render.ModelMaterialOverride()end end end)local function e(h,i)if i then local j=i.typeEdit local k=util.TraceLine({start=h:GetShootPos(),endpos=h:GetShootPos()+h:GetForward()*120,filter=h})if j=="area"then if i["data"].endPos then i["data"]={}end if i["data"].startPos then i["data"].endPos=k.HitPos else i["data"].startPos=k.HitPos end elseif j=="object"then local l=k.Entity if IsValid(l)and l:GetClass()=="prop_physics"then i["data"].entIndex=l:EntIndex()i["data"].model=l:GetModel()i["data"].pos=l:GetPos()i["data"].ang=l:GetAngles()else h:Notify("Разрешено выбирать только проп!")end elseif j=="rewardObjects"then local l=k.Entity if IsValid(l)and l:GetClass()=="prop_physics"then local m=l:EntIndex()if table.HasValue(i["data"],m)then return h:Notify("Объект уже добавлен!")end Derma_StringRequest("Название объекта","Введите 'Название объекта'","Объект территории",function(n)Derma_StringRequest("Количество здоровья","Введите 'Количество здоровья'","1000",function(o)table.insert(i["data"],{name=n,health=tonumber(o)and o or 100,entIndex=l:EntIndex(),model=l:GetModel(),pos=l:GetPos(),ang=l:GetAngles(),})h:Notify("Объект добавлен!")end)end)else h:Notify("Разрешено выбирать только проп!")end end end end local function f(h,i)if i then local j=i.typeEdit if j=="area"then i["data"]={}elseif j=="object"then i["data"].entIndex=nil i["data"].model=nil i["data"].pos=nil i["data"].ang=nil elseif j=="rewardObjects"then local k=h:GetEyeTraceNoCursor()if input.IsKeyDown(KEY_LALT)then i["data"]={}return end for l,m in next,i["data"]do if isvector(m.pos)and k.HitPos:DistToSqr(m.pos)<=5000 then table.RemoveByValue(i["data"],m)break end end end end end local function g(h,i)if i then local j=i.typeEdit if j=="object"then if i["data"].entIndex==nil and i["data"].pos then h.captureSystemEditMode=nil h:Notify("Изменения не внесены!")return end end net.Start("captureSystemEditModeSave")net.WriteTable(i)net.SendToServer()h.captureSystemEditMode=nil h:Notify("Редактирование завершено!")end end hook.Add("PlayerBindPress",b.."PlayerBindPress_EditMode",function(h,i,j)local k=LocalPlayer()local l=k.captureSystemEditMode if l then if CAMI.PlayerHasAccess(k,"Helix - "..ix.capturePermission)then if((i:find("invnext")or i:find("invprev"))and j)then return true elseif(i:find("attack2")and j)then f(k,l)return true elseif(i:find("attack")and j)then e(k,l)return true elseif(i:find("reload")and j)then g(k,l)return true end end end end)