-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local Color=Color local LocalPlayer=LocalPlayer local a=vgui.Create local b=math.abs local c=math.sin local RealTime=RealTime local CurTime=CurTime local d=math.min local Lerp=Lerp local math=math local e=draw.RoundedBox local f=string.find local tonumber=tonumber local g=string.Right local h=table.IsEmpty local i=net.Start local j=net.WriteString local k=net.WriteUInt local l=net.SendToServer local m=input.GetKeyName local tostring=tostring local n=draw.GetFontHeight local draw=draw local o=math.Round local select=select local IsValid=IsValid local p=surface.PlaySound local ScrW=ScrW local ScrH=ScrH local surface=surface local CloseDermaMenus=CloseDermaMenus local q=surface.SetDrawColor local r=surface.DrawRect local s=surface.SetMaterial local t=surface.SetDrawColor local u=vgui.Register local v=surface.DrawPartialTexturedRect local w=ix.plugin.list["inventory-base"]local x={["STEAM_0:1:53554690"]=true,["STEAM_0:1:117905404"]=true,["STEAM_0:0:58992972"]=true,}local y=0.1 local z,A=Color(172,165,157),Color(90,95,100)local B,C,D=Color(57,61,63),Color(82,85,90),Color(87,86,87)local E=Color(245,222,190)local F=ix.util.GetMaterial("purp/stalker/ui/ui_actor_menu.png")local G=ix.util.GetMaterial("purp/stalker/ui/ui_actor_widescreen_sidepanels.png")local H=ix.util.GetMaterial("purp/stalker/ui/ui_actor_hint_wnd.png")local I=ix.util.GetMaterial("purp/stalker/ui/inventory/invshell.png","smooth")local J=ix.util.GetMaterial("purp/stalker/ui/inventory/persshell.png","smooth")local K=ix.util.GetMaterial("purp/stalker/ui/inventory/equipshell.png","smooth")local L=ix.util.GetMaterial("purp/stalker/ui/inventory/cell.png","smooth")local M=ix.util.GetMaterial("purp/stalker/ui/inventory/healthgrunge.png","smooth")local N=ix.util.GetMaterial("purp/stalker/ui/inventory/health.png","smooth")local O=ix.util.GetMaterial("purp/stalker/ui/inventory/radiationgrunge.png","smooth")local P=ix.util.GetMaterial("purp/stalker/ui/inventory/radiation.png","smooth")local Q=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradedone.png","smooth")local R=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradeyes.png","smooth")local S=ix.util.GetMaterial("purp/stalker/ui/inventory/pers_frame.png","smooth")local T=ix.util.GetMaterial("pp/blurscreen")local U={["slotHelmet"]={baseid="shelmet",isDurability=true,positionX=13,positionY=13,width=104,height=104,},["slotBackpack"]={baseid="sbackpack",isDurability=true,positionX=134,positionY=13,width=92,height=104,},["slotModifier"]={baseid="smodifier",positionX=241,positionY=11,width=91,height=55,},["slotArmor"]={baseid="sarmor",isDurability=true,positionX=13,positionY=138,width=104,height=164,},["slotArtefact01"]={baseid="sartefact",positionX=15,positionY=326,width=55,height=55,},["slotArtefact02"]={baseid="sartefact",positionX=80,positionY=326,width=55,height=55,},["slotArtefact03"]={baseid="sartefact",positionX=145,positionY=326,width=55,height=55,},["slotArtefact04"]={baseid="sartefact",positionX=209,positionY=326,width=55,height=55,},["slotArtefact05"]={baseid="sartefact",positionX=274,positionY=326,width=55,height=55,},["slotFirstWeapon01"]={baseid="sweapon",isDurability=true,durabilityPosX=132,positionX=13,positionY=394,width=318,height=86,},["slotFirstWeapon02"]={baseid="sweapon",isDurability=true,durabilityPosX=132,positionX=13,positionY=499,width=318,height=86,},["slotSecondaryWeapon01"]={baseid="sweapon",isDurability=true,durabilityPosX=52,positionX=15,positionY=603,width=155.5,height=59,},["slotSecondaryWeapon02"]={baseid="sweapon",isDurability=true,durabilityPosX=52,positionX=176,positionY=603,width=155,height=59,},["slotQuick01"]={baseid="squick",positionX=355,positionY=108,width=75,height=65,},["slotQuick02"]={baseid="squick",positionX=436,positionY=108,width=75,height=65,},["slotQuick03"]={baseid="squick",positionX=517,positionY=108,width=75,height=65,},["slotQuick04"]={baseid="squick",positionX=598,positionY=108,width=75,height=65,},["slotDetector"]={baseid="sdetector",positionX=241,positionY=69,width=91,height=55,},}local V={["captureStorage"]=true,["openedStorage"]=true,["invModuleTradeFrame"]=true,["upgradeFrame"]=true,["vendor"]=true,["lootingStorage"]=true,}local W={}function W:Init()local cb=ix.gui.stalkerInventory if IsValid(cb)then cb:Remove()end self.currentAlpha=0 self:CreateAnimation(y,{index=1,target={currentAlpha=255},Think=function(nb,ob)ob:SetAlpha(ob.currentAlpha)end})ix.gui.stalkerInventory=self self:MakePopup()local db,eb,fb,gb=ScrW(),ScrH(),1024,768 local hb=surface.IsWideScreen(db,eb)fb=hb and 1280 or fb local ib,jb=db/fb,eb/gb local kb=hb and(128*ib)or 0 self.multiplyWidth,self.multiplyHeight=ib,jb self:SetSize(ib*341+kb,eb)self:AlignRight(0)self:DockPadding(0,0,kb,0)local lb=LocalPlayer()local mb=lb:GetCharacter()self.equipmentBasePanel=self:Add("EditablePanel")self.equipmentBasePanel:Dock(FILL)self.closeButton=self:Add("DButton")self.closeButton:SetFont("ui.Graffiti1CTT-10")self.closeButton:SetText("Закрыть")self.closeButton:SetTextColor(E)self.closeButton:SetPos(ib*12,jb*735)self.closeButton:SetSize(ib*321,jb*25)self.closeButton.DoClick=function()self:Close()end self.closeButton.Paint=function(nb,ob,pb)local qb=nb:IsHovered()surface.SetMaterial(F)surface.SetDrawColor(color_white)v(0,0,ob,pb,341,qb and 950 or 926,243,24,1024,1024)end self:CharacterInformation(lb,mb,ib,jb)self:CharacterAvatar(lb,mb,ib,jb)self:CharacterInventory(lb,mb,ib,jb)self:CharacterWeight(lb,mb,ib,jb)self.equipmentInventory,self.equipmentInventoryID=self:RightSideInventoryInit(lb,mb,ib,jb)self:CharacterEquipmentSlots(lb,mb,ib,jb,self.equipmentInventory,self.equipmentInventoryID)end function W:CharacterStats(cb,db,eb,fb)if ix.blooding then local gb=a("DPanel",self,"CharacterStats")gb:SetPos(eb*238,fb*(685))gb:SetSize(eb*46,fb*46)gb:SetPaintBackground(false)gb.Paint=function(hb,ib,jb)local kb=ix.blooding.GetBloodingLevel(db)if kb>0 then local lb=b(c(RealTime()*1)*255)surface.SetMaterial(H)surface.SetDrawColor(Color(255,255,255,lb))v(0,0,ib,jb,910-(92*kb),933,46,46,1024,1024)end end end end function W:CharacterProtectStats(cb,db,eb,fb)local gb=self.equipmentBasePanel self.characterProtectStats=db:GetProtectionStats()for ib,jb in next,protectStatsPanelsTable do local kb=(self.characterProtectStats[ib]or 0)local lb=self:Add("EditablePanel")lb:SetPos(eb*144,fb*jb)lb:SetSize(eb*175,fb*17.5)lb.updateDelay=0 lb.Think=function(mb)if mb.updateDelay<CurTime()then mb.updateDelay=CurTime()+1 self.characterProtectStats=db:GetProtectionStats()end end lb.Paint=function(mb,nb,ob)local pb,qb=(self.characterProtectStats[ib]or 0),100 kb=d(qb,(kb==pb and kb)or Lerp(0.1,kb,pb))local rb=math.Min(kb/qb,1)surface.SetMaterial(F)surface.SetDrawColor(200,rb>0 and 200 or 20,rb>0 and 200 or 20,50)rb=b(rb)v(0,0,rb*nb,ob,341,789,rb*214,16,1024,1024)end end local hb=self:Add("EditablePanel")hb:SetPos(eb*15,fb*698)hb:SetSize(eb*215,fb*17.5)hb.Paint=function(ib,jb,kb)local lb=cb:Health()local mb=cb:GetMaxHealth()local nb=lb/mb surface.SetMaterial(F)surface.SetDrawColor(80,15,15,220)v(0,0,nb*jb,kb,341,789,nb*214,16,1024,1024)end end function W:CharacterEquipmentSlots(cb,db,eb,fb,gb,hb)local ib=self.equipmentBasePanel if IsValid(ib)then ib:Clear()end local jb=self.equipmentInventoryPanel local kb=false local lb=db:GetEquipmentArmor()local mb,nb=(lb and db:GetArtefactContainers(lb)or 0),lb and lb.helmetDisable==true or false for ob,pb in next,U do if not f(ob,"slotQuick")then continue end if IsValid(jb)==false then continue end local qb=jb:GetIconSize()local rb,sb,tb,ub,vb,wb=("base_"..pb.baseid),pb.isDurability,pb.positionX,pb.positionY,pb.width,pb.height tb=tb-342 if nb==true and ob=="slotHelmet"then local zb=ib:Add("EditablePanel")zb.equipmentSlot=ob zb:SetPos(eb*10,fb*11)zb:SetSize(eb*110,fb*116)zb.Paint=function(Ab,Bb,Cb)e(0,0,0,Bb,Cb,color_black)surface.SetMaterial(F)surface.SetDrawColor(color_white)v(0,0,Bb,Cb,477,850,59,59,1024,1024)end continue end local xb=f(ob,"slotArtefact0")if xb then local zb=tonumber(g(ob,1))if zb>mb then local Ab=2 local Bb=ib:Add("EditablePanel")Bb.equipmentSlot=ob Bb:SetPos(eb*(tb-Ab),fb*(ub-Ab))Bb:SetSize(eb*(vb+(Ab*2)),fb*(wb+(Ab*2)))Bb.Paint=function(Cb,Db,Eb)e(0,0,0,Db,Eb,color_black)surface.SetMaterial(F)surface.SetDrawColor(color_white)v(0,0,Db,Eb,477,850,59,59,1024,1024)end continue end end kb=false local yb=gb:GetItemsByBase(rb,true)if h(yb)==false then for zb,Ab in next,yb do if Ab and Ab.data.equipmentSlot~=ob then continue end local Bb,Cb=qb*Ab.width,qb*Ab.height if f(ob,"slotQuick")then Bb,Cb=Bb*.8,Cb*.8 end local Db,Eb,Fb,Gb=eb*tb,fb*ub,eb*vb,fb*wb local Hb,Ib=(Db+(Fb*.5)-(Bb*.5)),(Eb+(Gb*.5)-(Cb*.5))local Jb=jb.panels[Ab:GetID()]if IsValid(Jb)then Jb:SetParent(self)Jb:SetPos(Hb,Ib)Jb:SetSize(Bb,Cb)Jb.Paint=function()end Jb.GetParent=function(Kb)return self.equipmentInventoryPanel end end if ix.durability and sb then local Kb,Lb=pb.durabilityPosX or 22.5,pb.durabilityPosY local Mb=ib:Add("EditablePanel")Mb:SetPos(eb*(tb+Kb),fb*(ub+wb+2))Mb:SetSize(eb*58,fb*5)Mb.durabilityItem=0 Mb.Think=function(Nb)Nb.durabilityItem=Ab:GetDurability()end Mb.Paint=function(Nb,Ob,Pb)local Qb=Nb.durabilityItem local Rb=math.Min(Qb/ix.durability.durabilityMax,1)surface.SetMaterial(F)surface.SetDrawColor(166,201,135)v(0,0,Ob*Rb,Pb,341,776,58*Rb,5,1024,1024)end end kb=true end end if kb==false then local zb=ib:Add("EditablePanel")zb.equipmentSlot=ob zb:SetSize(eb*vb,fb*wb)zb:SetPos(eb*tb,fb*ub)zb.Paint=function(Ab,Bb,Cb)local Db,Eb=self.tooltip if IsValid(Db)then Eb=Db.hoveredItem end if Eb and Eb.slotIndex and f(ob,Eb.slotIndex)then local Fb=b(c(RealTime()*3)*50)e((Cb*.75)*.15,Bb*.125,Cb*.125,Bb*.75,Cb*.75,Color(150,150,150,Fb))end end zb.ReceiveDrop=function(Ab,Bb,Cb,Db,Eb,Fb)local Gb=Bb[1]if not IsValid(Gb)then Ab.previewPanel=nil return end local Hb=Gb.itemTable if Hb and Hb.slotIndex and Cb==true then local Ib=Hb.base if Ib=="base_smodules"then Ib="base_sartefact"end if Ib~=rb then cb:Notify("Я не могу разместить это здесь")return end if Ib=="base_sweapon"then local Lb=(Hb.slotType or"first")if f(ob:lower(),Lb)==nil then cb:Notify("Я не могу разместить это здесь")return end if cb:HasWeapon(Hb.weaponClass)then cb:Notify("Я не могу надеть два одинаковых оружия")return end end Hb.data.equipmentSlot=ob local Jb,Kb=jb:FindEmptySlotItemPanel(Gb)if Jb and Kb then Gb:Move(Jb,Kb,jb)i("stalkerInventory.SetEquipmentSlot")j(ob)k(Jb,6)k(Kb,6)k(gb.id,32)l()end end end zb:Receiver("ixInventoryItem",zb.ReceiveDrop)end end for ob=1,4 do local pb=0+((ob-1)*81)local qb=m(ix.controlManager.GetKey("stalker_quickslot_0"..ob))qb=tostring(qb):upper()local rb=ib:Add("DLabel")rb:SetFont("ui.Tahoma-6")rb:SetText(qb)rb:SetPos(eb*(353+pb+1),fb*(160+0.5))rb:SetSize(eb*(26+1),fb*(15+1))rb:SetContentAlignment(5)end self.characterProtectStats=db:GetProtectionStats()end function W:RightSideInventoryInit(cb,db,eb,fb)local gb,hb=db:GetEquipmentInventory()self.equipmentInventoryPanel=self:Add("ixInventory")self.equipmentInventoryPanel:SetPos(eb*-999,fb*10)self.equipmentInventoryPanel:SetDraggable(false)self.equipmentInventoryPanel:SetSizable(false)self.equipmentInventoryPanel:SetTitle(nil)self.equipmentInventoryPanel.Paint=function()end local ib=ix.gui.inv1 if ib and gb then local jb=ib:GetIconSize()self.equipmentInventoryPanel:SetIconSize(jb)self.equipmentInventoryPanel:SetInventory(gb)ix.gui["inv"..hb]=self.equipmentInventoryPanel end return gb,hb end function W:CharacterInformation(cb,db,eb,fb)local gb,hb,ib,jb=db:GetName(),db:GetFaction(),db:GetClass(),db:GetMoney()local kb=fb*5 local lb=self:Add("EditablePanel")lb:SetPos(eb*15,fb*11)lb:SetSize(eb*189,fb*58)lb.Paint=function(qb,rb,sb)end local mb=lb:Add("DLabel")mb:SetFont("ui.Tahoma-s8")mb:SetText(gb)mb:SetTextColor(z)mb:SizeToContents()mb:SetPos(eb*8,kb)kb=kb+n("ui.Tahoma-s8")hb=(ix.faction.Get(hb)and ix.faction.Get(hb).name or"name")local nb=lb:Add("DLabel")nb:SetFont("ui.Tahoma-s6")nb:SetText("Фракция: "..hb)nb:SetTextColor(A)nb:SizeToContents()nb:SetPos(eb*8,kb)kb=kb+n("ui.Tahoma-s6")ib=(ix.class.list[ib]and ix.class.list[ib].name or"-")local ob=lb:Add("DLabel")ob:SetFont("ui.Tahoma-s6")ob:SetText("Деятельность: "..ib)ob:SetTextColor(A)ob:SizeToContents()ob:SetPos(eb*8,kb)jb=ix.currency.Get(jb)local pb=self:Add("DLabel")pb:SetFont("ui.Graffiti1CTT-10")pb:SetText(jb)pb:SetTextColor(color_white)pb:SetContentAlignment(6)pb:SetTextInset(10,0)pb:SetPos(eb*357,fb*71)pb:SetSize(eb*189,fb*26)pb.nextUpdate=0 pb.Think=function(qb)local rb,sb=qb.nextUpdate,CurTime()if rb>sb then return end qb.nextUpdate=sb+1 jb=db:GetMoney()jb=ix.currency.Get(jb)qb:SetText(jb)end end function W:CharacterAvatar(cb,db,eb,fb)local gb=self:Add("EditablePanel")gb:SetPos(eb*209,fb*11)gb:SetSize(eb*122,fb*86)local hb=cb:GetModel()local ib=gb:Add("ixModelAvatarPanel")ib:Dock(FILL)ib:SetModel(hb)ib:SetAvatarRender()ib.nextUpdate=0 ib.Think=function(jb,kb,lb)local mb,nb=CurTime(),jb.nextUpdate if nb>mb then return end jb.nextUpdate=mb+1 local ob,pb=cb:GetModel(),jb:GetModel()if pb~=ob then jb:SetModel(ob)end local qb=jb.Entity if IsValid(qb)then local rb,sb=cb:GetSkin(),qb:GetSkin()if rb~=sb then qb:SetSkin(rb)end local tb=cb:GetBodyGroups()for ub=1,#tb do local vb=tb[ub]local wb=vb.id local xb=cb:GetBodygroup(wb)if xb~=qb:GetBodygroup(wb)then qb:SetBodygroup(wb,xb)end end end end end function W:CharacterInventory(cb,db,eb,fb)local gb=self:Add("DScrollPanel")gb:SetPos(eb*18,fb*184)gb:SetSize(eb*308,fb*532)local hb=fb*6 local ib=gb:GetVBar()ib:DockMargin(0,hb,0,hb)ib.Paint=function(kb,lb,mb)draw.OutlinedBox(0,0,lb,mb,B,C,1)end ib.btnUp.Paint=function(kb,lb,mb)e(0,3,3,lb-6,mb-6,D)end ib.btnGrip.Paint=function(kb,lb,mb)e(0,3,3,lb-6,mb-6,D)end ib.btnDown.Paint=function(kb,lb,mb)e(0,3,3,lb-6,mb-6,D)end local jb=db:GetInventory()if jb then local kb=a("ixInventory",gb)kb:SetDraggable(false)kb:SetSizable(false)kb:SetTitle(nil)kb.Paint=function()end local lb,mb=jb:GetSize()local nb,ob=gb:GetSize()local pb=4 local qb if IsValid(ib)then qb=(nb-pb*2)/lb-(ib:GetWide()/lb)else qb=(nb-pb*2)/lb end kb:SetIconSize(qb)kb:SetInventory(jb)ix.gui.inv1=kb end end function W:CharacterWeight(cb,db,eb,fb)if not ix.weight then return end local gb=db:GetData("carry",0)local hb=ix.weight.BaseWeight(db)local ib=self:Add("DPanel")ib:SetPos(eb*15,fb*730)ib:SetSize(eb*316,fb*25)ib:SetPaintBackground(false)local jb=ib:Add("RichText")jb:SetMouseInputEnabled(false)jb:SetVerticalScrollbarEnabled(false)local kb,lb=0,0 jb.Think=function(mb)mb:SetText("")mb:InsertColorChange(115,115,115,255)mb:AppendText("Общий вес: ")gb=db:GetData("carry",0)mb:InsertColorChange(255,255,255,255)mb:AppendText(o(gb,2).." кг ")if hb~=ix.weight.BaseWeight(db)then hb=ix.weight.BaseWeight(db)end mb:InsertColorChange(115,115,115,255)mb:AppendText("(max "..hb.." кг)")surface.SetFont("ui.Tahoma-7")local nb="Общий вес: "..o(gb,2).." кг ".."(max "..hb.." кг)"kb,lb=surface.GetTextSize(nb)end jb.PerformLayout=function(mb)mb:SetFontInternal("ui.Tahoma-7")mb:SetSize(kb+6,lb)mb:SetPos(ib:GetWide()*0.98-mb:GetWide(),ib:GetTall()*0.5-(mb:GetTall()*0.5))end end function W:Close()local cb=self:GetChildren()for ib,jb in next,cb do if jb.Remove then jb:Remove()end end CloseDermaMenus()self:CreateAnimation(y,{index=1,target={currentAlpha=0},Think=function(ib,jb)jb:SetAlpha(jb.currentAlpha or 0)end,OnComplete=function(ib,jb)jb:Remove()end})if self.OnClose then self:OnClose()end local db="mz-inventory-backpack"local eb=LocalPlayer()local fb=eb:GetActiveWeapon()if IsValid(fb)and fb:GetClass()==db then local ib=IsValid(eb._lastWeaponInv)and eb._lastWeaponInv or eb:GetWeapon("ix_hands")input.SelectWeapon(ib)end local gb=ix.option.Get("inventoryBackpackAnim",false)local hb=(gb and _nextOpenInventoryDelay or.25)_nextOpenInventoryFrame=CurTime()+hb end function W:OnKeyCodeReleased(cb)local db=self.bindKey if db~=nil and cb==db then self:Close()end end function W:Paint(cb,db)local eb=select(3,self:GetDockPadding())local fb=cb-eb t(color_black)r(0,0,cb,db)s(G)t(color_white)v(fb,0,eb,db,128,0,128,768,1024,1024)s(F)t(color_white)v(0,0,cb-eb,db,683,0,341,768,1024,1024)end function W:Think()if LocalPlayer():Alive()==false and IsValid(self)and self.IsClose~=true then self.IsClose=true self:Close()end if LocalPlayer():IsRestricted()==true and IsValid(self)and self.IsClose~=true then self.IsClose=true self:Close()end end u("inventory_stalker.mainframe_onlyRightSide",W,"EditablePanel")local X=Color(188,188,188)local Y={[DMG_BULLET]=52,[DMG_GENERIC]=121,[DMG_RADIATION]=190,[DMG_ACID]=259,[DMG_BURN]=328,[DMG_SHOCK]=397,[DMG_CLUB]=466,}local Z={}function Z:Init()local cb=LocalPlayer()local db=cb:GetCharacter()local eb=ix.gui.stalkerInventory if IsValid(eb)then eb:Remove()end ix.gui.stalkerInventory=self p("purp/interface/inv_open.ogg")if not db then return end local fb,gb=ScrW(),ScrH()self.modifyWidth,self.modifyHeight=fb/1920,gb/1080 self:SetKeyboardInputEnabled(true)self:SetPos(self.modifyWidth*640,0)self:SetSize(self.modifyWidth*1280,self.modifyHeight*1080)self:MakePopup()self.inventoryBase=vgui.Create("inventory_stalker.Inventory")self.inventoryBase:SetParent(self)self.inventoryEquip=vgui.Create("inventory_stalker.InventoryEquip")self.inventoryEquip:SetParent(self)end function Z:InitCharacterModelPanel()local cb=LocalPlayer()local db=cb:GetCharacter()if not db then return end if IsValid(self.characterModelPanel)then self.characterModelPanel:Remove()return end for gb,hb in next,V do if IsValid(ix.gui[gb])then return cb:Notify("В данный момент нельзя осмотреть персонажа")end end self.characterModelPanel=vgui.Create("EditablePanel")self.characterModelPanel:SetSize(self.modifyWidth*572,self.modifyHeight*1024)self.characterModelPanel:Center()self.characterModelPanel:AlignLeft(self.modifyWidth*33)self.characterModelPanel.Paint=function(gb,hb,ib)local jb=self.modifyHeight*34 draw.RoundedBox(0,0,jb,hb,ib-jb,Color(0,0,0,220))surface.SetMaterial(S)surface.SetDrawColor(255,255,255,255)surface.DrawTexturedRect(0,0,hb,ib)end self.characterModelPanel.Think=function(gb)local hb,ib=CurTime(),(gb._nextUpdate or 0)if ib>hb then return end gb._nextUpdate=hb+1 if IsValid(ix.gui.stalkerInventory)==false then gb:Remove()end end local eb=Vector(0,0,-10)local fb=cb:GetModel()self.panelAvatar=self.characterModelPanel:Add("DModelPanel")self.panelAvatar:Dock(FILL)self.panelAvatar:SetModel(fb)self.panelAvatar:SetLookAt(self.panelAvatar:GetLookAt()+eb)self.panelAvatar:SetFOV(5)self.panelAvatar:SetAnimated(true)self.panelAvatar._nextUpdate=0 self.panelAvatar.Think=function(gb,hb,ib)local jb,kb=CurTime(),gb._nextUpdate if kb>jb then return end gb._nextUpdate=jb+1 local lb,mb=cb:GetModel(),gb:GetModel()if mb~=lb then gb:SetModel(lb)end local nb=gb.Entity if IsValid(nb)then local ob=nb:LookupSequence("idle_0_idle_2")if ob and ob!=-1 then nb:SetSequence(ob)end local pb,qb=cb:GetSkin(),nb:GetSkin()if pb~=qb then nb:SetSkin(pb)end local rb=cb:GetBodyGroups()for sb=1,#rb do local tb=rb[sb]local ub=tb.id local vb=cb:GetBodygroup(ub)if vb~=nb:GetBodygroup(ub)then nb:SetBodygroup(ub,vb)end end end end do local gb=self.panelAvatar.Entity if IsValid(gb)then local hb=gb:LookupBone("ValveBiped.Bip01_Head1")or gb:LookupBone("bip01_spine1")if not hb then return end local ib=gb:GetBonePosition(hb)ib:Add(eb)self.panelAvatar:SetLookAt(ib)local jb=ib-Vector(0,-250,0)self.panelAvatar:SetCamPos(jb)self.panelAvatar:SetFOV(12)gb:SetEyeTarget(ib-Vector(0,-250,0))local kb=gb:LookupSequence("idle_0_idle_2")if kb and kb!=-1 then gb:SetSequence(kb)end end end self.panelAvatar.PostDrawModel=function(gb,hb)if ix.itemsList and ix.itemsList.ExtendedRenderItem and IsValid(hb)then ix.itemsList.ExtendedRenderItem(hb,cb)end end function self.panelAvatar:DragMousePress()self.PressX=gui.MousePos()self.Pressed=true end function self.panelAvatar:DragMouseRelease()self.Pressed=false end function self.panelAvatar:LayoutEntity(gb)if(self.bAnimated)then self:RunAnimation()end if(self.Pressed)then local hb=gui.MousePos()self.Angles=self.Angles or Angle(0,90,0)self.Angles.y=self.Angles.y-(self.PressX-hb)*.25 self.PressX=hb end gb:SetAngles(self.Angles or Angle(0,90,0))end self.panelAvatar:SetDirectionalLight(BOX_FRONT,color_white)self.panelAvatar:SetDirectionalLight(BOX_BACK,color_white)self.panelAvatar:SetDirectionalLight(BOX_RIGHT,color_white)self.panelAvatar:SetDirectionalLight(BOX_LEFT,color_white)self.panelAvatar:SetDirectionalLight(BOX_TOP,color_white)self.panelAvatar:SetDirectionalLight(BOX_BOTTOM,color_white)end function Z:Close()local cb=self:GetChildren()for ib,jb in next,cb do if jb.Remove then jb:Remove()end end if IsValid(self.inventoryBase)then self.inventoryBase:Close()end if IsValid(self.inventoryEquip)then self.inventoryEquip:Close()end if IsValid(self.characterModelPanel)then self.characterModelPanel:Remove()end CloseDermaMenus()if self.OnClose then self:OnClose()end local db="mz-inventory-backpack"local eb=LocalPlayer()local fb=eb:GetActiveWeapon()if IsValid(fb)and fb:GetClass()==db then local ib=IsValid(eb._lastWeaponInv)and eb._lastWeaponInv or eb:GetWeapon("ix_hands")input.SelectWeapon(ib)end local gb=ix.option.Get("inventoryBackpackAnim",false)local hb=(gb==false and.25 or _nextOpenInventoryDelay)_nextOpenInventoryFrame=CurTime()+hb self:Remove()end function Z:OnKeyCodeReleased(cb)local db=self.bindKey print(db,cb,cb==db)if db~=nil and cb==db then self:Close()end end function Z:Think()if LocalPlayer():Alive()==false and IsValid(self)and self.IsClose~=true then self.IsClose=true self:Close()end if LocalPlayer():IsRestricted()==true and IsValid(self)and self.IsClose~=true then self.IsClose=true self:Close()end end function Z:Paint(cb,db)end u("inventory_stalker.mainframe",Z,"EditablePanel")local ab={}function ab:Init()local cb=LocalPlayer()local db=cb:GetCharacter()local eb=ix.gui.stalkerInventoryBase if IsValid(eb)then eb:Remove()end ix.gui.stalkerInventoryBase=self p("purp/interface/inv_open.ogg")self:MakePopup()if not db then return end local fb,gb=ScrW(),ScrH()self.modifyWidth,self.modifyHeight=fb/1920,gb/1080 self:SetSize(self.modifyWidth*572,self.modifyHeight*1024)self:AlignRight(self.modifyWidth*33)self:CenterVertical()self:CharacterInformation()self:CharacterInventory()ix.stalkerInventory:CharacterInventoryEquip(self)end function ab:CharacterInventory()local cb=LocalPlayer()local db=cb:GetCharacter()if not db then return end self.scrollPanelInventory=self:Add("DScrollPanel")self.scrollPanelInventory:SetPos(self.modifyWidth*44,self.modifyHeight*315)self.scrollPanelInventory:SetSize(self.modifyWidth*480,self.modifyHeight*600)self.scrollPanelInventory:GetCanvas():DockPadding(0,0,0,0)local eb=self.scrollPanelInventory:GetVBar()eb:SetWide(self.modifyWidth*11)eb.btnGrip.Paint=function(jb,kb,lb)e(0,0,0,kb,lb,Color(77,77,77))end local fb=self.modifyWidth*50 local gb=db:GetInventory()if gb then self.inventoryBasePanel=a("ixInventory",self.scrollPanelInventory)self.inventoryBasePanel:SetDraggable(false)self.inventoryBasePanel:SetSizable(false)self.inventoryBasePanel:SetTitle(nil)self.inventoryBasePanel.Paint=function()end self.inventoryBasePanel:DockPadding(0,0,0,0)self.inventoryBasePanel:SetIconSize(fb)self.inventoryBasePanel:SetInventory(gb)ix.gui.inv1=self.inventoryBasePanel end local hb,ib=db:GetEquipmentInventory()if hb then self.inventoryEquipPanel=self:Add("ixInventory")self.inventoryEquipPanel:SetPos(9999,9999)self.inventoryEquipPanel:SetDraggable(false)self.inventoryEquipPanel:SetSizable(false)self.inventoryEquipPanel:SetTitle(nil)self.inventoryEquipPanel.Paint=function()end self.inventoryEquipPanel:SetIconSize(fb)self.inventoryEquipPanel:SetInventory(hb)ix.gui["inv"..ib]=self.inventoryEquipPanel end end function ab:CharacterInformation()local cb=LocalPlayer()local db=cb:GetCharacter()if not db then return end for ob=0,3 do local pb=ob+1 local qb=m(ix.controlManager.GetKey("stalker_quickslot_0"..pb))qb=tostring(qb):upper()local rb=self:Add("DLabel")rb:SetFont("ui.Bahnschrift-5")rb:SetText(qb)rb:SetPos(self.modifyWidth*47+((self.modifyWidth*133)*ob),self.modifyHeight*202)rb:SetSize(self.modifyWidth*84,self.modifyHeight*16)rb:SetContentAlignment(5)end local eb=db:GetName()self.labelCharName=self:Add("DLabel")self.labelCharName:SetPos(self.modifyWidth*47,self.modifyHeight*70)self.labelCharName:SetSize(self.modifyWidth*320,self.modifyHeight*45)self.labelCharName:SetFont("ui.Bahnschrift-s13")self.labelCharName:SetText(eb)self.labelCharName:SetTextColor(Color(225,225,225))self.labelCharName:SetTextInset(self.modifyWidth*10,0)local fb="ui.Bahnschrift-s8"local gb=draw.GetFontHeight(fb)local hb=self.modifyHeight*115 local ib=db:GetClass()ib=(ix.class.list[ib]and ix.class.list[ib].name or"-")self.labelCharClass=self:Add("DLabel")self.labelCharClass:SetFont(fb)self.labelCharClass:SetText("Деятельность: "..ib)self.labelCharClass:SetPos(self.modifyWidth*47,hb)self.labelCharClass:SetSize(self.modifyWidth*320,gb)self.labelCharClass:SetTextColor(X)self.labelCharClass:SetTextInset(self.modifyWidth*10,0)hb=hb+gb local jb=db:GetFaction()jb=(ix.faction.Get(jb)and ix.faction.Get(jb).name or"name")self.labelCharFaction=self:Add("DLabel")self.labelCharFaction:SetFont("ui.Bahnschrift-s8")self.labelCharFaction:SetText("Группировка: "..jb)self.labelCharFaction:SetPos(self.modifyWidth*47,hb)self.labelCharFaction:SetSize(self.modifyWidth*320,gb)self.labelCharFaction:SetTextColor(X)self.labelCharFaction:SetTextInset(self.modifyWidth*10,0)hb=hb+gb+self.modifyHeight*4 local kb=db:GetMoney()kb=string.Comma(ix.currency.Get(kb))self.labelCharMoney=self:Add("DLabel")self.labelCharMoney:SetFont("ui.Bahnschrift-s11")self.labelCharMoney:SetText(kb)self.labelCharMoney:SetPos(self.modifyWidth*47,hb)self.labelCharMoney:SetSize(self.modifyWidth*320,gb)self.labelCharMoney:SetTextColor(X)self.labelCharMoney:SetTextInset(self.modifyWidth*10,0)self.labelCharMoney.Think=function(ob)local pb=CurTime()if(ob._nextUpdate or 0)<pb then ob._nextUpdate=pb+.25 kb=db:GetMoney()kb=string.Comma(ix.currency.Get(kb))ob:SetText(kb)end end local lb=Vector(0,0,3)local mb=cb:GetModel()self.panelAvatar=self:Add("DModelPanel")self.panelAvatar:SetPos(self.modifyWidth*367,self.modifyHeight*76)self.panelAvatar:SetSize(self.modifyWidth*156,self.modifyHeight*80)self.panelAvatar:SetModel(mb)self.panelAvatar:SetLookAt(self.panelAvatar:GetLookAt()+lb)self.panelAvatar:SetFOV(5)self.panelAvatar._nextUpdate=0 self.panelAvatar.LayoutEntity=function(ob)end self.panelAvatar.Think=function(ob,pb,qb)local rb,sb=CurTime(),ob._nextUpdate if sb>rb then return end ob._nextUpdate=rb+1 local tb,ub=cb:GetModel(),ob:GetModel()if ub~=tb then ob:SetModel(tb)end local vb=ob.Entity if IsValid(vb)then local wb,xb=cb:GetSkin(),vb:GetSkin()if wb~=xb then vb:SetSkin(wb)end local yb=cb:GetBodyGroups()for zb=1,#yb do local Ab=yb[zb]local Bb=Ab.id local Cb=cb:GetBodygroup(Bb)if Cb~=vb:GetBodygroup(Bb)then vb:SetBodygroup(Bb,Cb)end end end end do local ob=self.panelAvatar.Entity if IsValid(ob)then local pb=ob:LookupBone("ValveBiped.Bip01_Head1")or ob:LookupBone("bip01_head")if not pb then return end local qb=ob:GetBonePosition(pb)qb:Add(lb)self.panelAvatar:SetLookAt(qb)local rb=qb-Vector(0,-250,0)self.panelAvatar:SetCamPos(rb)self.panelAvatar:SetFOV(5)ob:SetEyeTarget(qb-Vector(0,-250,0))ob:SetAngles(Angle(0,90,0))end end self.panelAvatar.PostDrawModel=function(ob,pb)if ix.itemsList and ix.itemsList.ExtendedRenderItem and IsValid(pb)then ix.itemsList.ExtendedRenderItem(pb,cb)end end self.panelAvatar.PaintOver=function(ob,pb,qb)end local nb=self:Add("ixModelAvatarPanel")nb:SetPos(self.modifyWidth*367,self.modifyHeight*76)nb:SetSize(self.modifyWidth*156,self.modifyHeight*83)nb.Paint=function(ob,pb,qb)s(J)t(color_white)surface.DrawTexturedRect(0,0,pb,qb)end if ix.weight then local ob=db:GetData("carry",0)local pb=ix.weight.BaseWeight(db)local qb=self:Add("DLabel")qb:SetPos(self.modifyWidth*55,self.modifyHeight*935)qb:SetSize(self.modifyWidth*414,self.modifyHeight*50)qb:SetFont("ui.Bahnschrift-s12")qb:SetText("Переносимый вес "..math.Round(ob,2).."/"..math.Round(pb,2).." кг")qb:SetTextColor(X)qb:SetContentAlignment(1)qb._nextUpdate=0 qb.Think=function(tb)local ub=CurTime()if tb._nextUpdate>ub then return end tb._nextUpdate=ub+1 ob=db:GetData("carry",0)pb=ix.weight.BaseWeight(db)tb:SetText("Переносимый вес "..math.Round(ob,2).."/"..math.Round(pb,2).." кг")end local rb=math.Round((ob*100)/pb,1)local sb=self:Add("DLabel")sb:SetFont("ui.Bahnschrift-s7")sb:SetText(rb.."%")sb:SetTextColor(X)sb:SetContentAlignment(5)sb:SizeToContents()sb:SetPos(self.modifyWidth*478+self.modifyWidth*25-sb:GetWide()*.5,self.modifyHeight*989)sb.Think=function(tb)local ub=CurTime()if(tb._nextUpdate or 0)>CurTime()then return end tb._nextUpdate=ub+1 rb=math.Round((ob*100)/pb,1)tb:SetText(rb.."%")tb:SizeToContents()tb:SetPos(self.modifyWidth*478+self.modifyWidth*25-tb:GetWide()*.5,self.modifyHeight*989)end end end function ab:Close()local cb=self:GetChildren()for db,eb in next,cb do if eb.Remove then eb:Remove()end end if self.OnClose then self:OnClose()end if IsValid(ix.gui.stalkerInventoryEquip)then ix.gui.stalkerInventoryEquip:Close()end self:Remove()end function ab:Paint(cb,db)local eb=self.modifyHeight*34 draw.RoundedBox(0,0,eb,cb,db-eb,Color(0,0,0,220))s(I)t(color_white)surface.DrawTexturedRect(0,0,cb,db)end u("inventory_stalker.Inventory",ab,"EditablePanel")local bb={}function bb:Init()local cb=LocalPlayer()local db=cb:GetCharacter()local eb=ix.gui.stalkerInventoryEquip if IsValid(eb)then eb:Remove()end ix.gui.stalkerInventoryEquip=self self:MakePopup()if not db then return end local fb,gb=ScrW(),ScrH()self.modifyWidth,self.modifyHeight=fb/1920,gb/1080 self:SetSize(self.modifyWidth*572,self.modifyHeight*1024)self:Center()ix.stalkerInventory:CharacterInventoryEquip(self)self.iconHealth=self:Add("EditablePanel")self.iconHealth:SetPos(self.modifyWidth*343,self.modifyHeight*84)self.iconHealth:SetSize(self.modifyWidth*79,self.modifyHeight*79)self.iconHealth._nextUpdate=0 self.iconHealth.color=color_white self.iconHealth.Paint=function(ib,jb,kb)local lb=CurTime()if ib._nextUpdate<=lb then ib._nextUpdate=lb+1 local mb,nb=cb:Health(),cb:GetMaxHealth()local ob=mb/nb local pb=math.floor(255*(1-ob))local qb=math.floor(50*(1-ob))ib.color=Color(pb,0,0,qb)end s(N)t(ib.color)surface.DrawTexturedRect(0,0,jb,kb)s(M)t(color_white)surface.DrawTexturedRect(0,0,jb,kb)end self.iconRadiation=self:Add("EditablePanel")self.iconRadiation:SetPos(self.modifyWidth*441,self.modifyHeight*84)self.iconRadiation:SetSize(self.modifyWidth*79,self.modifyHeight*79)self.iconRadiation._nextUpdate=0 self.iconRadiation.radiation=0 self.iconRadiation.color=color_white self.iconRadiation.Paint=function(ib,jb,kb)local lb=CurTime()if ib._nextUpdate<=lb then ib._nextUpdate=lb+1 local mb,nb=db:GetRadiation(),500 local ob=mb/nb local pb=math.floor(255*(ob))local qb=math.floor(50*(ob))ib.color=Color(pb,0,0,qb)end s(P)t(ib.color)surface.DrawTexturedRect(0,0,jb,kb)s(O)t(color_white)surface.DrawTexturedRect(0,0,jb,kb)end local hb=db:GetProtectionStats()for ib,jb in next,Y do local kb=(hb[ib]or 0)local lb=self:Add("DLabel")lb.dmgType=ib lb.posX=jb lb.statValue=(hb[lb.dmgType]or 0)lb:SetFont("ui.Bahnschrift-s7")lb:SetText(lb.statValue.."%")lb:SetTextColor(X)lb:SetContentAlignment(5)lb:SizeToContents()lb:SetPos(self.modifyWidth*(lb.posX)+self.modifyWidth*27-lb:GetWide()*.5,self.modifyHeight*988)lb.Think=function(mb)local nb=CurTime()if(mb._nextUpdate or 0)>CurTime()then return end mb._nextUpdate=nb+1 hb=db:GetProtectionStats()mb.statValue=math.Round(hb[mb.dmgType]or 0,2)mb:SetText(mb.statValue.."%")mb:SizeToContents()mb:SetPos(self.modifyWidth*(mb.posX)+self.modifyWidth*27-lb:GetWide()*.5,self.modifyHeight*988)end end self.buttonShowModel=self:Add("DButton")self.buttonShowModel:SetFont("ui.Bahnschrift-12")self.buttonShowModel:SetText("Осмотреть персонажа")self.buttonShowModel:SetTextColor(Color(215,215,215))self.buttonShowModel:SizeToContents()self.buttonShowModel:SetTall(self.modifyHeight*55)self.buttonShowModel:SetWide(self.buttonShowModel:GetWide()+self.modifyWidth*50)self.buttonShowModel:Center()self.buttonShowModel:AlignBottom(self.modifyHeight*120)self.buttonShowModel.DoClick=function()local ib=ix.gui.stalkerInventory if IsValid(ib)then ib:InitCharacterModelPanel()end end self.buttonShowModel.Paint=function(ib,jb,kb)local lb=ib:IsHovered()surface.SetMaterial(lb and Q or R)surface.SetDrawColor(color_white)surface.DrawPartialTexturedRect(0,0,22,kb,0,0,22,57,142,57)surface.DrawPartialTexturedRect(22,0,jb-44,kb,22,0,98,57,142,57)surface.DrawPartialTexturedRect(jb-22,0,22,kb,120,0,22,57,142,57)end end function bb:Close()local cb=self:GetChildren()for db,eb in next,cb do if eb.Remove then eb:Remove()end end if self.OnClose then self:OnClose()end self:Remove()end function bb:Paint(cb,db)local eb=self.modifyHeight*34 draw.RoundedBox(0,0,eb,cb,db-eb,Color(0,0,0,220))s(K)t(color_white)surface.DrawTexturedRect(0,0,cb,db)end u("inventory_stalker.InventoryEquip",bb,"EditablePanel")if IsValid(ix.gui.stalkerInventoryEquip)then ix.gui.stalkerInventoryEquip:Remove()end if IsValid(ix.gui.stalkerInventory)then ix.gui.stalkerInventory:Remove()if IsValid(ix.gui.stalkerInventory.characterModelPanel)then ix.gui.stalkerInventory.characterModelPanel:Remove()end end concommand.Add("devInv",function(cb)ix.gui.stalkerInventory=a("inventory_stalker.Inventory")ix.gui.stalkerInventoryEquip=a("inventory_stalker.InventoryEquip")end)