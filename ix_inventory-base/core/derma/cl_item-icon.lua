-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=net.Start local b=net.WriteString local c=net.WriteUInt local d=net.WriteTable local e=net.SendToServer local AccessorFunc=AccessorFunc local IsValid=IsValid local SysTime=SysTime local f=input.GetCursorPos local g=dragndrop.IsDragging local LocalPlayer=LocalPlayer local DermaMenu=DermaMenu local h=hook.Run local SortedPairs=SortedPairs local L=L local i=surface.PlaySound local isfunction=isfunction local pairs=pairs local ipairs=ipairs local ix=ix local j=surface.SetDrawColor local k=surface.DrawRect local l=vgui.Register local m="ixInventoryItem"local function n(q,r,s,t)a("ixInventoryAction")b(q)c(r,32)c(s,32)d(t or{})e()end local o={}AccessorFunc(o,"itemTable","ItemTable")AccessorFunc(o,"inventoryID","InventoryID")function o:Init()self:Droppable(m)end local function p(q,r)local s=r.itemTable local t,u,v,w=q.gridW,q.gridH,s.width,s.height if v>t or w>u then return false end for x=1,u-(w-1)do for y=1,t-(v-1)do if q:IsAllEmpty(y,x,v,w,r)then return y,x end end end end function o:DoDoubleClick()local q=IsValid(ix.gui.openedStorage)and ix.gui.openedStorage.storageInventory if IsValid(q)then if self:GetInventoryID()~=ix.gui.inv1.invID then q=ix.gui.inv1 end local r=ix.gui.stalkerInventory if IsValid(r)and(self:GetInventoryID()==r.equipmentInventoryID)then return end local s,t=p(q,self)if s~=nil and t~=nil then self:Move(s,t,q)end end end function o:OnMousePressed(q)if IsValid(ix.gui.invModuleTradeFrame)and q==MOUSE_LEFT then local r=self.itemTable if r and r.id then net.Start("invModuleTrade_OfferItem")net.WriteUInt(r.id,32)net.WriteBool(true)net.SendToServer()return end end if q==MOUSE_LEFT then if self.DoDoubleClick~=nil and self.LastClickTime~=nil and SysTime()-self.LastClickTime<0.2 then self:DoDoubleClick()end self.LastClickTime=SysTime()if self:IsDraggable()then self:MouseCapture(true)self:DragMousePress(q)self.clickX,self.clickY=f()end elseif(q==MOUSE_RIGHT and self.DoRightClick)then self:DoRightClick()end end function o:OnMouseReleased(q)if(!dragndrop.m_ReceiverSlot or dragndrop.m_ReceiverSlot.Name!=m)then self:OnDrop(g())end self:DragMouseRelease(q)self:SetZPos(99)self:MouseCapture(false)end function o:DoRightClick()local q=self.itemTable local r=self.inventoryID if(q and r)then q.player=LocalPlayer()local s=DermaMenu()local t=h("CreateItemInteractionMenu",self,s,q)if(t==true)then if(s.Remove)then s:Remove()end return end for v,w in SortedPairs(q.functions)do if(v=="drop"or v=="combine"or(w.OnCanRun and w.OnCanRun(q)==false))then continue end if(w.isMulti)then local x,y=s:AddSubMenu(L(w.name or v),function()q.player=LocalPlayer()local z=true if(w.OnClick)then z=w.OnClick(q)end if(w.sound)then i(w.sound)end if(z!=false)then n(v,q.id,r)end q.player=nil end)y:SetImage(w.icon or"icon16/brick.png")if(w.multiOptions)then local z=isfunction(w.multiOptions)and w.multiOptions(q,LocalPlayer())or w.multiOptions for A,B in pairs(z)do x:AddOption(L(B.name or"subOption"),function()q.player=LocalPlayer()local C=true if(B.OnClick)then C=B.OnClick(q)end if(B.sound)then i(B.sound)end if(C!=false)then n(v,q.id,r,B.data)end q.player=nil end)end end else s:AddOption(L(w.name or v),function()q.player=LocalPlayer()local x=true if(w.OnClick)then x=w.OnClick(q)end if(w.sound)then i(w.sound)end if(x!=false)then n(v,q.id,r)end q.player=nil end):SetImage(w.icon or"icon16/brick.png")end end local u=q.functions.drop if(u and u.OnCanRun and u.OnCanRun(q)!=false and hook.Run("CanPlayerDropItem",q.player,q:GetID())~=false)then s:AddOption(L(u.name or"drop"),function()q.player=LocalPlayer()local v=true if(u.OnClick)then v=u.OnClick(q)end if(u.sound)then i(u.sound)end if(v!=false)then n("drop",q.id,r)end q.player=nil end):SetImage(u.icon or"icon16/brick.png")end s:Open()q.player=nil end end function o:OnDrop(q,r,s,t,u)local v=self.itemTable if(!v or!q)then return end if(!IsValid(r))then local w=self.inventoryID if(w)then end elseif(r:IsAllEmpty(t,u,v.width,v.height,self))then local w,x=self.gridX,self.gridY if(w!=t or x!=u or self.inventoryID!=r.invID)then self:Move(t,u,r)end elseif(r.combineItem)then local w=r.combineItem local x=w.invID if(x)then w.player=LocalPlayer()if(w.functions.combine.sound)then i(w.functions.combine.sound)end n("combine",w.id,x,{v.id})w.player=nil end end end function o:Move(q,r,s,t)local u=s.iconSize local v,w=self.gridX,self.gridY local x=self:GetParent()if(s:OnTransfer(v,w,q,r,x,t)==false)then return end if self.isEquippedSlot==true then self:Remove()return end local y=(q-1)*u+4 local z=(r-1)*u+s:GetPadding(2)self.gridX=q self.gridY=r self:SetParent(s)self:SetPos(y,z)if(self.slots)then for A,B in ipairs(self.slots)do if(IsValid(B)and B.item==self)then B.item=nil end end end self.slots={}for A=1,self.gridW do for B=1,self.gridH do local C=s.slots[self.gridX+A-1][self.gridY+B-1]C.item=self self.slots[#self.slots+1]=C end end end function o:PaintOver(q,r)local s=self.itemTable ix.stalkerInventory.DrawItemIcon(s,q,r,self)end function o:Paint(q,r)if self.isEquippedSlot~=true then j(0,0,0,65)k(2,2,q-4,r-4)end end l("ixItemIcon",o,"EditablePanel")