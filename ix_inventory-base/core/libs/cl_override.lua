-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local ix=ix local a=surface.SetMaterial local b=surface.SetDrawColor local c=surface.DrawTexturedRect local d=vgui.GetControlTable local IsValid=IsValid local LocalPlayer=LocalPlayer local e=surface.PlaySound local InventoryAction=InventoryAction local f=math.ceil local ipairs=ipairs local Color=Color local g=surface.SetDrawColor local h=surface.DrawRect local i=surface.DrawOutlinedRect local j=vgui.GetControlTable local CurTime=CurTime local k,l=Color(50,50,50,50),Color(0,0,0,200)do local m="ixInventoryItem"PANEL=j("ixItemIcon")function PANEL:OnDrop(n,o,p,q,r)local s=self.itemTable if(!s or!n)then return end if(!IsValid(o))then local t=self.inventoryID if(t)then end elseif(o:IsAllEmpty(q,r,s.width,s.height,self))then local t,u=self.gridX,self.gridY if(t!=q or u!=r or self.inventoryID!=o.invID)then self:Move(q,r,o)end elseif(o.combineItem)then local t=o.combineItem local u=t.invID if(u)then t.player=LocalPlayer()if(t.functions.combine.sound)then e(t.functions.combine.sound)end InventoryAction("combine",t.id,u,{s.id})t.player=nil end end end function PANEL:OnMousePressed(n)if(n==MOUSE_LEFT and self:IsDraggable())then self.isMouseCapture=true self:MouseCapture(true)self:DragMousePress(n)self.clickX,self.clickY=input.GetCursorPos()elseif(n==MOUSE_RIGHT and self.DoRightClick)then self:DoRightClick()end end function PANEL:OnMouseReleased(n)if(!dragndrop.m_ReceiverSlot or dragndrop.m_ReceiverSlot.Name!=m)then self:OnDrop(dragndrop.IsDragging())end self:DragMouseRelease(n)self:SetZPos(99)self:MouseCapture(false)self.isMouseCapture=false end end do local m=ix.util.GetMaterial("purp/stalker/ui/inventory/cell.png","smooth")local function n(o,p,q)a(m)g(color_white)c(0,0,p,q)end PANEL=j("ixInventory")function PANEL:BuildSlots()local o=self.iconSize self.slots=self.slots or{}for p,q in next,self.slots do for r,s in next,q do s:Remove()end end self.slots={}for p=1,self.gridW do self.slots[p]={}for q=1,self.gridH do local r=self:GetPadding(2)local s,t=(p-1)*o+4,(q-1)*o+r local u=self:Add("EditablePanel")u:SetZPos(-32768)u.gridX=p u.gridY=q u:SetPos(s,t)u:SetSize(o,o)u.Paint=n u.nextUpdate=0 u.Think=function(v)v:SetZPos(-32768)end self.slots[p][q]=u end end end function PANEL:FindEmptySlotItemPanel(o)local p=o.itemTable local q,r,s,t=self.gridW,self.gridH,p.width,p.height if s>q or t>r then return false end for u=1,r-(t-1)do for v=1,q-(s-1)do if self:IsAllEmpty(v,u,s,t,o)then return v,u end end end end function PANEL:ReceiveDrop(o,p,q,r,s)local t=o[1]if(!IsValid(t))then self.previewPanel=nil return end if(p)then local u=ix.item.inventories[self.invID]if(u and t.OnDrop)then local v=f((r-4-(t.gridW-1)*32)/self.iconSize)local w=f((s-self:GetPadding(2)-(t.gridH-1)*32)/self.iconSize)t:OnDrop(true,self,u,v,w)end self.previewPanel=nil else self.previewPanel=t self.previewX=r self.previewY=s end end function PANEL:AddIcon(o,p,q,r,s,t)local u=self.iconSize r=r or 1 s=s or 1 if(self.slots[p]and self.slots[p][q])then local v=self:Add("ixItemIcon")v:SetSize(r*u,s*u)v:SetZPos(999)v:InvalidateLayout(true)v:SetModel(o,t)v:SetPos(self.slots[p][q]:GetPos())v.gridX=p v.gridY=q v.gridW=r v.gridH=s local w=ix.item.inventories[self.invID]if(!w)then return end local x=w:GetItemAt(v.gridX,v.gridY)v:SetInventoryID(w:GetID())v:SetItemTable(x)if(self.panels[x:GetID()])then self.panels[x:GetID()]:Remove()end v.slots={}for y=0,r-1 do for z=0,s-1 do local A=self.slots[p+y]and self.slots[p+y][q+z]if(IsValid(A))then A.item=v v.slots[#v.slots+1]=A else for B,C in ipairs(v.slots)do C.item=nil end v:Remove()return end end end return v end end end