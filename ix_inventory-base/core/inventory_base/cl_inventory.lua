-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local ix=ix local Color=Color local LocalPlayer=LocalPlayer local IsValid=IsValid local a=net.Receive local b=hook.Add local c=draw.RoundedBox local d=surface.SetDrawColor local e=surface.SetMaterial local surface=surface local ipairs=ipairs local L=L local select=select local ScrW=ScrW local f=math.min local tobool=tobool local g=math.Clamp local h=util.JSONToTable local i=hook.Run local j=math.ceil local k=draw.GetFontHeight local l=surface.DrawPartialTexturedRect local draw=draw local m=ix.plugin.list["inventory-base"]local n=ix.util.GetMaterial('purp/stalker/ui/ui_actor_hint_wnd.png')local o=ix.util.GetMaterial('purp/stalker/ui/inventory/frame_description_top.png',"smooth")local p=ix.util.GetMaterial('purp/stalker/ui/inventory/frame_description_1.png',"smooth")local q=ix.util.GetMaterial('purp/stalker/ui/inventory/frame_description_2.png',"smooth")local r=ix.util.GetMaterial('purp/stalker/ui/inventory/frame_description_3.png',"smooth")local s=ix.util.GetMaterial('purp/stalker/ui/inventory/lock1.png',"smooth")local t=ix.util.GetMaterial('purp/stalker/ui/inventory/lock2.png',"smooth")local u=ix.util.GetMaterial('purp/stalker/ui/inventory/lock3.png',"smooth")local v=ix.util.GetMaterial('purp/stalker/ui/inventory/lock4.png',"smooth")local w=ix.util.GetMaterial('purp/stalker/ui/inventory/shadow.png',"smooth")local x,y=Color(0,0,0,0),Color(190,190,190,255)local function z(F,G,H,I,J,K)local M=LocalPlayer()local N=""local O=G[1]local P=F.equipmentSlot local Q=M:GetCharacter()if not Q then return end if not IsValid(O)then F.previewPanel=nil return end local R=O.itemTable if R and R.slotIndex and H==true then local S=R.slotIndex if string.match(P,S)==nil then M:Notify("Я не могу разместить это здесь")return end if string.match(P,"Weapon")then local U=R.slotType or"first"local V=Q:GetEquipmentInventory()local W=V:GetItems()if M:HasWeapon(R.weaponClass)then M:Notify("Я не могу надеть два одинаковых оружия")return end for X,Y in next,W do if Y.weaponClass==R.weaponClass then M:Notify("Я не могу надеть два одинаковых оружия.")return end end end local T=F.inventoryEquipPanel if T then local U,V=T:FindEmptySlotItemPanel(O)if P and U and V and T.invID then R.data.equipmentSlot=P O:Move(U,V,T)net.Start("stalkerInventory.SetEquipmentSlot")net.WriteString(P)net.WriteUInt(U,6)net.WriteUInt(V,6)net.WriteUInt(T.invID,32)net.SendToServer()end end end end function ix.stalkerInventory.RefreshMainFrame()local F=LocalPlayer()if IsValid(ix.gui.stalkerInventoryBase)then ix.stalkerInventory:CharacterInventoryEquip(ix.gui.stalkerInventoryBase)end if IsValid(ix.gui.stalkerInventoryEquip)then ix.stalkerInventory:CharacterInventoryEquip(ix.gui.stalkerInventoryEquip)end end function ix.stalkerInventory:CharacterInventoryEquip(F)local G=LocalPlayer()local H=G:GetCharacter()if not H then return end local I=F:GetChildren()for X,Y in next,I do if Y and Y.GetName and Y:GetName()=="CharacterInventoryEquip"then Y:Remove()end end local J=F:GetName()=="inventory_stalker.Inventory"local K=F.modifyWidth*50 local M,N=H:GetEquipmentInventory()if not M or not N then if IsValid(ix.gui.stalkerInventory)then ix.gui.stalkerInventory:Remove()end end local O=ix.gui["inv"..N]local P=false local Q,R=F.modifyWidth,F.modifyHeight if O==nil and M then F.inventoryEquipPanel=F:Add("ixInventory")F.inventoryEquipPanel:SetPos(9999,9999)F.inventoryEquipPanel:SetDraggable(false)F.inventoryEquipPanel:SetSizable(false)F.inventoryEquipPanel:SetTitle(nil)F.inventoryEquipPanel.Paint=function()end F.inventoryEquipPanel:SetIconSize(K)F.inventoryEquipPanel:SetInventory(M)ix.gui["inv"..N]=F.inventoryEquipPanel O=F.inventoryEquipPanel end local S={}local T=H:GetEquipmentHelmet()local U=H:GetEquipmentArmor()if T and T.actorsDisableSlots then table.Merge(S,T.actorsDisableSlots)end if U and U.actorsDisableSlots then table.Merge(S,U.actorsDisableSlots)end local V=(U and H:GetArtefactContainers(U)or 0)if V<5 then for X=V+1,5 do S["slotArtefact0"..X]=true end end local W=ix.stalkerInventory.tableEquipmentSlots for X,Y in next,W do local Z=Y.baseSlotIndex local ab=Y.isDurability local bb=Y.positionX local cb=Y.positionY local db=Y.width local eb=Y.height if J and not string.match(X,"slotQuick")then continue elseif not J and string.match(X,"slotQuick")then continue end if S[X]==true then local gb=s local hb,ib,jb,kb=-7,-7,14,14 if X=="slotHelmet"or X=="slotMask"then gb=v end if string.match(X,"slotArtefact")then gb=u hb,ib,jb,kb=0,1,0,0 end local lb=vgui.Create("EditablePanel",F,"CharacterInventoryEquip")lb:SetPos(Q*(bb+hb),R*(cb+ib))lb:SetSize(Q*(db+jb),R*(eb+kb))lb.Paint=function(mb,nb,ob)d(color_white)e(gb)surface.DrawTexturedRect(0,0,nb,ob)end continue end P=false local fb=H:GetEquipmentItemBySlotIndex(X)if fb and fb.data and fb.data.equipmentSlot then local gb=fb.data.equipmentSlot if fb and(gb and gb~=X or false)then continue end local hb,ib=K*fb.width,K*fb.height if string.find(X,"slotQuick")then hb,ib=hb*.75,ib*.75 end local jb,kb,lb,mb=Q*bb,R*cb,Q*db,R*eb local nb,ob=(jb+(lb*.5)-(hb*.5)),(kb+(mb*.5)-(ib*.5))local pb=O.panels[fb:GetID()]if IsValid(pb)then pb:SetParent(F)pb:SetPos(nb,ob)pb:SetSize(hb,ib)pb.Paint=function()end pb.GetParent=function(qb)return O end if ix.durability and ab then local qb,rb=0,0 if string.match(X,"Weapon")then qb,rb=5,-5 end local sb=vgui.Create("DLabel",F,"CharacterInventoryEquip")sb:SetFont("ui.Bahnschrift-sw7")sb:SetText("0%")sb:SizeToContents()sb:SetPos(Q*(bb+qb),(R*(cb+eb+rb+4))-sb:GetTall())sb:SetZPos(pb:GetZPos()+1)sb._nextUpdate=0 sb.Think=function(tb)if IsValid(pb)and IsValid(tb)then sb:SetVisible(true)tb:SetZPos(pb:GetZPos()+1)else sb:SetVisible(false)end local ub=CurTime()local vb=tb._nextUpdate if vb>ub then return end tb._nextUpdate=ub+1 local wb=math.Round(fb:GetDurability())sb:SetText(wb.."%")sb:SizeToContents()end sb.Paint=function(tb,ub,vb)d(color_white)e(w)surface.DrawTexturedRect(-ub*.25,-vb*.25,ub*1.5,vb*1.5)end end end P=true end if P==false then local gb=vgui.Create("EditablePanel",F,"CharacterInventoryEquip")gb.equipmentSlot=X gb:SetPos(Q*bb,R*cb)gb:SetSize(Q*db,R*eb)gb.Paint=function(hb,ib,jb)local kb,lb=ix.gui.stalkerInventory.tooltip if IsValid(kb)then lb=kb.hoveredItem end if lb and lb.slotIndex and string.find(X,lb.slotIndex)and lb.noEquip~=true then local mb=math.sin(RealTime()*3)*75 local nb=math.abs(mb)draw.RoundedBox(0,ib*.15,jb*.15,ib*.75,jb*.75,ColorAlpha(color_white,nb))end end gb.inventoryEquipPanel=O gb.slotIndex=X gb.ReceiveDrop=z gb:Receiver("ixInventoryItem",gb.ReceiveDrop)end end end local function A(F,G)if F then local H=F:GetItems()for I,J in next,H do local K=J.data and J.data.equipmentSlot or nil if K and string.match(K,G)then return J end end end end function ix.stalkerInventory:CharacterInventoryEquipDest(F,G)local H=LocalPlayer()local I=H:GetCharacter()if not I then return end local J=F:GetChildren()for Y,Z in next,J do if Z and Z.GetName and Z:GetName()=="CharacterInventoryEquip"then Z:Remove()end end local K=F:GetName()=="inventory_stalker.Inventory"local M=F.modifyWidth*50 local N,O=I:GetEquipmentInventory()if not N or not O then if IsValid(ix.gui.stalkerInventory)then ix.gui.stalkerInventory:Remove()end end local P=ix.gui["inv"..O]local Q=false local R,S=F.modifyWidth,F.modifyHeight if!IsValid(P)and N then F.inventoryEquipPanel=F:Add("ixInventory")F.inventoryEquipPanel:SetPos(9999,9999)F.inventoryEquipPanel:SetDraggable(false)F.inventoryEquipPanel:SetSizable(false)F.inventoryEquipPanel:SetTitle(nil)F.inventoryEquipPanel.Paint=function()end F.inventoryEquipPanel:SetIconSize(M)F.inventoryEquipPanel:SetInventory(N)ix.gui["inv"..O]=F.inventoryEquipPanel P=F.inventoryEquipPanel else for Y,Z in next,ix.gui["inv"..O].panels do Z:Remove()end ix.gui["inv"..O]:SetInventory(G)P=ix.gui["inv"..O]end local T={}local U=A(G,"slotHelmet")local V=A(G,"slotArmor")if U and U.actorsDisableSlots then table.Merge(T,U.actorsDisableSlots)end if V and V.actorsDisableSlots then table.Merge(T,V.actorsDisableSlots)end local W=(V&&V.artefactContainers)or 0 if W<5 then for Y=W+1,5 do T["slotArtefact0"..Y]=true end end local X=ix.stalkerInventory.tableEquipmentSlots for Y,Z in next,X do local ab=Z.baseSlotIndex local bb=Z.isDurability local cb=Z.positionX local db=Z.positionY local eb=Z.width local fb=Z.height if K and not string.match(Y,"slotQuick")then continue elseif not K and string.match(Y,"slotQuick")then continue end if T[Y]==true then local hb=s local ib,jb,kb,lb=-7,-7,14,14 if Y=="slotHelmet"or Y=="slotMask"then hb=v end if string.match(Y,"slotArtefact")then hb=u ib,jb,kb,lb=0,1,0,0 end local mb=vgui.Create("EditablePanel",F,"CharacterInventoryEquip")mb:SetPos(R*(cb+ib),S*(db+jb))mb:SetSize(R*(eb+kb),S*(fb+lb))mb.Paint=function(nb,ob,pb)d(color_white)e(hb)surface.DrawTexturedRect(0,0,ob,pb)end continue end Q=false local gb=A(G,Y)if gb and gb.data and gb.data.equipmentSlot then local hb=gb.data.equipmentSlot if gb and(hb and hb~=Y or false)then continue end local ib,jb=M*gb.width,M*gb.height if string.find(Y,"slotQuick")then ib,jb=ib*.75,jb*.75 end local kb,lb,mb,nb=R*cb,S*db,R*eb,S*fb local ob,pb=(kb+(mb*.5)-(ib*.5)),(lb+(nb*.5)-(jb*.5))local qb=P.panels[gb:GetID()]if IsValid(qb)then qb:SetParent(F)qb:SetPos(ob,pb)qb:SetSize(ib,jb)qb.Paint=function()end qb.GetParent=function(rb)return P end if ix.durability and bb then local rb,sb=0,0 if string.match(Y,"Weapon")then rb,sb=5,-5 end local tb=vgui.Create("DLabel",F,"CharacterInventoryEquip")tb:SetFont("ui.Bahnschrift-sw7")tb:SetText("0%")tb:SizeToContents()tb:SetPos(R*(cb+rb),(S*(db+fb+sb+4))-tb:GetTall())tb:SetZPos(qb:GetZPos()+1)tb._nextUpdate=0 tb.Think=function(ub)if IsValid(qb)and IsValid(ub)then tb:SetVisible(true)ub:SetZPos(qb:GetZPos()+1)else tb:SetVisible(false)end local vb=CurTime()local wb=ub._nextUpdate if wb>vb then return end ub._nextUpdate=vb+1 local xb=math.Round(gb:GetDurability())tb:SetText(xb.."%")tb:SizeToContents()end tb.Paint=function(ub,vb,wb)d(color_white)e(w)surface.DrawTexturedRect(-vb*.25,-wb*.25,vb*1.5,wb*1.5)end end end Q=true end if Q==false then local hb=vgui.Create("EditablePanel",F,"CharacterInventoryEquip")hb.equipmentSlot=Y hb:SetPos(R*cb,S*db)hb:SetSize(R*eb,S*fb)hb.Paint=function(ib,jb,kb)local lb,mb=ix.gui.stalkerInventory.tooltip if IsValid(lb)then mb=lb.hoveredItem end if mb and mb.slotIndex and string.find(Y,mb.slotIndex)and mb.noEquip~=true then local nb=math.sin(RealTime()*3)*75 local ob=math.abs(nb)draw.RoundedBox(0,jb*.15,kb*.15,jb*.75,kb*.75,ColorAlpha(color_white,ob))end end hb.inventoryEquipPanel=P hb.slotIndex=Y hb.ReceiveDrop=z hb:Receiver("ixInventoryItem",hb.ReceiveDrop)end end end if IsValid(ix.gui.stalkerInventory)then local F=ix.gui.stalkerInventory.bindKey ix.gui.stalkerInventory=vgui.Create("inventory_stalker.Inventory")ix.gui.stalkerInventory.bindKey=F ix.gui.stalkerInventoryEquip=vgui.Create("inventory_stalker.InventoryEquip")ix.gui.stalkerInventoryEquip.bindKey=F end a("stalkerInventory.Refresh",function()ix.stalkerInventory.RefreshMainFrame()end)local B=ColorAlpha(color_white,50)local C=Color(183,189,189)b("PopulateItemTooltip","stalkerInventoryBase.PopulateItemTooltip",function(F,G)local H,I=ScrW(),ScrH()local J,K=H/1920,I/1080 local M=K*23 local N,O=ix.gui.stalkerInventory,ix.gui.vendor if not IsValid(N)and not IsValid(O)then return end if IsValid(N)then F.hoveredItem=G end F=ix.stalkerInventory.ModifyTooltip(F)local P,Q=(G.GetName and G:GetName()or L(G.name)),G:GetDescription()local R=F:GetRow("name")R:SetText(P)R:DockMargin(0,0,0,J*15)R:SetBackgroundColor(x)R:SetFont("ui.Bahnschrift-w8")R:SetContentAlignment(5)R:SizeToContents()if ix.weight then local T=G:GetWeight()local U=ix.weight.WeightString(T)local V=F:AddRowAfter("name","panelWeight")V:DockPadding(5,0,5,0)V:SetText("")V:SetTall(0)local W=V:Add("DLabel")W:Dock(LEFT)W:SetFont("ui.Bahnschrift-8")W:SetText(U)W:SetContentAlignment(4)W:SizeToContents()W:SetTall(W:GetTall())local X=W:GetTall()V:SetTall(X+10)if G.isStack then if G:GetData("itemStack",1)>1 then local Y=V:Add("DLabel")Y:Dock(RIGHT)Y:SetFont("ui.Bahnschrift-8")Y:SetText(" "..G:GetData("itemStack",1).." шт.")Y:SetContentAlignment(4)Y:SizeToContents()Y:SetTall(Y:GetTall())local Z=Y:GetTall()V:SetTall(Z+10)end end if IsValid(O)and IsValid(O.entity)then local Y=ix.vendor:GetTotalPrice(0,G,O.entity,-1,tobool(G.invID or false))Y=ix.currency.Get(Y)local Z=V:Add("DLabel")Z:Dock(RIGHT)Z:DockMargin(0,0,0,0)Z:SetFont("ui.Bahnschrift-8")Z:SetText(Y)Z:SetContentAlignment(4)Z:SizeToContents()end end local S=F:GetRow("description")S:SetTextColor(C)S:SetFont("ui.Bahnschrift-w8")S:SizeToContents()if G.Tooltip then local T=F:AddRow("space")T:SetTextColor(Color(183,189,189))T:SetText("")T:SizeToContents()T.Paint=function(U,V,W)for X=0,V do if X%10==0 then c(0,X,W*0.5,5,1,Color(70,75,78))end end end G:Tooltip(F,G)end F.mousePadding=-(F:GetWide()+16)F:SizeToContents()if IsValid(N)then ix.gui.stalkerInventory.tooltip=F end end)function ix.stalkerInventory.ModifyTooltip(F)local G,H=ScrW(),ScrH()local I,J=G/1920,H/1080 local K=J*23 F.GetCursorPosition=function(self)local M,N=self:GetSize()local O,P=gui.MousePos()return math.Clamp(O+self.mousePadding,0,ScrW()-M),math.Clamp(P+K,0,ScrH()-N)end F.Paint=function(M,N,O)d(color_white)e(o)surface.DrawTexturedRect(0,0,N,K)d(color_white)e(p)surface.DrawTexturedRect(0,K,N,O-K)d(B)e(q)surface.DrawTexturedRect(0,K,N,J*45)d(B)e(r)surface.DrawTexturedRect(0,O-J*45,N,J*45)local P=M:GetChildren()for Q,R in ipairs(P)do if IsValid(R)then R:PaintManual()end end end F:DockPadding(I*15,0,I*15,0)F:InvalidateParent(true)F.SizeToContents=function(M)local N=0 local O=M:GetChildren()for P,Q in ipairs(O)do Q:InvalidateParent(true)Q:InvalidateLayout(true)N=N+Q:GetTall()end M:SetSize(M.changedSize or I*420,N+J*40)end return F end local D=Color(220,220,220)local E=Color(0,0,0,255)function ix.stalkerInventory.DrawItemIcon(F,G,H,I,J,K,M)local N=LocalPlayer()local O=F.itemIcon local P=F:GetData("itemIcon")if P then O=util.JSONToTable(P)O.material=ix.util.GetMaterial(O.material)end if O and O.material then local Q=color_white if J and IsColor(J)then Q=J else Q=J and color_white or(hook.Run("PaintOverColorModifer",F)or color_white)end local R=O.material local S,T=O.x,O.y local U,V=O.width,O.height local W,X=R:Width(),R:Height()local Y=K and G or math.min(U*1.25,G)local Z=M and H or math.min(V*1.25,H)local ab=K or(G*0.5-Y*0.5)local bb=M or(H*0.5-Z*0.5)surface.SetMaterial(R)surface.SetDrawColor(Q)surface.DrawPartialTexturedRect(ab,bb,Y,Z,S,T,U,V,W,X)local cb,db=ScrW(),ScrH()local eb,fb=cb/1920,db/1080 local gb=O.textTOP_LEFT local hb=O.textBOTTOM_LEFT local ib=O.textTOP_RIGHT local jb=O.textBOTTOM_RIGHT local kb,lb=eb*5,fb*2 local mb=font or"ui.Bahnschrift-5"if gb then draw.SimpleTextOutlined(gb,mb,ab+kb,bb+lb,ColcolorText,TEXT_ALIGN_LEFT,TEXT_ALIGN_TOP,1,E)end if hb then draw.SimpleTextOutlined(hb,mb,ab+kb,bb+Z-lb,D,TEXT_ALIGN_LEFT,TEXT_ALIGN_BOTTOM,1,E)end if ib then draw.SimpleTextOutlined(ib,mb,ab+Y-kb,bb+lb,D,TEXT_ALIGN_RIGHT,TEXT_ALIGN_TOP,1,E)end if jb then draw.SimpleTextOutlined(jb,mb,ab+Y-kb,bb+Z-lb,D,TEXT_ALIGN_RIGHT,TEXT_ALIGN_BOTTOM,1,E)end end if F and F.PaintOver and I then F.PaintOver(I,F,G,H,K,M)end hook.Run("ItemPostPaintOver",I,F,G,H,K,M)end net.Receive("ixStringRequest",function()local F=net.ReadUInt(32)local G,H=net.ReadString(),net.ReadString()local I=net.ReadString()if(G:sub(1,1)=="@")then G=L(G:sub(2))end if(H:sub(1,1)=="@")then H=L(H:sub(2))end Derma_StringRequest(G,H,I or"",function(J)net.Start("ixStringRequest")net.WriteUInt(F,32)net.WriteString(J)net.SendToServer()end,nil,"Подтвердить","Отмена")end)if IsValid(ix.gui.stalkerInventoryEquip)then ix.gui.stalkerInventoryEquip:Remove()end if IsValid(ix.gui.stalkerInventory)then ix.gui.stalkerInventory:Remove()if IsValid(ix.gui.stalkerInventory.characterModelPanel)then ix.gui.stalkerInventory.characterModelPanel:Remove()end end