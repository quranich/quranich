-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=hook.Add local b=math.min local c=CLIENT and surface.SetFont local d=CLIENT and surface.GetTextSize local e=CLIENT and surface.SetMaterial local f=CLIENT and surface.SetDrawColor local surface=surface local g=CLIENT and draw.SimpleText local Color=Color local pairs=pairs local h=timer.Remove local i=net.Start local j=SERVER and net.Send local IsValid=IsValid local Derma_StringRequest=Derma_StringRequest local tonumber=tonumber local Derma_Message=Derma_Message local k=math.floor local l=net.WriteString local m=net.WriteUInt local n=net.WriteTable local o=CLIENT and net.SendToServer local p=ix.plugin.list["inventory-module-stacks"]p.name="Module Inventory - Stacks"p.author="PURP"p.description=""ix.stacks=ix.stacks or{}ix.util.Include("sv_stacks.lua")if CLIENT then local r=ix.util.GetMaterial("purp/stalker/ui/ui_actor_menu.png")local s=ix.util.GetMaterial("purp/stalker/ui/ui_ingame2_common.png")a("ItemPostPaintOver",p.uniqueID.."ItemPostPaintOver",function(t,u,v,w)if not u.isStack then return end local x=u:GetData("itemStack",1)if u.base=="base_ammo"or x>1 then x=b(x,999)local y="ui.Tahoma-6"c(y)local z="x0"..x local A,B=d(z)local C,D=2,2 A,B=A+10,B+6 e(s)f(color_white)surface.DrawPartialTexturedRect(C,D,A,B,864,820,31,18,1024,1024)g("x"..x,y,C+(A*0.5),D+(B*0.5),Color(215,204,186,255),TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)end end)end local function q()local r=ix.item.list for s,t in pairs(r)do if not t.isStack then continue end if t.OnRestored==nil then t.OnRestored=p.OnItemRestored end t.functions.combine={OnRun=function(u,v)local w=v[1]if w and ix.item.instances[w]then local x=ix.item.instances[w]if x:GetData("mutantLevel")~=u:GetData("mutantLevel")then return false end local y=u.player local z=y:UniqueID()local A="ixAct"..z local B="ixOnAction"..z local C=x:GetPlayerID()local D=x:GetCharacterID()local E=y:SteamID64()local F=y:GetCharacter():GetID()if(C and D and C==E and D!=F)then y:NotifyLocalized("itemOwned")return false end h(B)h(A)i("ixActionBarReset")j(y)local G=x.stackLimit local H=x:GetData("itemStack",1)local I=u:GetData("itemStack",1)if G and(I>=G or H>=G)then return false end local J=0 if G then J=G-(I+H)I=math.min(G,I+H)else I=I+H end u:SetData("itemStack",I)if J<0 then x:SetData("itemStack",-J)else x:Remove()end if ix.weight then ix.weight.Update(y:GetCharacter())end end return false end,OnCanRun=function(u,v)local w=ix.item.instances[v[1]]if w then if w:GetData("mutantLevel")~=u:GetData("mutantLevel")then return false end local x=w.stackLimit local y=w:GetData("itemStack",1)local z=u:GetData("itemStack",1)if x and(z>=x or y>=x)then return false end if w.uniqueID==u.uniqueID then return true end end return false end}t.functions.drop.OnCanRun=function(u)return!IsValid(u.entity)and!u.noDrop and u:GetData("itemStack",1)==1 end t.functions.zdropStack={name="Выбросить",icon="icon16/world.png",isMulti=true,multiOptions=function(u,v)local w={{name="Выбросить",data={1},},{name="Выбросить кол-во",OnClick=function(x)local y=ix.item.inventories[x.invID]Derma_StringRequest("Выбросить","Введите кол-во","1",function(z)if not tonumber(z)then Derma_Message("Необходимо ввести число","Ошибка","Понятно")return end z=k(tonumber(z))i("ixInventoryAction")l("zdropStack")m(x.id,32)m(y:GetID(),32)n({(z or 1)})o()end)end,data={0},},{name="Выбросить все",data={-1},},}return w end,OnRun=function(u,v)return p:DropCount(u,v)end,OnCanRun=function(u)return IsValid(u.entity)==false and IsValid(u.player)and u.noDrop==nil and u:GetData("itemStack",1)>1 end}t.functions.stack_split={name="Разделить",icon="icon16/arrow_divide.png",isMulti=true,multiOptions=function(u,v)local w={{name="Разделить 1 шт.",data={1},},{name="Разделить кол-во",OnClick=function(x)local y=ix.item.inventories[x.invID]Derma_StringRequest("Разделить","Введите кол-во","1",function(z)if not tonumber(z)then Derma_Message("Необходимо ввести число","Ошибка","Понятно")return end z=k(tonumber(z))i("ixInventoryAction")l("stack_split")m(x.id,32)m(y:GetID(),32)n({(z or 1)})o()end)end,data={0},},}return w end,OnRun=function(u,v)return p:SplitCount(u,v)end,OnCanRun=function(u)return IsValid(u.entity)==false and IsValid(u.player)and u.noDrop==nil and u:GetData("itemStack",1)>1 end}end end hook.Add("PostInitializedItemsList",p.uniqueID.."PostInitializedItemsList",q)q()