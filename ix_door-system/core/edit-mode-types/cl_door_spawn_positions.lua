-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local ix=ix local Color=Color local a=surface.SetFont local b=surface.GetTextSize local c=surface.SetDrawColor local d=surface.DrawRect local derma=derma local e=surface.SetTextColor local f=surface.SetTextPos local g=surface.DrawText local LocalPlayer=LocalPlayer local ScrW=ScrW local ScrH=ScrH local h=surface.SetMaterial local i=surface.DrawTexturedRect local Vector=Vector local j=render.DrawWireframeBox local k=vgui.Create local IsValid=IsValid local DermaMenu=DermaMenu local l=table.insert local m=table.RemoveByValue local Derma_StringRequest=Derma_StringRequest local tonumber=tonumber local n=list.Get local SortedPairs=SortedPairs local L=L local o=table.HasValue local p=table.IsEmpty local q=table.remove local r=net.Start local s=net.WriteString local t=net.WriteUInt local u=net.WriteTable local v=net.SendToServer local w=ix.plugin.list["door-system"]local x="DOOR_SPAWN_POSITIONS"local y=ix.util.GetMaterial("icon16/arrow_in.png")local function z(E,F,G,H,I,J)H=H or"ixSubTitleFont"J=J or 8 I=I or Color(88,88,88,255)a(H)local K,M=b(G)local N,O=K+J*2,M+J*2 ix.util.DrawBlurAt(E,F,N,O)c(0,0,0,40)d(E,F,N,O)derma.SkinFunc("DrawImportantBackground",E,F,N,O,I)e(color_white)f(E+J,F+J)g(G)return O end ix.doorsSystem.RegisterEditModeHook(x,"HUDPaint",function(E)local F=LocalPlayer()local G=F:GetPos()local H,I=ScrW(),ScrH()local J=32 local K,M=J,J*1.75 local N=E.stage_edit or 0 M=M+z(K,M,"Редактирование позиций спавна","ui.Tahoma-10",ix.config.Get("color"))M=M+z(K,M,"ЛКМ - Добавить / выбрать позицию","ui.Tahoma-7")M=M+z(K,M,"ПКМ - Удалить позицию","ui.Tahoma-7")M=M+z(K,M,"RELOAD (Перезарядка) - Завершить, сохранить","ui.Tahoma-7")for O=1,#E do local P=E[O].position local Q=P:ToScreen()local R=16 local S,T=Q.x-R*0.5,Q.y-R*0.5 c(color_white)h(y)i(S,T,R,R)ix.util.DrawText("#"..O.." - "..E[O].object_type,Q.x,Q.y,color_white,TEXT_ALIGN_CENTER,TEXT_ALIGN_TOP,"ui.Tahoma-7",255)end end)ix.doorsSystem.RegisterEditModeHook(x,"PostDrawTranslucentRenderables",function(E)local F=5 local G,H=Vector(-F,-F,0),Vector(F,F,F)for I=1,#E do local J=E[I].position j(J,angle_zero,G,H,Color(255,255,255),true)end end)local function A(E)local F=ix.doorsSystem_editmode.reading_data local G=F[E]local H=k("DFrame")H:SetTitle("Редактирование позиции")H:SetSize(600,600)H:Center()H:MakePopup()local I=H:Add("DComboBox")I:Dock(TOP)I:SetValue("Выберите тип объекта")local J=H:Add("EditablePanel")J:Dock(FILL)J.UpdateObject=function(self,M)self:Clear()if M=="type_item"then self.searchBar=self:Add("DTextEntry")self.searchBar:Dock(TOP)self.searchBar:DockMargin(0,4,0,0)self.searchBar:SetUpdateOnType(true)self.searchBar:SetPlaceholderText("Поиск...")self.searchBar.OnValueChange=function(O,P)self:ReloadItemList(P)end local N self.items=self:Add("DListView")self.items:Dock(FILL)self.items:DockMargin(0,4,0,0)self.items:AddColumn(L"name").Header:SetTextColor(color_black)self.items:AddColumn(L"mode").Header:SetTextColor(color_black)self.items:SetMultiSelect(false)self.items.OnRowRightClick=function(O,P,Q)if(IsValid(N))then N:Remove()end local R=Q.item N=DermaMenu()local S,T=N:AddSubMenu(L"mode")T:SetImage("icon16/key.png")S:AddOption("Может появиться",function()l(G.objects,R)self:ReloadItemList()end):SetImage("icon16/accept.png")S:AddOption("Не может появиться",function()m(G.objects,R)self:ReloadItemList()end):SetImage("icon16/cancel.png")N:Open()end self:ReloadItemList()elseif M=="type_mutant"then self.searchBar=self:Add("DTextEntry")self.searchBar:Dock(TOP)self.searchBar:DockMargin(0,4,0,0)self.searchBar:SetUpdateOnType(true)self.searchBar:SetPlaceholderText("Поиск...")self.searchBar.OnValueChange=function(O,P)self:ReloadMutantList(P)end local N self.mutants=self:Add("DListView")self.mutants:Dock(FILL)self.mutants:DockMargin(0,4,0,0)self.mutants:AddColumn(L"name").Header:SetTextColor(color_black)self.mutants:AddColumn(L"category").Header:SetTextColor(color_black)self.mutants:AddColumn(L"mode").Header:SetTextColor(color_black)self.mutants:SetMultiSelect(false)self.mutants.OnRowRightClick=function(O,P,Q)if(IsValid(N))then N:Remove()end local R=Q.mutant_class N=DermaMenu()local S,T=N:AddSubMenu(L"mode")T:SetImage("icon16/key.png")S:AddOption("Может появиться",function()Derma_StringRequest("Здоровье","Сколько здоровья будет у монстра",100,function(U)l(G.objects,{ent_class=R,ent_health=tonumber(U)or 100,})self:ReloadMutantList()end,nil,"Готово","Отмена")end):SetImage("icon16/accept.png")S:AddOption("Не может появиться",function()local U=#G.objects for V=1,U do local W=G.objects[V]if W.ent_class==R then G.objects[V]=nil break end end self:ReloadMutantList()end):SetImage("icon16/cancel.png")N:Open()end self:ReloadMutantList()end end J.ReloadMutantList=function(self,M)self.lines={}self.mutants:Clear()local N=n("SpawnableEntities")local O={}local P=#G.objects for Q=1,P do local R=G.objects[Q]l(O,R.ent_class)end for Q,R in SortedPairs(N)do local S=R.GetName and R:GetName()or L(R.PrintName)if R.Category~="MZ MUTANTS"then continue end if(M and!S:lower():find(M:lower(),1,false))then continue end local T=o(O,R.ClassName)local U=self.mutants:AddLine(S,R.Category,T and"Может появиться"or"Не может появиться")U.mutant_class=R.ClassName self.lines[Q]=U end end J.ReloadItemList=function(self,M)self.lines={}self.items:Clear()for N,O in SortedPairs(ix.item.list)do local P=O.GetName and O:GetName()or L(O.name)if(M and!P:lower():find(M:lower(),1,false))then continue end local Q=o(G.objects,O.uniqueID)local R=self.items:AddLine(P,Q and"Может появиться"or"Не может появиться")R.item=N self.lines[N]=R end end I:AddChoice("Предмет","type_item")I:AddChoice("Мутант","type_mutant")I.OnSelect=function(M,N,O)local P=M:GetOptionData(N)G.object_type=P J:UpdateObject(P)end if G.object_type~="none"then J:UpdateObject(G.object_type)end local K=H:Add("ixMenuButton")K:Dock(BOTTOM)K:DockMargin(0,5,0,0)K:SetContentAlignment(5)K:SetFont("ui.Tahoma-7")K:SetText("Завершить")K:SizeToContents()K.DoClick=function()local M=LocalPlayer()if G.object_type=="none"then ix.doorsSystem_editmode.reading_data[E]=nil M:Notify("Вы не выбрали тип, позиция удалена!")H:Remove()return end if p(G.objects)==true then ix.doorsSystem_editmode.reading_data[E]=nil M:Notify("Вы не выбрали обьекты для спавна, позиция удалена!")H:Remove()return end H:Remove()M:Notify("Позиция успешно добавлена!")end end local function B()local E=ix.doorsSystem.GetEditModeType()if E~=x then return end local F=ix.doorsSystem_editmode.reading_data local G=false local H=LocalPlayer():GetEyeTraceNoCursor().HitPos local I=ix.doorsSystem_editmode.reading_data for M=1,#I do local N=I[M].position if H:DistToSqr(N)<=75 then G=M break end end if G~=false then A(G)return end local J=LocalPlayer():GetEyeTraceNoCursor().HitPos local K=l(I,{position=J,object_type="none",objects={},})ix.doorsSystem_editmode.reading_data=I A(K)end local function C()local E=ix.doorsSystem.GetEditModeType()if E~=x then return end local F=LocalPlayer():GetEyeTraceNoCursor().HitPos local G=ix.doorsSystem_editmode.reading_data for H=1,#G do local I=G[H].position if F:DistToSqr(I)<=75 then q(ix.doorsSystem_editmode.reading_data,H)break end end end local function D(E)r("doors.admin-menu.edit-mode-disable")s(ix.doorsSystem_editmode.mode_type)t(ix.doorsSystem_editmode.dungeon_index,8)s(ix.doorsSystem_editmode.dungeon_name)u(E)v()ix.doorsSystem_editmode=nil end ix.doorsSystem.RegisterEditModeHook(x,"PlayerBindPress",function(E,F,G,H)if((G:find("invnext")or G:find("invprev"))and H)then return true elseif(G:find("attack2")and H)then C(E)return true elseif(G:find("attack")and H)then B(E)return true elseif(G:find("reload")and H)then D(E)return true end end)