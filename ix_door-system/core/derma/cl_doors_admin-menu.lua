-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local IsValid=IsValid local ScrW=ScrW local ScrH=ScrH local LocalPlayer=LocalPlayer local Color=Color local a=net.Start local b=net.SendToServer local Derma_StringRequest=Derma_StringRequest local c=string.len local d=net.WriteString local pairs=pairs local e=draw.RoundedBox local draw=draw local DermaMenu=DermaMenu local Derma_Query=Derma_Query local f=net.WriteUInt local Derma_Message=Derma_Message local g=surface.SetDrawColor local h=surface.DrawLine local i=vgui.Create local tonumber=tonumber local j=math.floor local k=net.WriteVector local l=vgui.Register local m=ix.plugin.list["door-system"]local n={DUNGEON_LIST=1,EDIT_MENU=2,}local o={}function o:Init()if CAMI.PlayerHasAccess(LocalPlayer(),"Helix - DOORS SYSTEM SADMIN",nil)~=true then self:Remove()return end if IsValid(ix.gui.adminmenu_doors)then ix.gui.adminmenu_doors:Remove()end ix.gui.adminmenu_doors=self local p,q=ScrW(),ScrH()self:SetTitle("Админ меню - Система дверей")self:SetSize(p*0.5,q*0.8)self:Center()self:MakePopup()self.base_panel=self:Add("EditablePanel")self.base_panel:Dock(FILL)self:InitDoorsList()end function o:FrameRefresh()local p=self.active_now if p==n.DUNGEON_LIST then self:InitDoorsList()elseif p==n.EDIT_MENU then local q=self.active_dungeon self:EditMenu(q,ix.data_doorss[q].dungeon_name)end end function o:InitDoorsList()local p=LocalPlayer()self.active_now=n.DUNGEON_LIST self:Clear()local q=self.base_panel:Add("EditablePanel")q:Dock(TOP)q:DockMargin(0,0,0,5)local r=q:Add("ixMenuButton")r:Dock(RIGHT)r:SetContentAlignment(5)r:DockMargin(5,0,0,0)r:SetBackgroundColor(Color(100,100,50))r:SetFont("ui.Tahoma-7")r:SetText("Обновить")r:SizeToContents()r.DoClick=function(w)a("doors.admin-menu.frame-refresh")b()end local s=q:Add("ixMenuButton")s:Dock(TOP)s:SetContentAlignment(5)s:SetBackgroundColor(Color(50,100,50))s:SetFont("ui.Tahoma-7")s:SetText("Создать новую дверь")s:SizeToContents()s.DoClick=function(w)Derma_StringRequest("Новое подземелье","Введите название новой двери","",function(x)if c(x)<=0 then p:Notify("Укажите название подземелья!")return end a("doors.admin-menu.create-doors")d(x)b()end)end q:InvalidateLayout(true)q:SizeToChildren(false,true)local t=ix.data_doorss or nil if t==nil then local w=self.base_panel:Add("DLabel")w:Dock(FILL)w:SetContentAlignment(5)w:SetFont("ui.Tahoma-7")w:SetText("Список подземелей не загружен, попробуйте обновить")w:SetTextColor(Color(150,150,150))return end local u=#t<=0 if u==true then local w=self.base_panel:Add("DLabel")w:Dock(FILL)w:SetContentAlignment(5)w:SetFont("ui.Tahoma-7")w:SetText("На локации нет активных подземелий")w:SetTextColor(Color(150,150,150))return end local v=self.base_panel:Add("DScrollPanel")v:Dock(FILL)for w,x in pairs(t)do local y=x.dungeon_name or"#name"local z=v:Add("EditablePanel")z:Dock(TOP)z:DockMargin(0,0,0,5)z:DockPadding(5,5,5,5)z:SetTall(48)z.Paint=function(C,D,E)e(0,0,0,D,E,Color(80,80,80,50))draw.Outline(0,0,D,E,Color(100,100,100,50),1)end local A=z:Add("ixMenuButton")A:Dock(RIGHT)A:SetContentAlignment(5)A:SetFont("ui.Tahoma-7")A:SetText("Опции")A:SizeToContents()A.DoClick=function()local C=DermaMenu()C:AddOption("Перезагрузить подземелье",function()Derma_Query("Вы действительно хотети перезагрузить подземелье - "..y,"Подтверждение","Продолжить",function()a("doors.admin-menu.respawn-doors")f(w,8)d(y)b()end,"Отмена")end):SetImage("icon16/arrow_refresh.png")C:AddOption("Переспавнить карты доступа",function()Derma_Query("Вы действительно хотети переспавнить карты доступа","Подтверждение","Продолжить",function()a("doors.admin-menu.respawn-cards")f(w,8)d(y)b()end,"Отмена")end):SetImage("icon16/tag_blue_add.png")C:AddOption("Отредактировать",function()self:EditMenu(w,y)end):SetImage("icon16/cog.png")C:AddOption("Удалить подземелье",function()Derma_StringRequest("Подтвердите свои действия","Подтвердите удаление подземелья, введите 'УДАЛИТЬ' для подтверждения","",function(D)D=D:utf8lower()if D=="удалить"then a("doors.admin-menu.remove-doors")f(w,8)d(y)b()else Derma_Message("Вы не подтвердили удаление!","ОШИБКА","Понятно")end end)end):SetImage("icon16/bin.png")C:Open()end local B=z:Add("DLabel")B:Dock(FILL)B:DockMargin(5,0,0,0)B:SetFont("ui.Tahoma-8")B:SetText(y)B:SizeToContents()end end function o:EditMenu(p,q)local r=LocalPlayer()self.active_now=n.EDIT_MENU self.active_dungeon=p self:Clear()local s=self.base_panel:Add("EditablePanel")s:Dock(TOP)s:SetTall(48)s.Paint=function(w,x,y)g(190,190,190,255)h(0,y-1,x,y-1)end local t=s:Add("ixMenuButton")t:Dock(LEFT)t:DockMargin(0,0,0,5)t:SetContentAlignment(5)t:SetBackgroundColor(Color(200,100,100))t:SetFont("ui.Tahoma-7")t:SetText("Вернуться")t:SizeToContents()t.DoClick=function(w)self:InitDoorsList()end local u=s:Add("DLabel")u:Dock(FILL)u:DockMargin(0,0,0,5)u:SetContentAlignment(5)u:SetFont("ui.Tahoma-12")u:SetText(q)u:SizeToContents()s:InvalidateLayout(true)s:SizeToChildren(true,true)local v=i("DPropertySheet",self.base_panel)v:Dock(FILL)v:DockPadding(5,5,5,5)v.Paint=function(w,x,y)end self:PanelCards(r,v,p,q)self:PanelDoors(r,v,p,q)end function o:PanelDoors(p,q,r,s)local t=q:Add("EditablePanel")t:Dock(FILL)t:DockMargin(5,0,5,5)local u=t:Add("DScrollPanel")u:Dock(FILL)local v=u:Add("ixMenuButton")v:Dock(TOP)v:DockMargin(0,0,0,5)v:SetContentAlignment(5)v:SetBackgroundColor(Color(50,100,50))v:SetFont("ui.Tahoma-7")v:SetText("Добавить дверь")v:SizeToContents()v.DoClick=function(z)Derma_StringRequest("Уровень двери","Введите требуемый уровень карты доступа для открытия двери (1 - 15)","1",function(A)local B=tonumber(A)if B~=nil or(B>0 and B<16)then a("doors.admin-menu.edit-mode-enable")d("DOOR_REGISTRATION")f(r,8)d(s)f(B,4)b()else Derma_Message("Введите число! от (1 до 15)","ОШИБКА","Понятно")end end)end local w=ix.data_doorss or nil if w==nil or w[r]==nil then Derma_Message("Неудалось загрузить список подземелей попробуйте вернуться и обновить список","ОШИБКА","Понятно")self:InitDoorsList()local z=q:AddSheet("Данные дверей",t,"icon16/door_open.png")z.Tab.Paint=function(A,B,C)e(0,0,0,B,C,Color(0,0,0,150))draw.Outline(0,0,B,C,Color(100,100,100,50),1)end return end w[r].data_doors=w[r].data_doors or{}local x=w[r].data_doors if#x<=0 then local z=t:Add("DLabel")z:Dock(FILL)z:SetContentAlignment(5)z:SetFont("ui.Tahoma-7")z:SetText("Нет зарегистрированных дверей")z:SetTextColor(Color(150,150,150))local A=q:AddSheet("Данные дверей",t,"icon16/door_open.png")A.Tab.Paint=function(B,C,D)e(0,0,0,C,D,Color(0,0,0,150))draw.Outline(0,0,C,D,Color(100,100,100,50),1)end return end for z,A in pairs(x)do local B=u:Add("EditablePanel")B:Dock(TOP)B:DockMargin(0,0,0,5)B:DockPadding(10,5,5,5)B:SetTall(64)B.Paint=function(G,H,I)e(0,0,0,H,I,Color(20,20,20,100))draw.Outline(0,0,H,I,Color(100,100,100,100),1)end local C=B:Add("SpawnIcon")C:Dock(LEFT)C:SetWide(B:GetTall())C:SetModel(A.data_door_close.data_model)C:SetMouseInputEnabled(false)local D=A.data_keypad.level or"#name"local E=B:Add("DLabel")E:Dock(LEFT)E:DockMargin(5,0,0,0)E:SetFont("ui.Tahoma-10")E:SetText("["..z.."] - Уровень "..D)E:SizeToContents()local F=B:Add("ixMenuButton")F:Dock(RIGHT)F:SetContentAlignment(5)F:SetFont("ui.Tahoma-7")F:SetText("Опции")F:SizeToContents()F.DoClick=function()local G=DermaMenu()G:AddOption("Установить позиции спавна",function()a("doors.admin-menu.edit-mode-enable")d("DOOR_SPAWN_POSITIONS")f(r,8)d(s)f(z,8)b()end):SetImage("icon16/arrow_in.png")G:AddOption("Выдать карту доступа для двери",function()a("doors.admin-menu.give_card")f(r,8)d(s)f(z,8)b()end):SetImage("icon16/tag_blue_add.png")G:AddOption("Изменить параметры двери",function()a("doors.admin-menu.door_edit")f(r,8)d(s)f(z,8)b()end):SetImage("icon16/cog.png")G:AddOption("Удалить дверь",function()Derma_StringRequest("Подтвердите свои действия","Подтвердите удаление подземелья, введите 'УДАЛИТЬ' для подтверждения","",function(H)H=H:utf8lower()if H=="удалить"then a("doors.admin-menu.door_remove")f(r,8)d(s)f(z,8)b()else Derma_Message("Вы не подтвердили удаление!","ОШИБКА","Понятно")end end)end):SetImage("icon16/bin.png")G:Open()end end local y=q:AddSheet("Данные дверей",t,"icon16/door_open.png")y.Tab.Paint=function(z,A,B)e(0,0,0,A,B,Color(0,0,0,150))draw.Outline(0,0,A,B,Color(100,100,100,50),1)end end function o:PanelCards(p,q,r,s)local t=ix.data_doorss or nil local u=t[r].data_cards local v=u.time_respawn_min or 60 local w=u.time_respawn_max or 60 local x=u.spawn_positions or{}local y=q:Add("EditablePanel")y:Dock(FILL)y:DockMargin(5,10,5,5)local z=y:Add("DScrollPanel")z:Dock(FILL)local A=i("DNumSlider",z)local B=i("DNumSlider",z)A:Dock(TOP)A:SetText("Время респавна ключ карт ( мин в минутах )")A:SetMin(1)A:SetMax(360)A:SetValue(v)A:SetDecimals(0)A.OnValueChanged=function(self,H)B:SetMin(H)local I=B:GetValue()if I<H then B:SetValue(H)end end B:Dock(TOP)B:SetText("Время респавна ключ карт ( макс в минутах )")B:SetMin(1)B:SetMax(360)B:SetValue(w)B:SetDecimals(0)local C=z:Add("ixMenuButton")C:Dock(TOP)C:DockMargin(0,0,0,10)C:SetContentAlignment(5)C:SetBackgroundColor(Color(50,100,50))C:SetFont("ui.Tahoma-7")C:SetText("Сохранить изменения")C:SizeToContents()C.DoClick=function(H)local I=A:GetValue()local J=B:GetValue()I=j(I)J=j(J)a("doors.admin-menu.cards_save")f(r,8)d(s)f(I,9)f(J,9)b()end local D=z:Add("DLabel")D:Dock(TOP)D:DockMargin(0,0,0,5)D:SetText("Позиции для спавна")D:SetFont("ui.Tahoma-10")D:SizeToContents()local E=z:Add("DListView")E:Dock(TOP)E:DockMargin(0,0,0,5)E:SetMultiSelect(false)E:AddColumn("Номер позиции",1).Header:SetTextColor(color_black)E:AddColumn("Координаты позиции",2).Header:SetTextColor(color_black)E:SetTall(150)E.OnRowSelected=function(H,I,J)local K=J:GetColumnText(2)local L=DermaMenu()L:AddOption("Удалить позицию",function()Derma_StringRequest("Подтвердите свои действия","Подтвердите удаление подземелья, введите 'УДАЛИТЬ' для подтверждения","",function(M)M=M:utf8lower()if M=="удалить"then a("doors.admin-menu.remove_card_pos")f(r,8)d(s)k(K)b()else Derma_Message("Вы не подтвердили удаление!","ОШИБКА","Понятно")end end)end):SetIcon("icon16/bin.png")L:Open()end for H=1,#x do local I=x[H]E:AddLine(H,I)end local F=z:Add("ixMenuButton")F:Dock(TOP)F:SetContentAlignment(5)F:SetBackgroundColor(Color(100,100,50))F:SetFont("ui.Tahoma-7")F:SetText("Изменить позиции спавна")F:SizeToContents()F.DoClick=function(H)a("doors.admin-menu.edit-mode-enable")d("POSITIONS_CARDS")f(r,8)d(s)b()end local G=q:AddSheet("Данные ключ карт",y,"icon16/tag_green.png")G.Tab.Paint=function(H,I,J)e(0,0,0,I,J,Color(0,0,0,150))draw.Outline(0,0,I,J,Color(100,100,100,50),1)end end function o:Clear()local p=self.base_panel if IsValid(p)then p:Clear()end end l("adminmenu_doors",o,"DFrame")if IsValid(ix.gui.adminmenu_doors)then ix.gui.adminmenu_doors:Remove()i("adminmenu_doors")end