-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a={}function a:Init()self:SetTitle("Редактирование персонажей")self:SetSize(ScrW()/2,ScrH()/2)self:Center()self:MakePopup()self.list=self:Add("DListView")self.list:Dock(FILL)self.list:SetContentAlignment(5)self.list:SetMultiSelect(false)self.list:AddColumn("UID")self.list:AddColumn("Ник")self.list:AddColumn("Steam ник")self.list:AddColumn("SteamID64")self.list:AddColumn("Фракция")self.list:AddColumn("Деньги")self.list:AddColumn("Сервер")self.formSteamID=self:Add("DTextEntry")self.formSteamID:Dock(BOTTOM)self.formSteamID:SetHeight(30)self.formSteamID:SetPlaceholderText("SteamID или SteamID64")self.formSteamID.OnEnter=function(b)local c=b:GetValue()c=(kouka.utils.IsSteamID64(c)and c)or(kouka.utils.IsSteamID32(c)and util.SteamIDTo64(c))or false if c then netstream.Start("CharsEditMenu","GetInfoSteamID",{c})end end self.formCharID=self:Add("DTextEntry")self.formCharID:Dock(BOTTOM)self.formCharID:SetHeight(30)self.formCharID:SetPlaceholderText("UID (CharID)")self.formCharID.OnEnter=function(b)local c=b:GetValue()if c then netstream.Start("CharsEditMenu","GetInfoCharID",{c})end end end function a:LineOnRightClick(b)b.OnRightClick=function(c)menu=DermaMenu()local d,e=menu:AddSubMenu("Скопировать...")e:SetImage("icon16/package_green.png")d:AddOption("UID",function()SetClipboardText(b.CharID)end):SetImage("icon16/textfield_rename.png")d:AddOption("SteamID",function()SetClipboardText(util.SteamIDFrom64(b.SteamID))end):SetImage("icon16/textfield_rename.png")d:AddOption("SteamID64",function()SetClipboardText(b.SteamID)end):SetImage("icon16/textfield_rename.png")if b.Twin~=""then d:AddOption("Twin",function()SetClipboardText(b.Twin)end):SetImage("icon16/textfield_rename.png")end menu:AddOption("Сменить сервер",function()Derma_StringRequest("Смена сервера","Введите адрес нового сервера",b.Twin,function(h)if h~=b.Twin and kouka.utils.IsIPPort(h)==false then netstream.Start("CharsEditMenu","SetSV",{b.SteamID,b.CharID,h})end end)end):SetImage("icon16/drive_edit.png")local f,g=menu:AddSubMenu("Открыть инвентарь")g:SetImage("icon16/package_green.png")f:AddOption("Стандартный",function()netstream.Start("CharsEditMenu","OpenInv",{b.SteamID,b.CharID})end):SetImage("icon16/package_green.png")f:AddOption("Отображать слоты осматриваемого персонажа [WIP]",function()netstream.Start("CharsEditMenu","OpenInvWithSlots",{b.SteamID,b.CharID})end):SetImage("icon16/package_green.png")f:AddOption("Эндер-сундук",function()netstream.Start("CharsEditMenu","OpenEnderInv",{b.SteamID,b.CharID})end):SetImage("icon16/package_green.png")f:AddOption("Экипировка",function()netstream.Start("CharsEditMenu","OpenEquipInv",{b.SteamID,b.CharID})end):SetImage("icon16/package_green.png")if b.removed then local h,i=menu:AddSubMenu("Восстановить персонажа")i:SetImage("icon16/group_delete.png")h:AddOption("Подтвердить",function()Derma_Query("Вы точно хотите восстановить персонажа "..b.CharID.."?","Восстановление персонажа","Да",function()netstream.Start("CharsEditMenu","CharRestore",{b.SteamID,b.CharID})end,"Нет")end):SetImage("icon16/arrow_redo.png")else local h,i=menu:AddSubMenu("Удалить персонажа")i:SetImage("icon16/group_delete.png")h:AddOption("Подтвердить",function()Derma_Query("Вы точно хотите удалить персонажа "..b.CharID.."?","Удаление персонажа","Да",function()Derma_Query("Написать некролог?","Удаление персонажа - некролог","Да",function()Derma_StringRequest("Некролог","Введите причину смерти","",function(j)netstream.Start("CharsEditMenu","CharRem",{b.SteamID,b.CharID,j})end)end,"Нет",function()netstream.Start("CharsEditMenu","CharRem",{b.SteamID,b.CharID})end)end,"Нет")end):SetImage("icon16/delete.png")end menu:Open()end end function a:SetPlayers(b)if b then for c,d in next,b do local e=self.list:AddLine(d.CharID,d.Name,"",d.SteamID,d.Faction,d.Money,d.Twin)e.CharID=d.CharID e.SteamID=d.SteamID e.Money=d.Money e.Twin=d.Twin e:SetAlpha((d.removed~=nil and 136)or 255)e.removed=d.removed self:LineOnRightClick(e)end else for c,d in next,player.GetAll()do local e=d:GetCharacter()if e then local f=e:GetID()local g=self.list:AddLine(f,d:Name(),d:SteamName(),d:SteamID64(),ix.faction.indices[e:GetFaction()].uniqueID,0,"")g.CharID=f g.SteamID=d:SteamID64()g.Money=0 g.Twin=""self:LineOnRightClick(g)end end end end vgui.Register("CharsEditMenu",a,"DFrame")