-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=ix.plugin.list["inventory-module-vendor-dlc-dialogs"]local b=ix.util.GetMaterial("pp/blurscreen")local c=ix.util.GetMaterial("purp/stalker/ui/ui_actor_menu.png")local d=ix.util.GetMaterial("purp/stalker/ui/ui_actor_dialog_screen.png")local e=ix.util.GetMaterial("purp/stalker/ui/ui_actor_newsmanager_icons.png")local f=ix.util.GetMaterial("pp/blurscreen")local g=ix.util.GetMaterial("purp/stalker/ui/dialogs/dialog.png","smooth")local h=ix.util.GetMaterial("purp/stalker/ui/dialogs/dialog_select.png","smooth")local i=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradedone.png","smooth")local j=ix.util.GetMaterial("purp/stalker/ui/inventory/upgradeyes.png","smooth")local k={}function k:Init()local l=LocalPlayer()local m=l:GetCharacter()local n=ix.gui.stalkerInventoryEquip if IsValid(n)then n:Remove()end ix.gui.stalkerInventoryEquip=self self:MakePopup()if not m then return end local o,p=ScrW(),ScrH()self.modifyWidth,self.modifyHeight=o/1920,p/1080 self:SetSize(self.modifyWidth*950,self.modifyHeight*785)self:Center()self:MakePopup()self.startTime=SysTime()local q=self:Add("DButton")q:SetFont("ui.Bahnschrift-7")q:SetText("X")q:SizeToContents()q:AlignRight(0)q.DoClick=function()self:Remove()end self.dialog_frame=self:Add("DScrollPanel")self.dialog_frame:SetPos(self.modifyWidth*16,self.modifyHeight*57)self.dialog_frame:SetSize(self.modifyWidth*918,self.modifyHeight*491)self.dialog_frame.Paint=function(t,u,v)end local r=self.dialog_frame:GetVBar()r:SetWide(self.modifyWidth*22)self.character_dialog=self:Add("DScrollPanel")self.character_dialog:SetPos(self.modifyWidth*16,self.modifyHeight*574)self.character_dialog:SetSize(self.modifyWidth*918,self.modifyHeight*201)self.character_dialog.Paint=function(t,u,v)end local s=self.character_dialog:GetVBar()s:SetWide(self.modifyWidth*22)end function k:LoadingDialog()if IsValid(self.dialog_frame)then self.dialog_frame.Paint=function(l,m,n)if self.dialog_data==nil then draw.SimpleText("Загрузка диалога, пожалуйста подождите...","ui.Graffiti1CTT-10",m*.5,n*.5,color_white,TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)end end end ix.dlc_vendor.dialogs.ReadApi(self.dialog_uid,function(l)if IsValid(self)then local m=LocalPlayer():GetCharacter()if not m then return end self.charQuestsComplete=m:GetCompleteQuests()self.charQuestsTake=m:GetTakeQuests()self.dialog_data=l.data local n=1 for o,p in next,self.charQuestsTake do if p["dialog"]and p["dialog"][self.dialog_uid]and p["dialog"][self.dialog_uid]~=true then n=p["dialog"][self.dialog_uid]net.Start("questsDialogComplete")net.SendToServer()break end end self:SetStage(n)end end)end function k:SetStage(l)index_stage=tonumber(l)if index_stage==0 then self:Remove()end local m=self.entity local n=self.dialog_data if n==nil then self.dialog_frame.Paint=function(r,s,t)draw.SimpleText("Ошибка загрузки диалога, проверьте UID!!!","ui.Graffiti1CTT-10",s*.5,t*.5,Color(255,100,100),TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)end self:AddCharacterDialog({})return end local o=n[index_stage]if o==nil then self:Remove()return end local p=false for r,s in next,o.ansfers do if s.questID and tonumber(s.nextStage or 0)==0 then p=s.questID end end local q=m:GetDisplayName()if o.dialog then self:AddMessage(q,o.dialog)end if o.ansfers then self:AddCharacterDialog(o.ansfers)end if p then ix.quests.ReadApi(p,function(r)if IsValid(self)then self:AddQuest(r)end end)end end function k:AddQuest(l)local m=LocalPlayer()local n=m:GetCharacter()if not n then return end local o=self.dialog_frame:Add("DLabel")o:Dock(TOP)o:DockMargin(30,-10,0,5)o:InvalidateParent(true)o:SetFont("ui.Bahnschrift-s10")o:SetText("Условия:")o:SetTextColor(Color(210,210,210))o:SizeToContents()local p=l["core"]local q=p.requests local r=p.rewards local s=ix.quests.tableRequestsNames local t=ix.quests.tableRequestsIcons local u=ix.quests.tableRewardName local v=ix.quests.tableRewardIcons local w=ents.FindByClass("ix_vendor")local x=ix.item.list for z,A in next,q do local B=""local C=self.dialog_frame:Add("EditablePanel")C:Dock(TOP)C:DockMargin(30,0,0,5)C:SetTall(48)local D=C:Add("EditablePanel")D:Dock(LEFT)D:SetSize(84,48)D.Paint=function(F,G,H)surface.SetMaterial(e)surface.SetDrawColor(color_white)surface.DrawPartialTexturedRect(0,0,84,48,t[z][1],t[z][2],84,48,512,1024)end local E=C:Add("DLabel")E:Dock(TOP)E:DockMargin(self:GetWide()*.01,0,0,0)E:SetFont("ui.Bahnschrift-s8")E:SetText(s[z]..":")E:SetTextColor(Color(210,210,210))E:SizeToContents()if z=="money"then B=ix.currency.Get(A)local F=C:Add("DLabel")F:Dock(TOP)F:DockMargin(self:GetWide()*.015,0,0,0)F:SetFont("ui.Bahnschrift-s8")F:SetText(B)F:SetTextColor(Color(210,210,210))F:SizeToContents()else for F,G in next,A do if z=="dialog"then for I,J in next,w do if J:GetNWString("dialogIndex")and J:GetNWString("dialogIndex")==F then B=J:GetDisplayName()end end end if z=="goto"then B=F end if z=="kill"then B=scripted_ents.Get(F).PrintName.." x"..G end if z=="items"then local I=x[F]if not I then continue end B=I.name.." x"..G end local H=C:Add("DLabel")H:Dock(TOP)H:DockMargin(self:GetWide()*.015,0,0,0)H:SetFont("ui.Bahnschrift-s8")H:SetText(B)H:SetTextColor(Color(210,210,210))H:SizeToContents()end end C:InvalidateLayout(true)C:SizeToChildren(false,true)end local y=self.dialog_frame:Add("DLabel")y:Dock(TOP)y:DockMargin(30,0,0,5)y:InvalidateParent(true)y:SetFont("ui.Bahnschrift-s10")y:SetText("Награды:")y:SetTextColor(Color(210,210,210))y:SizeToContents()for z,A in next,r do local B=""local C=self.dialog_frame:Add("EditablePanel")C:Dock(TOP)C:DockMargin(30,0,0,5)C:SetTall(48)local D=C:Add("EditablePanel")D:Dock(LEFT)D:SetSize(84,48)D.Paint=function(F,G,H)surface.SetMaterial(e)surface.SetDrawColor(color_white)surface.DrawPartialTexturedRect(0,0,84,48,v[z][1],v[z][2],84,48,512,1024)end local E=C:Add("DLabel")E:Dock(TOP)E:DockMargin(self:GetWide()*.01,0,0,0)E:SetFont("ui.Bahnschrift-s8")E:SetText(u[z]..":")E:SetTextColor(Color(210,210,210))E:SizeToContents()if z=="money"then B=ix.currency.Get(A)local F=C:Add("DLabel")F:Dock(TOP)F:DockMargin(self:GetWide()*.015,0,0,0)F:SetFont("ui.Bahnschrift-s8")F:SetText(B)F:SetTextColor(Color(210,210,210))F:SizeToContents()else for F,G in next,A do if z=="items"then local I=x[F]if not I then continue end B=I.name.." x"..G end local H=C:Add("DLabel")H:Dock(TOP)H:DockMargin(self:GetWide()*.015,0,0,0)H:SetFont("ui.Bahnschrift-s8")H:SetText(B)H:SetTextColor(Color(210,210,210))H:SizeToContents()end end C:InvalidateLayout(true)C:SizeToChildren(false,true)self.dialog_frame:ScrollToChild(C)end end function k:AddMessage(l,m)local n=LocalPlayer()local o=n:GetCharacter():GetName()local p=l==o and Color(70,142,133)or Color(30,102,93)local q=self.dialog_frame:Add("DLabel")q:Dock(TOP)q:DockMargin(0,0,0,0)q:SetTextColor(p)q:SetFont("ui.Bahnschrift-s12")q:SetText(l)q:SizeToContents()local r=l==o and Color(240,240,230)or Color(210,210,210)local s=self.dialog_frame:Add("DLabel")s:Dock(TOP)s:DockMargin(self.modifyWidth*10,0,self.modifyWidth*25,self.modifyHeight*20)s:SetFont("ui.Bahnschrift-s10")s:SetText(m)s:SetTextColor(r)s:SetWrap(true)s:SetAutoStretchVertical(true)s:SetTextInset(self.modifyWidth*25,0)s:SizeToContents()s.Paint=function(t,u,v)local w=draw.GetFontHeight("ui.Bahnschrift-10")*.25 draw.RoundedBox(w*.5,0,w*1.5,w,w,r)end self.dialog_frame:ScrollToChild(s)end function k:AddCharacterDialogButton(l,m)local n=self.character_dialog:Add("DButton")n:Dock(TOP)n:DockMargin(0,0,0,5)n:SetContentAlignment(4)n:SetFont("ui.Bahnschrift-10")n:SetText(l)n:SetPaintBackground(false)n.requestQuestIsComplete=requestQuestIsComplete n:SetTextColor(n.requestQuestIsComplete and Color(150,200,150)or Color(180,170,150))n:SetTextInset(self.modifyWidth*25,0)n:SetWrap(true)n:SetAutoStretchVertical(true)n.Paint=function(o,p,q)local r=o:IsHovered()if r then surface.SetFont(o:GetFont())local t,u=surface.GetTextSize(o:GetText())t=math.min(p,t+self.modifyWidth*50)surface.SetMaterial(h)surface.SetDrawColor(color_white)surface.DrawTexturedRect(0,0,t,q)end local s=draw.GetFontHeight("ui.Bahnschrift-10")*.25 draw.RoundedBox(s*.5,0,s*2,s,s,o:GetTextColor())end n.OnCursorEntered=function(o)o:SetTextColor(color_white)end n.OnCursorExited=function(o)o:SetTextColor(o.requestQuestIsComplete and Color(150,200,150)or Color(180,170,150))end n.DoClick=function(o)if m then m(o)end end return n end function k:AddCharacterDialog(l)if IsValid(self.character_dialog)then self.character_dialog:Clear()end local m=self.charQuestsComplete local n=self.charQuestsTake local o=LocalPlayer()local p=o:GetCharacter()if not p then return end local requestQuestIsComplete=false local q=false for r,s in pairs(l)do local t,u,v=s.message,tonumber((s.nextStage or 0)),s.questID if ix.quests and v then if m[v]and u~=0 then continue end if n[v]and u~=0 then requestQuestIsComplete=ix.quests.GetRequestResult(v,p)if requestQuestIsComplete==true then t="Завершить "..n[v].name end end local y=ix.quests.GetQuestData(v)local z=y["core"]if z and z.required then local A=false for B,C in next,z.required do if not m[B]then A=true break end end if A==true then continue end end end if v==nil and u==0 then q=true end local w=t if ix.quests and v and u==0 then w=w.." [Задание]"end local x=self:AddCharacterDialogButton(w,function(y)if ix.quests and((v and u==0)or(y.requestQuestIsComplete==true))then net.Start("questsTakeQuest")net.WriteString(v)net.SendToServer()self:Remove()return end if s.nextStage==0 then self:Remove()return end if u then local z=LocalPlayer():GetCharacter():GetName()self:AddMessage(z,s.message)self:SetStage(u)end end)x.requestQuestIsComplete=requestQuestIsComplete x:SetTextColor(requestQuestIsComplete and Color(150,200,150)or Color(180,170,150))requestQuestIsComplete=false end if q==false then local r=self:AddCharacterDialogButton("Уйти.",function(s)self:Remove()end)end end function k:Setup(l)local m=l:GetDisplayName()local n=l.money and ix.currency.Get(l.money)or ix.currency.Get(0)self.entity=l self.dialog_uid=l.dialog self:LoadingDialog()if l.items and not table.IsEmpty(l.items)then local o=self:Add("DButton")o:SetFont("ui.Bahnschrift-10")o:SetTextColor(Color(228,208,178))o:SetText("Торговля")o:SizeToContents()o:SetWide(o:GetWide()*1.5)o:SetTall(o:GetTall()*1.25)o:AlignBottom(self:GetTall()*0.01)o:CenterHorizontal()o.Paint=function(p,q,r)local s=p:IsHovered()surface.SetMaterial(s and i or j)surface.SetDrawColor(color_white)surface.DrawPartialTexturedRect(0,0,22,r,0,0,22,57,142,57)surface.DrawPartialTexturedRect(22,0,q-44,r,22,0,98,57,142,57)surface.DrawPartialTexturedRect(q-22,0,22,r,120,0,22,57,142,57)end o.DoClick=function(p)self:Remove()ix.gui.vendor=vgui.Create("ixVendor")ix.gui.vendor:SetReadOnly(false)ix.gui.vendor:Setup(l)end end end function k:OnKeyCodePressed(l)local m=input.LookupBinding("use")m=input.GetKeyCode(m)if m==l then self:Remove()end end function k:Paint(l,m)local n,o=self:LocalToScreen(0,0)local p,q=l,m n,o=n,o+self.modifyHeight*47 p,q=p,q-self.modifyHeight*47 surface.SetMaterial(f)surface.SetDrawColor(255,255,255,255)local r,s=ScrW(),ScrH()local t,u=n/r,o/s local v,w=(n+p)/r,(o+q)/s for x=-0.2,1,0.2 do f:SetFloat("$blur",x*5)f:Recompute()render.UpdateScreenEffectTexture()surface.DrawTexturedRectUV(0,self.modifyHeight*47,p,q,t,u,v,w)end surface.SetMaterial(g)surface.SetDrawColor(color_white)surface.DrawTexturedRect(0,0,l,m)end vgui.Register("dialog.user-frame",k,"EditablePanel")if IsValid(ix.gui.dialog)then ix.gui.dialog:Remove()end