-- <|> Hello, fucker | Taxin2012 and PURP was here | Mysterious Zone Project | mzrp.ru <|>
local a=ix.plugin.list["inventory-module-vendor-dlc-stackbox"]local b=ix.util.GetMaterial("purp/stalker/ui/ui_icon_equipment-misc_01.png","smooth")local c=ix.util.GetMaterial('purp/stalker/ui/ui_actor_sleep_screen.png')a.name="[Module Inventory - Vendors] DLC - StackBox"a.author="PURP"a.description=""ix.dlc_vendor=ix.dlc_vendor or{}ix.dlc_vendor.stackBox={boxList={["ammo"]={name="Патроны",amount=2000,},["armor"]={name="Броня/Шлема",amount=10,addition={["mask"]=true,["helmet"]=true,["backpack"]=true,},},["artcont"]={name="Артефакты/Контейнеры/Детекторы",amount=30,addition={["artefact"]=true,["detector"]=true,}},["weaponsAtt"]={name="Обвесы",amount=15,},["quick"]={name="Еда/Медицина",amount=100,},["weapons"]={name="Оружие/Гранаты",amount=10,},["modifier"]={name="Модули/Модификаторы",amount=20,addition={["modules"]=true,},},}}hook.Add("VendorDLC.NET.ixVendorEdit",a.uniqueID.."VendorDLC.NET.ixVendorEdit",function(e,f,g)if e=="disableStackBox"then g:SetNWBool("disableStackBox",f)end end)if CLIENT then hook.Add("VendorDLC.EditorFrame",a.uniqueID.."VendorDLC.EditorFrame",function(e)e["stackBox"]={name="Пополнение с помощью коробок",draw_editor=function(f,self,g)if not IsValid(g)then return end local h=g:GetNWBool("disableStackBox",false)or false local i=vgui.Create("DCheckBoxLabel",self)i:Dock(TOP)i:DockMargin(5,5,0,10)i:SetFont("ui.Tahoma-8")i:SetText("Отключить пополнение коробками")i:SetValue(h or false)i:SizeToContents()i.OnChange=function(j,k)f:updateVendor("disableStackBox",k)end end,}end)end ix.command.Add("EnableStackVendor",{description="Устанавливает вендору стаки",privilege="Manage Vendors",superAdminOnly=true,OnRun=function(self,e)local f=e:GetEyeTrace()local g=f.Entity if IsValid(g)and g:GetClass()=="ix_vendor"and g:GetPos():Distance(e:GetPos())<300 then local h=0 local i,j=ix.item.list,(g.items or{})for k,l in next,j do if i[k]and i[k].itemTypeMZ then j[k][VENDOR_MAXSTOCK]=10000 if j[k][VENDOR_STOCK]==nil then j[k][VENDOR_STOCK]=100 h=h+1 end end end e:Notify("Вендору установлены стаки на "..h.." предметов.")else e:Notify("Необходимо смотреть на вендора!")end end})ix.util.Include("sv_plugin.lua")ix.util.Include("cl_plugin.lua")local function d(e,f)f:SizeToContents()local g=f:AddRow("protection_panel")g:SetText("")g:SetTall(0)if e.boxCount then local h=g:Add("DPanel")h:Dock(TOP)h:DockMargin(0,0,0,5)h:SetTall(19)h:SetPaintBackground(false)local i=h:Add("DPanel")i:Dock(LEFT)i:SetWide(19)i.Paint=function(l,m,n)surface.SetDrawColor(color_white)surface.SetMaterial(c)surface.DrawPartialTexturedRect(0,0,19,19,768,471,19,19,1024,1024)end local j=h:Add("DLabel")j:Dock(LEFT)j:DockMargin(5,0,0,0)j:SetFont("ui.Tahoma-6")j:SetTextColor(Color(110,114,113))j:SetText("Количество товара")j:SizeToContents()local k=h:Add("DLabel")k:Dock(RIGHT)k:DockMargin(0,0,0,0)k:SetFont("ui.Tahoma-6")k:SetTextColor(Color(184,186,183))k:SetText(e.boxCount.." шт.")k:SetContentAlignment(5)k:SizeToContents()end g:InvalidateLayout(true)g:SizeToChildren(false,true)end function InitializationItems()local e=ix.dlc_vendor.stackBox.boxList local f=ix.itemsListMaterials for g,h in next,e do local i=g:lower()local j="stackbox_"..i local k=ix.item.Register(j,nil,nil,nil,true)k.boxType=g k.boxAddition=h.addition k.boxCount=h.amount k.name="Ящик снабжения - "..h.name k.description="Необходимые предмедеты для торговцев"k.model="models/wick/wrbstalker/props/static/wrb_army_crate_4.mdl"k.category="Ящики снабжения"k.weight=10 k.width=2 k.height=2 k.Tooltip=d k.itemIcon={material=f.ui_icon_equipment_misc_01,x=1100,y=3350,width=100,height=100,}k.functions.GiveTo={name="Передать ящик торговцуу (Пополнить арсенал)",icon="icon16/box.png",OnRun=function(l)local m=l.player local n=m:GetCharacter()local o=m:GetEyeTrace()local p=o.Entity if IsValid(p)and p:GetClass()=="ix_vendor"then if p:GetNWBool("disableStackBox",false)==true then m:Notify("Торговец не принимает ящики")return false end local q,r=ix.item.list,(p.items or{})local s=false for t,u in next,r do if q[t]and q[t].itemTypeMZ and(q[t].itemTypeMZ==l.boxType or(l.boxAddition and l.boxAddition[q[t].itemTypeMZ]==true))then p:TakeStock(t,-l.boxCount)s=true end end return s end return false end,OnCanRun=function(l)local m=l.player local n=m:GetCharacter()return not IsValid(l.entity)and IsValid(m)end}function k:OnRemoved()local l=self.player if l then local m=l:GetCharacter()if m then ix.weight.Update(m)end end end end end hook.Add("PostInitializedItemsList",a.uniqueID.."PostInitializedItemsList_stackbox",InitializationItems)if IX_PLUGINS_LOADED then InitializationItems()end